<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>DevBox-Santé – Installer</title>
    <link>/docs/installer/</link>
    <description>Recent content in Installer on DevBox-Santé</description>
    <generator>Hugo -- gohugo.io</generator>
    
	  <atom:link href="/docs/installer/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>Docs: Eureka</title>
      <link>/docs/installer/eureka/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/docs/installer/eureka/</guid>
      <description>
        
        
        

&lt;div class=&#34;pageinfo pageinfo-primary&#34;&gt;
&lt;pre&gt;&lt;code&gt;Attention : Page en cours de construction
&lt;/code&gt;&lt;/pre&gt;

&lt;/div&gt;

&lt;p&gt;Afin de gérer les déploiements de la DevBox-Santé dans des environnements type Windows RDP (Remote Desktop Protocol) / Citrix, nous avons créé le projet &lt;strong&gt;Eureka&lt;/strong&gt;.
Eureka est l&amp;rsquo;annuaire des devbox-santé branchés sur les différents lecteurs de carte PC/SC:&lt;/p&gt;
&lt;p&gt;Dans &lt;a href=&#34;/blog/2021/09/20/devbox-sant%C3%A9-dans-un-environnement-rdp/citrix/&#34;&gt;notre post du 20 septembre 2021&lt;/a&gt;, nous expliquions qu&amp;rsquo;il était difficile de faire le lien entre un partage de port USB (spécifique à chaque session utilisateur RDP) et un partage de port HTTP.&lt;/p&gt;
&lt;p&gt;Chaque session utilisateur devait être associé à une DevBox-Santé sur un port http spécifique.&lt;/p&gt;
&lt;h2 id=&#34;eureka-service&#34;&gt;Eureka service&lt;/h2&gt;
&lt;p&gt;C&amp;rsquo;est pourquoi un service dédié, nommé Eureka peut être lancé sur le serveur RDP. Ce service Eureka joue le rôle d&amp;rsquo;annuaire des différentes sessions utilisateurs devbox-santé :&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-plantuml&#34; data-lang=&#34;plantuml&#34;&gt;!include https://bitbucket.org/devbox-sante/plantuml/raw/3/themes/theme-devbox-sante.puml

node &amp;quot;Serveur RDP&amp;quot; {
  package &amp;quot;Eureka&amp;quot; as eureka {
        [DevBox-Santé1:9999] as devbox1 DEVBOX_COLOR
        [DevBox-Santé2:9998] as devbox2 DEVBOX_COLOR
  }
}

node &amp;quot;Poste utilisateur 1&amp;quot; {
   [Application Intégrateur Front/Lourd] as int1
   [Lecteur USB / Utilisateur 1] as usb1
}
node &amp;quot;Poste utilisateur 2&amp;quot; {
   [Application Intégrateur Front/Lourd] as int2
   [Lecteur USB / Utilisateur 2] as usb2
}
int1 --&amp;gt; eureka 
devbox1 -- usb1 : mapping port USB
int2 --&amp;gt; eureka 
devbox2 -- usb2 : mapping port USB
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Ainsi, il suffit à l&amp;rsquo;application intégrateur de faire un appel à eureka pour connaître le numéro de port http d&amp;rsquo;écoute qui lui est spécifique.&lt;/p&gt;
&lt;h2 id=&#34;diagrammes-de-séquence&#34;&gt;Diagrammes de séquence&lt;/h2&gt;
&lt;p&gt;Du point de vue de l&amp;rsquo;intégrateur&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-plantuml&#34; data-lang=&#34;plantuml&#34;&gt;!include https://bitbucket.org/devbox-sante/plantuml/raw/3/themes/theme-devbox-sante.puml
hide footbox
actor Utilisateur1 
box &amp;quot;Serveur RDP&amp;quot;
participant Eureka
end box
box &amp;quot;Session utilisateur 1&amp;quot;
participant &amp;quot;DBX:8081&amp;quot; as DBX_8081 DEVBOX_COLOR
participant &amp;quot;Application Intégrateur&amp;quot; as AppInt1
participant &amp;quot;Application Web Intégrateur (front)&amp;quot; as WebApp1
end box

== Cas 1 : client lourd ==
...

group Démarrage application intégrateur (cas du client lourd)
    Utilisateur1 -&amp;gt; AppInt1: Démarre l&#39;applicationIntégrateur
    activate AppInt1
    AppInt1 -&amp;gt; AppInt1 : Appel système pour récupérer utilisateur windows
    AppInt1 -&amp;gt; Eureka : GET /user/Utilisateur1
    Eureka -&amp;gt; AppInt1 : {user: Utilisateur1, port: 8081}
    AppInt1 -&amp;gt; DBX_8081 : GET localhost:8081/cps/readCps...
    deactivate AppInt1
end 
...

== Cas 2 : client web ==

group Démarrage application intégrateur (cas de l&#39;application web)
    Utilisateur1 -&amp;gt; WebApp1 : Accède depuis un navigateur http://superapp.integrateur 
    activate WebApp1
    note over WebApp1 : Il n&#39;est pas possible depuis un contexte web \nde récupérer le username windows
    WebApp1 -&amp;gt; DBX_8081 : Lance une DevBox-sante par l&#39;url devbox-sante://config?sessionId:12345
    WebApp1 -&amp;gt; Eureka : GET /user/12345
    Eureka -&amp;gt; WebApp1 : {user: Utilisateur1, sessionId: 12345, port: 8081}
    WebApp1 -&amp;gt; DBX_8081 : GET localhost:8081/cps/readCps...
end
...

&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Ces diagrammes paraissent un peu magiques pour l&amp;rsquo;intégrateur. C&amp;rsquo;est pourquoi, voici un diagramme de séquence détaillant ce qui se passe dans les coulisses de la DevBox-santé, afin de faire le lien entre Utilisateur windows, session web utilisateur et port http des DevBox-Santé :&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-plantuml&#34; data-lang=&#34;plantuml&#34;&gt;!include https://bitbucket.org/devbox-sante/plantuml/raw/3/themes/theme-devbox-sante.puml
hide footbox
actor Utilisateur1 
box &amp;quot;Serveur RDP&amp;quot;
participant ServeurRDP
participant Eureka
end box
box &amp;quot;Session utilisateur 1&amp;quot;
participant SessionRDP1
participant &amp;quot;DBX:8081&amp;quot; as DBX_8081 DEVBOX_COLOR
participant &amp;quot;Application Intégrateur&amp;quot; as AppInt1
participant &amp;quot;WebApp Intégrateur\n(front)&amp;quot; as WebApp1
participant &amp;quot;Devbox temporaire&amp;quot; as DBX_TMP DEVBOX_COLOR
end box

== Démarrage serveur RDP ==
ServeurRDP -&amp;gt; Eureka : Démarrage service\nEureka
...
== Connexion utilisateur ==
Utilisateur1 -&amp;gt; SessionRDP1 : Se connecte
activate SessionRDP1
ServeurRDP &amp;lt;- SessionRDP1 : Démarre une nouvelle session
SessionRDP1 &amp;lt;-&amp;gt; ServeurRDP : Mapping port USB
SessionRDP1 -&amp;gt; DBX_8081 : Démarrage automatique\nd&#39;une instance DevBox-Santé\n(port 8081 par exemple)
activate DBX_8081
DBX_8081 -&amp;gt; ServeurRDP : accés au port USB (pour lectures cartes)
DBX_8081 -&amp;gt; Eureka : POST {user: Utilisateur1, port:8081}
...

group Démarrage application intégrateur (cas du client lourd)
    Utilisateur1 -&amp;gt; AppInt1: Démarre l&#39;applicationIntégrateur
    activate AppInt1
    AppInt1 -&amp;gt; Eureka : GET /user/Utilisateur1
    Eureka -&amp;gt; AppInt1 : {user: Utilisateur1, port: 8081}
    AppInt1 -&amp;gt; DBX_8081 : GET localhost:8081/cps/readCps...
    deactivate AppInt1
end 
...

group Démarrage application intégrateur (cas de l&#39;application web)
    Utilisateur1 -&amp;gt; WebApp1 : Accède depuis un navigateur http://superapp.integrateur 
    activate WebApp1
    WebApp1 -&amp;gt; DBX_TMP : devbox-sante://config?sessionId:12345
    activate DBX_TMP
    DBX_TMP -&amp;gt; DBX_8081 : healthcheck (is alive ?)
    DBX_8081 -&amp;gt; DBX_TMP : 200 OK
    DBX_TMP -&amp;gt; Eureka : POST {user: Utilisateur1, sessionId : 12345, port: 8081}
    deactivate DBX_TMP
    WebApp1 -&amp;gt; Eureka : GET /user/12345
    Eureka -&amp;gt; WebApp1 : {user: Utilisateur1, sessionId: 12345, port: 8081}
    WebApp1 -&amp;gt; DBX_8081 : GET localhost:8081/cps/readCps...
end
...


&lt;/code&gt;&lt;/pre&gt;
      </description>
    </item>
    
  </channel>
</rss>
