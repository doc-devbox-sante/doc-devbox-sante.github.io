<!doctype html>
<html lang="fr" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.88.1" /><link rel="canonical" type="text/html" href="/docs/">
<link rel="alternate" type="application/rss&#43;xml" href="/docs/index.xml">
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>DevBox-Santé | DevBox-Santé</title>


  <meta name="description" content="Documentation de tous les composants/connecteurs de la DevBox-Santé 
">
<meta property="og:title" content="DevBox-Santé" />
<meta property="og:description" content="Documentation de tous les composants/connecteurs de la DevBox-Santé 
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/docs/" /><meta property="og:site_name" content="DevBox-Santé" />

<meta itemprop="name" content="DevBox-Santé">
<meta itemprop="description" content="Documentation de tous les composants/connecteurs de la DevBox-Santé 
"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="DevBox-Santé"/>
<meta name="twitter:description" content="Documentation de tous les composants/connecteurs de la DevBox-Santé 
"/>




<link rel="preload" href="/scss/main.min.295d7e658f561e18a4830ad7471be02701977db5d7a3e8f47b23f34696125f79.css" as="style">
<link href="/scss/main.min.295d7e658f561e18a4830ad7471be02701977db5d7a3e8f47b23f34696125f79.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>


<link rel="stylesheet" href="/css/devbox-sante.css" type="text/css">





<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-39129192-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg id="Composant_16_14" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 132.5 118.9" style="enable-background:new 0 0 132.5 118.9"><style>.st0{fill:url(#SVGID_1_)}.st1{fill:#fff}.st2{fill:url(#SVGID_2_)}.st3{fill:url(#SVGID_3_)}.st4{fill:#d34a3c}.st5{fill:none;stroke:#fff;stroke-width:6}</style><g id="Rectangle_69" transform="translate(65.996 38.892)"><linearGradient id="SVGID_1_" gradientUnits="userSpaceOnUse" x1="-44.4861" y1="64.4079" x2="-45.1313" y2="65.2243" gradientTransform="matrix(66.506 0 0 -66.507 3013.5039 4344.1382)"><stop offset="0" style="stop-color:#7613E0"/><stop offset="1" style="stop-color:#9F57ED"/></linearGradient><path class="st0" d="M23.3 3.8h19.9c10.7.0 19.4 8.7 19.4 19.4v19.9c0 10.7-8.7 19.4-19.4 19.4H23.3c-10.7.0-19.4-8.7-19.4-19.4V23.2C3.9 12.5 12.6 3.8 23.3 3.8z"/><g><path class="st1" d="M44.5 66.5H22c-12.1.0-22-9.9-22-22V22C0 9.9 9.9.0 22 0h22.5c12.1.0 22 9.9 22 22v22.5c0 12.1-9.9 22-22 22zM22 6C13.2 6 6 13.2 6 22v22.5c0 8.8 7.2 16 16 16h22.5c8.8.0 16-7.2 16-16V22c0-8.8-7.2-16-16-16H22z"/></g></g><g id="Rectangle_70" transform="translate(110.109) rotate(90)"><linearGradient id="SVGID_2_" gradientUnits="userSpaceOnUse" x1="103.5653" y1="89.1427" x2="104.2366" y2="89.9162" gradientTransform="matrix(0 -66.506 -66.507 0 5940.3726 6895.6235)"><stop offset="0" style="stop-color:#67ED9A"/><stop offset="1" style="stop-color:#4AC87A"/></linearGradient><path class="st2" d="M23 1.5h21.5c11.6.0 21 9.4 21 21V44c0 11.6-9.4 21-21 21H23C11.4 65 2 55.6 2 44V22.5c0-11.6 9.4-21 21-21z"/><g><path class="st1" d="M66.5 22v22.5c0 12.1-9.9 22-22 22H22c-12.1.0-22-9.9-22-22V22C0 9.9 9.9.0 22 0h22.5c12.1.0 22 9.9 22 22zM6 44.5c0 8.8 7.2 16 16 16h22.5c8.8.0 16-7.2 16-16V22c0-8.8-7.2-16-16-16H22C13.2 6 6 13.2 6 22V44.5z"/></g></g><g id="Rectangle_71" transform="translate(88.714 52.366) rotate(90)"><linearGradient id="SVGID_3_" gradientUnits="userSpaceOnUse" x1="50.3774" y1="67.1362" x2="49.7677" y2="66.2039" gradientTransform="matrix(0 -66.506 -66.507 0 4517.4551 3412.9705)"><stop offset="0" style="stop-color:#FFA800"/><stop offset="1" style="stop-color:#FFC24D"/></linearGradient><path class="st3" d="M22.8 2.3h21c11.3.0 20.5 9.2 20.5 20.5v21c0 11.3-9.2 20.5-20.5 20.5h-21c-11.3.0-20.5-9.2-20.5-20.5v-21C2.3 11.4 11.4 2.3 22.8 2.3z"/><g><path class="st1" d="M66.5 22v22.5c0 12.1-9.9 22-22 22H22c-12.1.0-22-9.9-22-22V22C0 9.9 9.9.0 22 0h22.5c12.1.0 22 9.9 22 22zM6 44.5c0 8.8 7.2 16 16 16h22.5c8.8.0 16-7.2 16-16V22c0-8.8-7.2-16-16-16H22C13.2 6 6 13.2 6 22V44.5z"/></g></g><g id="Rectangle_72" transform="translate(66.506 13.481) rotate(90)"><g><path class="st4" d="M23 1.5h21.5c11.6.0 21 9.4 21 21V44c0 11.6-9.4 21-21 21H23C11.4 65 2 55.6 2 44V22.5c0-11.6 9.4-21 21-21z"/></g><path class="st5" d="M22 3h22.5c10.5.0 19 8.5 19 19v22.5c0 10.5-8.5 19-19 19H22c-10.5.0-19-8.5-19-19V22C3 11.5 11.5 3 22 3z"/></g></svg></span><span class="text-uppercase font-weight-bold">DevBox-Santé</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="/docs/" ><i class='icon icon-devbox'></i><span class="active">Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/dmp/" ><i class='icon iconNav icon-dmp'></i><span>DMP</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/insi/" ><i class='icon iconNav icon-ins'></i><span>INSi</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/ms-sante/" ><i class='icon iconNav icon-mssante'></i><span>MSS</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/cps/" ><i class='icon iconNav icon-cps-puce'></i><span>CPS</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/vitale/" ><i class='icon iconNav icon-sesam-puce'></i><span>Vitale</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/blog/" ><i class='fa fa-blog'></i><span>Blog</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
Version imprimable multipages.
<a href="#" onclick="print();return false;">Cliquer ici pour imprimer</a>.
</p><p>
<a href="/docs/">Retour à la version par défaut</a>.
</p>
</div>



<h1 class="title">DevBox-Santé</h1>
<div class="lead">Documentation de tous les composants/connecteurs de la DevBox-Santé</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-5283da1fd88eac832246065dbc0d7f33">DMP</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.1: <a href="#pg-a6eaee58dc466dd07be2ce8db90785c4">Embedded : Premier Pas</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.1.1: <a href="#pg-c170416e912bb013bc51892d720b3f51">Transactions supportées</a></li>


    
  
    
    
	
<li>1.1.2: <a href="#pg-4423c3215e74e0e25f5fff050e59e190">Howtos</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.1.2.1: <a href="#pg-6ffcffba36ec8ebb25c07b22f823247f">UniqueIdGenerator</a></li>


    
  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>1.2: <a href="#pg-c239923082dc512921f012c4f292b15d">REST Proxy</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>1.3: <a href="#pg-16f164740bcf3b4b7dd9b403e13c7878">SOAP Proxy</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>1.4: <a href="#pg-f917524b2d2c07e82c769ba5201dd372">Authentifications</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.4.1: <a href="#pg-693787acd093e3d7c4291d13a9317b45">Authentification Indirecte (via certificat serveur)</a></li>


    
  
    
    
	
<li>1.4.2: <a href="#pg-d5ff74ac0ae80510ab46a7b0b0e860b0">Authentification Directe (via carte CPx)</a></li>


    
  
    
    
	
<li>1.4.3: <a href="#pg-6e9b5f8c8bc71af95dc394511a02ae68">Authentification Directe via le CPS Agent</a></li>


    
  

    </ul>
    
  
    
    
	
<li>1.5: <a href="#pg-3cdfc9b194da698c476bf8ecc81edcb0">Structuration des documents</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.5.1: <a href="#pg-d34be09f24f6f3a9f9e24e8f82412d8a">CDA structuration minimale</a></li>


    
  
    
    
	
<li>1.5.2: <a href="#pg-57bd2090107e3a53752be3a64f6dbda5">Compte rendu d&#39;examens de biologie</a></li>


    
  

    </ul>
    
  
    
    
	
<li>1.6: <a href="#pg-434a46fcd75cb7f35d890cb3ebdc053a">Howtos</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.6.1: <a href="#pg-1a15b213096f096d9defaada77087947">Gestion des certificats</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>1.6.2: <a href="#pg-53b7f8f0f608f33d1a397afec2bc84bc">Schematron</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>1.6.3: <a href="#pg-2072c7e8915f01be9a626ddb4b2ec2e5">Integrateurs checklist</a></li>


    
  
    
    
	
<li>1.6.4: <a href="#pg-f98f9f3ea4cdf6312fc48ed88daeadcf">Paramètrage de la DevBox-santé DMP</a></li>


    
  

    </ul>
    
  
    
    
	
<li>1.7: <a href="#pg-78fb0c46f2d88b360cb6b80ccd009bce">Versions</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-de2277b97361850960224a7d2972cc24">INSi</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.1: <a href="#pg-00b4e8e7e9c9fde6d61dbb9403a604c9">Java API</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2.2: <a href="#pg-4840a95263433cd2eecdfa84790ab794">REST Proxy</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.2.1: <a href="#pg-a254dbdfb22e46087426b0d84581233e">Conformité CNDA</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>2.3: <a href="#pg-d881fa6114d4529ec23c4e26008a07bf">Configuration DevBox-santé INSi</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2.4: <a href="#pg-ed9b21891b159f3aa8acbd113b0478ed">Howtos</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.4.1: <a href="#pg-f9f83c8618e0150f763410de137ab463">Integrateurs checklist</a></li>


    
  

    </ul>
    
  
    
    
	
<li>2.5: <a href="#pg-aba06791c0ee9b086082de3b426277b1">Versions</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2.6: <a href="#pg-1408a5c30f1567083f189a36a65a8491"></a></li>


    
  

    </ul>
    
  
    
    
	
<li>3: <a href="#pg-7fb26e2fc641344abfb815b92f5afec1">MSS</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4: <a href="#pg-0f8d0ee2d23e0e3022cb56348f82e9dd">CPS</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>4.1: <a href="#pg-9fc0b6d1368ed39ed9e18b18f224c810">Versions</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>5: <a href="#pg-aabe453a813b9f87dd0e8350e70947e4">Vitale</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.1: <a href="#pg-8b58a48c9632148cde85981d37d21c3a">Problèmes connus</a></li>


    
  
    
    
	
<li>5.2: <a href="#pg-867e73353cc514820775746e03c23a4a">Versions</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>6: <a href="#pg-c3020375c601186cfa8c18b2029bb70a">Annuaire</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>7: <a href="#pg-a7bb4ab6af63b66fa3391c108fc44df2">Installer</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-5283da1fd88eac832246065dbc0d7f33">1 - DMP</h1>
    <div class="lead">Le DMP intégré aux LPS</div>
	<p>La DevBox-santé DMP est une api Java dont tous les composants sont injectables dans un environnement SpringFramework. 
Elle suit le guide d&rsquo;intégration définit par le GIE SESAM-Vitale : <a href="">https://www.sesam-vitale.fr/documents/20182/54758/SEL-MP-037+DMPi.pdf</a></p>
<p>Ces composants sont tous basés sur des librairies de l&rsquo;opensource comme Joda-time, Log4j, Apache Santuario, Apache CXF… .</p>
<ul>
<li>La DMPC-API proposé est un projet github public : <a href="https://bitbucket.com/devbox-sante/dmpc-api">https://bitbucket.com/devbox-sante/dmpc-api</a></li>
</ul>
<h2 id="connecteur-ou-api-embarquée">Connecteur ou API embarquée</h2>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a6eaee58dc466dd07be2ce8db90785c4">1.1 - Embedded : Premier Pas</h1>
    <div class="lead">Intégrer directement dans votre application spring-boot</div>
	<h2 id="installer">Installer</h2>
<p>l&rsquo;utilisation de cette API ne nécessite pas d&rsquo;installation. Il suffit d&rsquo;ajouter les dépendances adequates dans votre projet Maven et définir le repository.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#204a87;font-weight:bold">&lt;dependencies&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;dependency&gt;</span>
      <span style="color:#204a87;font-weight:bold">&lt;groupId&gt;</span>fr.devboxsante.dmp<span style="color:#204a87;font-weight:bold">&lt;/groupId&gt;</span>
      <span style="color:#204a87;font-weight:bold">&lt;artifactId&gt;</span>dmp-api<span style="color:#204a87;font-weight:bold">&lt;/artifactId&gt;</span>
      <span style="color:#204a87;font-weight:bold">&lt;version&gt;</span>4.0<span style="color:#204a87;font-weight:bold">&lt;/version&gt;</span>
      <span style="color:#204a87;font-weight:bold">&lt;scope&gt;</span>compile<span style="color:#204a87;font-weight:bold">&lt;/scope&gt;</span>   
  <span style="color:#204a87;font-weight:bold">&lt;/dependency&gt;</span>

  <span style="color:#204a87;font-weight:bold">&lt;dependency&gt;</span>
      <span style="color:#204a87;font-weight:bold">&lt;groupId&gt;</span>fr.devboxsante.dmp<span style="color:#204a87;font-weight:bold">&lt;/groupId&gt;</span>
      <span style="color:#204a87;font-weight:bold">&lt;artifactId&gt;</span>dmp-spring-boot-starter<span style="color:#204a87;font-weight:bold">&lt;/artifactId&gt;</span>
      <span style="color:#204a87;font-weight:bold">&lt;version&gt;</span>4.0<span style="color:#204a87;font-weight:bold">&lt;/version&gt;</span>
      <span style="color:#204a87;font-weight:bold">&lt;scope&gt;</span>runtime<span style="color:#204a87;font-weight:bold">&lt;/scope&gt;</span>   
  <span style="color:#204a87;font-weight:bold">&lt;/dependency&gt;</span>
<span style="color:#204a87;font-weight:bold">&lt;/dependencies&gt;</span>

<span style="color:#204a87;font-weight:bold">&lt;repositories&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;repository&gt;</span>
      <span style="color:#204a87;font-weight:bold">&lt;id&gt;</span>devcoop-thirdparty<span style="color:#204a87;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#204a87;font-weight:bold">&lt;url&gt;</span>http://repo.dev.coop/nexus/content/repositories/thirdparty/<span style="color:#204a87;font-weight:bold">&lt;/url&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;/repository&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;repository&gt;</span>
      <span style="color:#204a87;font-weight:bold">&lt;id&gt;</span>devcoop-releases<span style="color:#204a87;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#204a87;font-weight:bold">&lt;url&gt;</span>http://repo.dev.coop/nexus/content/repositories/releases<span style="color:#204a87;font-weight:bold">&lt;/url&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;/repository&gt;</span>
<span style="color:#204a87;font-weight:bold">&lt;/repositories&gt;</span>
</code></pre></div><h2 id="écrire-votre-première-intégration">Écrire votre première intégration</h2>
<h3 id="initialisation-du-client">Initialisation du client</h3>
<p>La DevBox-Santé DMP est une application spring, pour obtenir un client DMP, il faut 
injecter dans l&rsquo;application la classe implémentant l&rsquo;interface <code>DMPCClient</code> 
par les mécanismes CDI de spring.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#5c35cc;font-weight:bold">@Component</span>
<span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">MonComposantDMP</span> <span style="color:#ce5c00;font-weight:bold">{</span>

  <span style="color:#5c35cc;font-weight:bold">@Autowired</span>
  <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">DMPCClient</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">;</span>
   
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><h3 id="une-méthode-dans-le-composant">Une méthode dans le composant</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">
<span style="color:#8f5902;font-style:italic">// Initialisation d&#39;un PS auteur des différentes transactions
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">DMPCAuthor</span> <span style="color:#000">ps1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCAuthor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;1234&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Dupont&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Pierre&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">ps1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setRole</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Médecin&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>    
<span style="color:#000">ps1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setStructureNom</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Clinique du beau Soleil&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>

<span style="color:#8f5902;font-style:italic">// Test d&#39;existence (recherche) d&#39;un patient
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">DMPCPatient</span> <span style="color:#000">patient</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">td02Exist</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TD02Request</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;0404312364978044945679&#34;</span><span style="color:#ce5c00;font-weight:bold">)).</span><span style="color:#c4a000">getPatient</span><span style="color:#ce5c00;font-weight:bold">();</span>

<span style="color:#8f5902;font-style:italic">// Initialisation d&#39;un document à soumettre au DMP
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">DMPCDocument</span> <span style="color:#000">document</span> <span style="color:#ce5c00;font-weight:bold">=</span>  <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCDocument</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setTitle</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Titre du document concernant l&#39;hépatite virale&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setContent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Contenu textuel&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addEvent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;B18&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;2.16.840.1.113883.6.3&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Hépatite virale chronique&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setFormat</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCodesFor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ASIPJeuxValeurs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">FORMAT_CODE</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">get</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">1</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">getCode</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#8f5902;font-style:italic">// …
</span><span style="color:#8f5902;font-style:italic"></span>
<span style="color:#8f5902;font-style:italic">// Création de l&#39;enveloppe de soumission 
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">DMPCSubmission</span> <span style="color:#000">submission</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCSubmission</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">submission</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addDocument</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">submission</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPatient</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#8f5902;font-style:italic">// Envoi vers le DMP de la soumission.
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">TD21Response</span> <span style="color:#000">td21Response</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">td21SubmitDocuments</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TD21Request</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">submission</span><span style="color:#ce5c00;font-weight:bold">));</span>
<span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">out</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">println</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Soumission enregistré avec l&#39;uuid :&#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">td21Response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getSubmission</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">getUuid</span><span style="color:#ce5c00;font-weight:bold">());</span>	
</code></pre></div><p>Diagrammme de séquences correspondant</p>
<pre tabindex="0"><code class="language-plantuml" data-lang="plantuml">!include https://bitbucket.org/devbox-sante/plantuml/raw/3/themes/theme-devbox-sante.puml

== Initialisation ==
DMPCClient -&gt; DMPCClient : readCertificates
DMPCClient -&gt; DMPCClient : generate VIHF
DMPCClient -&gt; DMP: init TLS connexion(securise)

== Test d'existence ==
DMPCClient -&gt; DMP : td02Exist(&quot;279035121518989&quot;)
DMP --&gt; DMPCClient : retourne un patient
== Soumission ==
DMPCClient -&gt; DMP : td21SubmitDocuments(new Document(&quot;hepatite virale&quot;)
DMP --&gt; DMPCClient : acknowledge
</code></pre><p>Un projet de démonstration d&rsquo;utilisation de la DevBox-santé DMP en mode embedded se trouve : <a href="https://bitbucket.org/devbox-sante/dmpc-demo">https://bitbucket.org/devbox-sante/dmpc-demo</a></p>
<h3 id="les-différents-objets-du-modèle">Les différents objets du modèle</h3>
<p>Afin de transmettre les métadonnées nécessaires aux DMP pendant les différentes 
transactions, la DevBox-Santé DMP contient un modèle métier dont les classes principales suivantes :</p>
<ul>
<li><code>DMPCCode</code></li>
<li><code>DMPCPersonnelSante</code></li>
<li><code>DMPCPatient</code></li>
<li><code>DMPCDocument</code></li>
<li><code>DMPCSubmission</code></li>
</ul>
<h5 id="dmpccode">DMPCCode</h5>
<p>Un <code>DMPCCode</code> est la structure de base pour toute codification. 
Une fois un <code>DMPCClient</code> initialisé, il est possible d&rsquo;obtenir toutes les 
nomenclatures standard depuis l&rsquo;enum <code>DMPCCode.ASIPJeuxValeurs</code>.</p>
<p>Exemple de récupération d&rsquo;un DMPCCode :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#8f5902;font-style:italic">// Je m&#39;intéresse à la nomenclature SubjectRole
</span><span style="color:#8f5902;font-style:italic"></span>
<span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">roles</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCodesFor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ASIPJeuxValeurs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">SUBJECT_ROLE</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#8f5902;font-style:italic">// liste de tous les codes SubjetRole
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">for</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCCode</span> <span style="color:#000">role</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">roles</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">out</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">println</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;role :&#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">role</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
<span style="color:#8f5902;font-style:italic">// le rôle &#34;médecin&#34; est le 4ème dans la nomenclature actuelle
</span><span style="color:#8f5902;font-style:italic"></span>
<span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#4e9a06">&#34;médecin&#34;</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">equals</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">roles</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">get</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">3</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">getCode</span><span style="color:#ce5c00;font-weight:bold">())</span>

</code></pre></div><h5 id="dmpcpersonnelsante">DMPCPersonnelSante</h5>
<p>Exemple d&rsquo;initialisation d&rsquo;un Personnel de Santé</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000">DMPCPersonnelSante</span> <span style="color:#000">ps1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCPersonnelSante</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">123456</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Durand</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Pierre</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">ps1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setRole</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Médecin&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span> 
<span style="color:#000">ps1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setSpecialite</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;G15_10/SM30&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic">// c&#39;est le 34ème code : client.getCodesFor(DMPCCode.ASIPJeuxValeurs.AUTHOR_SPECIALITY).get(33).getCode() 
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">ps1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setSecteurActivite</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Devcoop Bureau de Léognan&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span> 
<span style="color:#000">ps1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getStructureSante</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">setNom</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;SA43&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>  <span style="color:#8f5902;font-style:italic">// Chercher dans l&#39;annuaire de l&#39;ASIP la valeur correspondant au certificat 
</span></code></pre></div><h5 id="dmpcpatient">DMPCPatient</h5>
<p>Exemple d&rsquo;initialisation d&rsquo;un Patient</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000">DMPCPatient</span> <span style="color:#000">patient</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCPatient</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setInsc</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">insc</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setNom</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Lascar&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPrenom</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Germain&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setSexe</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCSexe</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">M</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setTelephone</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;0987654321&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setDateDeNaissance</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;20131212&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</code></pre></div><h5 id="dmpcdocument">DMPCDocument</h5>
<p>Exemple d&rsquo;initialisation d&rsquo;un Document</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000">DMPCDocument</span> <span style="color:#000">document</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCDocument</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setClassCode</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCodesFor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ASIPJeuxValeurs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">CLASS_CODE</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">get</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">0</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">getCode</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addConfidentiality</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCodesFor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ASIPJeuxValeurs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">CONFIDENTIALITY_CODE</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">get</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">0</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">getCode</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setComments</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;commentDocument&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addEvent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;B18&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;2.16.840.1.113883.6.3&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Hépatite virale chronique&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPracticeSetting</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCodesFor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ASIPJeuxValeurs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">PRACTICE_SETTING_CODE</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">get</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">0</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">getCode</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setServiceStartTime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;20121020174600&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setServiceStopTime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;20121020194600&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setTitle</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;titleDocument&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setType</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCodesFor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ASIPJeuxValeurs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">TYPE_CODE</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">get</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">0</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">getCode</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setCreationTime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;20121020194600&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">;</span>
</code></pre></div><h5 id="dmpcsubmission">DMPCSubmission</h5>
<p>Une soumission peut contenir un ou plusieurs <code>DMPCDocument</code>.</p>
<p>Exemple d&rsquo;initialisation d&rsquo;une soumission</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000">DMPCSubmission</span> <span style="color:#000">template</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCSubmission</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCDocument</span> <span style="color:#000">currentDocument</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">documents</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addDocument</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">currentDocument</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
<span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setComments</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Commentaire Soumission&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setContentType</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCodesFor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ASIPJeuxValeurs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">CONTENT_TYPE_CODE</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">get</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">0</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">getCode</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setTitle</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Soumission&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</code></pre></div><h3 id="initialisation-du-contexte">Initialisation du contexte</h3>
<p>L&rsquo;API étant stateless un contexte doit être rappelé pour chaque transaction vers le DMP.
Un contexte peut être définit de la manière suivante :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000">DMPCContext</span> <span style="color:#000">context</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCContext</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">DMPCPersonnelSante</span> <span style="color:#000">ps1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#8f5902;font-style:italic">// initialisation d&#39;un personnel de santé responsable de la transaction vers le DMP
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setAuthor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ps1</span><span style="color:#ce5c00;font-weight:bold">);</span>
</code></pre></div><p>Exemple d&rsquo;utilisation du contexte dans le cadre d&rsquo;un test d&rsquo;existence</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">td02Exist</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TD02Request</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">));</span>
        
</code></pre></div><h5 id="transactions">Transactions</h5>
<p>L&rsquo;ensemble des transactions sont décrites dans le document <a href="./transactions.html">transactions</a></p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c170416e912bb013bc51892d720b3f51">1.1.1 - Transactions supportées</h1>
    <div class="lead">Contient un exemple d&rsquo;utilisation de l&rsquo;API java des différentes transactions supportées.</div>
	<p>Toutes transactions vers le DMP se fait en précisant un <code>DMPCContext</code> et une requête spécifique en argument d&rsquo;une méthode du <code>DMPCClient</code>.</p>
<p>Le <code>DMPCContext</code> contient les informations permettant de définir : </p>
<ul>
<li>L&rsquo;auteur de la transaction,</li>
<li>Le code de confidentialité de la transaction (connexion secrète, invisible aux représentants légaux du patient)</li>
<li>L&rsquo;autorité des cartes vitales utilisées (réelles ou test)</li>
</ul>
<p>À ce <code>DMPCContext</code> est associé un autre argument dépendant de la transaction réalisée.</p>
<h2 id="mode-dauthentification">Mode d&rsquo;authentification</h2>
<h3 id="directe-depus-version-31">Directe (depus version 3.1)</h3>
<p>En authentification directe, l&rsquo;utilisateur personnel de santé est authentifié par sa carte CPS/CPE, ces informations sont récupérées lors de la lecture de la carte CPS.</p>
<h3 id="indirecte-depuis-version-10">Indirecte (depuis version 1.0)</h3>
<p>En authentification indirecte, seule la structure de santé (par son certificat serveur) est authentifiée.</p>
<p>L&rsquo;auteur de la requête, c&rsquo;est à dire le personnel de santé utilisateur (<code>DMPCPersonnelSante</code>), doit donc être authentifié localement. 
Le système de la structure de santé doit être en mesure d&rsquo;authentifié ses utilisateurs. Cet identifiant local au système doit être spécifié dans <code>DMPCPersonnelSante.internalId</code> même si le rpps est connu.</p>
<p>Lors de la lecture de la Carte Vitale, l&rsquo;intégrateur doit être en mesure de définir la provenance du nir (Réel, Test, Démo) passé en paramètres des différentes requêtes en précisant la valeur <code>DMPCContext.DMPCInsNirAutorite</code>.</p>
<p>Exemple :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000">DMPCContext</span> <span style="color:#000">context</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCContext</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">DMPCPersonnelSante</span> <span style="color:#000">ps</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCPersonnelSante</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">ps</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setInternalId</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;1234567890&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">ps</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setNom</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Forêt&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">ps</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPrenom</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Laurent&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">ps</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setRole</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;10&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic">// Médecin  dans la nomenclature DMPCCode.ASIPJeuxValeurs.SUBJECT_ROLE      
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">ps</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setSpecialite</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;G15_10/SM30&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic">// G15_10/SM30 Néphrologie  dans la nomenclature DMPCCode.ASIPJeuxValeurs.AUTHOR_SPECIALITY
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">ps</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setSecteurActivite</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;SA01&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>  <span style="color:#8f5902;font-style:italic">// Etablissement public de santé dans la nomenclature DMPCCode.ASIPJeuxValeurs.HEALTH_CARE_FACILITY_TYPE_CODE
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">ps</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getStructureSante</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">setNom</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;DEVCOOP Bureau de Léognan&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setAuthor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ps</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setInsNirAutorite</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCContext</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">DMPCInsNirAutorite</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">TEST</span><span style="color:#ce5c00;font-weight:bold">);</span>  <span style="color:#8f5902;font-style:italic">// InsNirAutorite EX_GEN-1520 à préciser lors de tout appel à l&#39;api. 
</span></code></pre></div><h2 id="récupération-des-différents-paramètres-du-dmp">Récupération des différents paramètres du DMP</h2>
<h3 id="getparametres-depuis-version-30">getParametres() (depuis version 3.0)</h3>
<p>Afin de pouvoir récupérer le paramètrage du DMP qui permet de répondre à un certain nombre d&rsquo;exigences notamment les fonctions-gestion-mineurs (EX_GEN-1550). Il faut accéder à la méthode <code>getParametres</code></p>
<p>Exemple :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  <span style="color:#000">DMPCParametres</span> <span style="color:#000">parametres</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dmpcClient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getParametres</span><span style="color:#ce5c00;font-weight:bold">();</span>

  <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">parametres</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">isFonctionsGestionMineurs</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">agePatient</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">parametres</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getAgeMajorite</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#8f5902;font-style:italic">// Attention EX_GEN-1550
</span><span style="color:#8f5902;font-style:italic"></span>  <span style="color:#ce5c00;font-weight:bold">}</span> 
  <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">parametres</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">isProduction</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#8f5902;font-style:italic">// Attention l&#39;environnement est celui de production, 
</span><span style="color:#8f5902;font-style:italic"></span>  <span style="color:#ce5c00;font-weight:bold">}</span>
   
  <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(!</span><span style="color:#000">parametres</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">isCumulInvisiblePatientMasquePs</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
   <span style="color:#8f5902;font-style:italic">// Attention EX_2.1-1050
</span><span style="color:#8f5902;font-style:italic"></span>  <span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><h3 id="getcodesfor-depuis-version-10">getCodesFor() (depuis version 1.0)</h3>
<p>Méthode permettant d&rsquo;accéder aux différents jeux de valeurs imposés par le Guide d&rsquo;intégration.</p>
<p>notamment :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">enum</span> <span style="color:#000">ASIPJeuxValeurs</span> <span style="color:#ce5c00;font-weight:bold">{</span>

        <span style="color:#000">QUALITE_REPRESENTANT_LEGAL</span><span style="color:#ce5c00;font-weight:bold">,</span>
        <span style="color:#000">AUTHOR_SPECIALITY</span><span style="color:#ce5c00;font-weight:bold">,</span>
        <span style="color:#000">CLASS_CODE</span><span style="color:#ce5c00;font-weight:bold">,</span>
        <span style="color:#000">CONFIDENTIALITY_CODE</span><span style="color:#ce5c00;font-weight:bold">,</span>
        <span style="color:#000">CONTENT_TYPE_CODE</span><span style="color:#ce5c00;font-weight:bold">,</span>
        <span style="color:#000">FORMAT_CODE</span><span style="color:#ce5c00;font-weight:bold">,</span>
        <span style="color:#000">HEALTH_CARE_FACILITY_TYPE_CODE</span><span style="color:#ce5c00;font-weight:bold">,</span>
        <span style="color:#000">PRACTICE_SETTING_CODE</span><span style="color:#ce5c00;font-weight:bold">,</span>
        <span style="color:#000">SUBJECT_ROLE</span><span style="color:#ce5c00;font-weight:bold">,</span>
        <span style="color:#000">TYPE_CODE</span><span style="color:#ce5c00;font-weight:bold">,</span>
        <span style="color:#000">RESTRICTION_AUDIENCE_VIHF</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><p>Exemple :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">allPersonnelDeSanteSpecialities</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCodesFor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ASIPJeuxValeurs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">AUTHOR_SPECIALITY</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">allPossibleFormatCodesForADocument</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCodesFor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ASIPJeuxValeurs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">FORMAT_CODE</span><span style="color:#ce5c00;font-weight:bold">);</span>
</code></pre></div><h2 id="transactions-didentification-du-patient">Transactions d&rsquo;identification du patient</h2>
<h3 id="td-00--acquisition-de-lidentité-du-patient-depuis-version-30">TD 0.0 : Acquisition de l&rsquo;identité du patient (depuis version 3.0)</h3>
<p>Cette fonctionnalité permet au LPS d’acquérir l’identité du patient et de déclencher les mécanismes d’identito-vigilance.
Avant le premier accès au DMP d’un patient via les interfaces LPS v2 du système DMP, le LPS :</p>
<ul>
<li>acquiert l’INS et les traits d’identité du patient (cf. RG_0110) via la transaction TD0.0,</li>
<li>déclenche les mécanismes d’identito-vigilance en utilisant les données d’identification du patient fournies par la transaction TD0.0 (cf. RG_0130).</li>
<li>détermine le statut de l’INS du patient (cf. RG_0140).</li>
</ul>
<p>Pour les accès suivants, le LPS acquiert l’INS du patient stocké en base locale.</p>
<p>Exemple :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">TD00Request</span> <span style="color:#000">td00Request</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TD00Request</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">td00Request</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setDateNaissance</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;2011-06-07&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">td00Request</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setNirOuvrantDroit</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCNir</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;211066322074514&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span>
<span style="color:#000">td00Request</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setNirIndividu</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCNir</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;150060475546974&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span>
<span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">TD00Response</span> <span style="color:#000">td00Response</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">td00Identity</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">td00Request</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">td00Response</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">throw</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">RuntimeException</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;L&#39;ayant droit n&#39;existe pas&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><h3 id="td02--test-dexistence-du-dmp-dun-patient-et-vérification-de-lautorisation-daccès--depuis-version-10">TD0.2 : test d’existence du DMP d’un patient et vérification de l’autorisation d’accès  (depuis version 1.0)</h3>
<p>Cette transaction permet de tester l&rsquo;existence d&rsquo;un DMP et de vérifier les autorisations d&rsquo;accès ainsi que de récupérer les informations concernant la création du compte patient.</p>
<p>De là peut en découler des actions de créations de DMP, de création de compte internet, ou bien encore de connaître la raison d&rsquo;une interdiction d&rsquo;accès</p>
<p>Exemple :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000">TD02Response</span> <span style="color:#000">response</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">td02Exist</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TD02Request</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;211066322074514&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span>
<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getAutorisation</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">equals</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">EXPIRE</span><span style="color:#ce5c00;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#8f5902;font-style:italic">// prévoir une client.td03AddAuthorization()
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getAutorisation</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">equals</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">INTERDIT</span><span style="color:#ce5c00;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#8f5902;font-style:italic">// le PS ne peut accéder au DMP
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">String</span> <span style="color:#000">raison</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getRaison</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getAutorisation</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">equals</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">NON_EXISTE</span><span style="color:#ce5c00;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#8f5902;font-style:italic">// prévoir une client.td03AddAuthorization()
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getAutorisation</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">equals</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">VALIDE</span><span style="color:#ce5c00;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(!</span><span style="color:#000">response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCompteInternetOuvert</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#8f5902;font-style:italic">// prévour une client.td15aCreerAccesInternetPatient()
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#ce5c00;font-weight:bold">}</span>
    <span style="color:#8f5902;font-style:italic">// contient les informations patient stockées dans leDMP
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">DMPCPatient</span> <span style="color:#000">dmpPatient</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getPatient</span><span style="color:#ce5c00;font-weight:bold">();</span>
    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getRole</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">equals</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCRole</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">MEDECIN_TRAITANT</span><span style="color:#ce5c00;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#8f5902;font-style:italic">// le PS author est le médecint traitant
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#ce5c00;font-weight:bold">}</span> 
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><h3 id="td03-modifier-lautorisation-daccès-etou-le-statut-médecin-traitant-dmp-ou-passer-en-mode-daccès--bris-de-glace--depuis-version-20">TD0.3 : modifier l’autorisation d’accès et/ou le statut médecin traitant DMP ou passer en mode d’accès « bris de glace » (depuis version 2.0)</h3>
<p>Le LPS permet à l’utilisateur les actions suivantes.</p>
<ul>
<li>Ajouter une autorisation d’accès au DMP du patient ou passer en mode d’accès « bris de glace ». Cf. DMP_0.3a.</li>
<li>Supprimer une autorisation d’accès au DMP du patient. Cf. DMP_0.3b.</li>
<li>Modifier le statut médecin traitant DMP. Cf. DMP_0.3c.</li>
</ul>
<p>Exemple : </p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">td03AddAuthorization</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TD03Request</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;211066322074514&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">DMPCRole</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">STANDARD</span><span style="color:#ce5c00;font-weight:bold">));</span>
<span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">td03RemoveAuthorization</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TD03Request</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getIns</span><span style="color:#ce5c00;font-weight:bold">(),</span> <span style="color:#000">DMPCRole</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">STANDARD</span><span style="color:#ce5c00;font-weight:bold">));</span>
<span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">td03AddAuthorization</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TD03Request</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getIns</span><span style="color:#ce5c00;font-weight:bold">(),</span> <span style="color:#000">DMPCRole</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">MEDECIN_TRAITANT</span><span style="color:#ce5c00;font-weight:bold">));</span>
</code></pre></div><h3 id="td04">TD0.4</h3>
<p>Non requis pour le DMP</p>
<h3 id="td05">TD0.5</h3>
<p>Non requis pour le DMP</p>
<h3 id="td11--créer-un-dmp-depuis-version-20">TD1.1 : créer un DMP (depuis version 2.0)</h3>
<p>Cette fonctionnalité permet de créer le DMP d’un patient.
Le LPS :</p>
<ul>
<li>contrôle les prérequis à la création du DMP du patient (cf. RG_1010),</li>
<li>acquiert les données administratives du patient (cf. RG_1020),</li>
<li>acquiert le statut du DMP à créer (cf. RG_1030),</li>
<li>acquiert l’adresse postale du patient (cf. RG_1040),</li>
<li>acquiert la date de naissance du patient (cf. RG_1050),</li>
<li>acquiert les données concernant le représentant légal du patient (cf. RG_1060),</li>
<li>acquiert le consentement du patient à la création de son DMP (cf. RG_1070),</li>
<li>acquiert la demande d’ajout du statut médecin traitant DMP (cf. RG_1080),</li>
<li>acquiert le consentement du patient à l’accès à son DMP en mode « bris de glace » et en mode « centre de régulation » (cf. RG_1090),</li>
<li>crée le DMP du patient (cf. RG_1100 et TD1.1),</li>
<li>ajoute statut médecin traitant DMP (cf. RG_1110 et TD0.3),</li>
<li>acquiert la demande d’activation du compte internet du patient ou déclenche automatiquement l’activation du compte internet du patient (cf. RG_1120),</li>
<li>Génére un « document d’accusé de création du DMP » en l’absence d’activation du compte internet du patient (cf. RG_1130).</li>
</ul>
<p>Exemple :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#8f5902;font-style:italic">// td00 requise avant création d&#39;un DMP
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">TD00Request</span> <span style="color:#000">td00Request</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TD00Request</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">td00Request</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setDateNaissance</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;2011-06-07&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">td00Request</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setNirOuvrantDroit</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCNir</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;211066322074514&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span>
<span style="color:#000">td00Request</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setNirIndividu</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCNir</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;150060475546974&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span>
<span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">TD00Response</span> <span style="color:#000">td00Response</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">td00Identity</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">td00Request</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">td00Response</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">throw</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">RuntimeException</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;L&#39;ayant droit n&#39;existe pas&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#ce5c00;font-weight:bold">}</span>

<span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">DMPCCarteVitaleInfo</span> <span style="color:#000">carteVitaleInfo</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCCarteVitaleInfo</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">carteVitaleInfo</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setDateNaissance</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">td00Response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getInfoPatient</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">getDateNaissance</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">substring</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">2</span><span style="color:#ce5c00;font-weight:bold">));</span>
<span style="color:#000">carteVitaleInfo</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setNomPatronymique</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">td00Response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getInfoPatient</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">getNomPatronymique</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">carteVitaleInfo</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setNomUsuel</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">td00Response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getInfoPatient</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">getNomPatronymique</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">carteVitaleInfo</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPrenom</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">td00Response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getInfoPatient</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">getPrenom</span><span style="color:#ce5c00;font-weight:bold">());</span>

<span style="color:#000">TD11Request</span> <span style="color:#000">td11Request</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TD11Request</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">td11Request</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setCarteVitaleInfo</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">carteVitaleInfo</span><span style="color:#ce5c00;font-weight:bold">);</span>

<span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setOrdreDeNaissance</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">1</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setNomUsuel</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;PATB-TROIS&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>

<span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">DMPCAdresse</span> <span style="color:#000">adresse</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCAdresse</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">adresse</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setCodePostal</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;33850&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">adresse</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setLigneAdresse</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;22 rue des édelweiss&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">adresse</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setComplementAdresse</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;complément d&#39;adresse&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">adresse</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setVille</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;LEOGNAN&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">adresse</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPays</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;FRANCE&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setAdresse</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">adresse</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setCivilite</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;M&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setEmail</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;PATB-TROIS@devcoop.fr&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setMobile</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;0663285980&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPaysDeNaissance</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;FRANCE&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setSexe</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCSexe</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">M</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setTelephone</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;0663285980&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">DMPCRepresentantLegal</span> <span style="color:#000">representantLegal</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCRepresentantLegal</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">representantLegal</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setAdresse</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">adresse</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">representantLegal</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setCivilite</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;M&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">representantLegal</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setEmail</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;PATB-TROIS-REPRESENTANT@devcoop.fr&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">representantLegal</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setMobile</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;0663285980&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">representantLegal</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setTelephone</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;0663285980&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">representantLegal</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setNom</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getNomPatronymique</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">representantLegal</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPrenom</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Representant Legal&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">representantLegal</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setQualite</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCodesFor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ASIPJeuxValeurs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">QUALITE_REPRESENTANT_LEGAL</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">get</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">1</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">getCode</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setRepresentantLegal</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">representantLegal</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">td11Request</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPatient</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">td11Request</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setConsentementOuverture</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">td11Request</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setOppositionBrisDeGlace</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">td11Request</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setOppositionUrgence</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#ce5c00;font-weight:bold">);</span>

<span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">TD11Response</span> <span style="color:#000">td11Response</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">td11CreationDmp</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">td11Request</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">DMPCPatient</span> <span style="color:#000">dmpPatient</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">td11Response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getPatient</span><span style="color:#ce5c00;font-weight:bold">();</span> <span style="color:#8f5902;font-style:italic">// patient retourné par le DMP
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">Files</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">write</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">td11Response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getFormulairePatient</span><span style="color:#ce5c00;font-weight:bold">(),</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">File</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;./documentAccuseCreation.pdf&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span> <span style="color:#8f5902;font-style:italic">// fichier PDF contenant le document des secrets
</span></code></pre></div><h3 id="td15-créer-ou-mettre-à-jour-le-compte-internet-du-patient-depuis-version-20">TD1.5 : créer ou mettre à jour le compte internet du patient (depuis version 2.0)</h3>
<p>La fonctionnalité DMP_1.5 permet :</p>
<ul>
<li>de créer le compte internet du patient afin que celui-ci puisse se connecter sur son DMP (DMP_1.5a),</li>
<li>d’ajouter ou modifier ou supprimer un canal OTP (One Time Password - code d’accès à usage unique) (DMP_1.5b),</li>
<li>de débloquer le compte internet patient et de régénérer les paramètres de connexion du patient (DMP_1.5d).</li>
</ul>
<p>Exemple :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000">DMPCPatient</span> <span style="color:#000">patient</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">createDMP</span><span style="color:#ce5c00;font-weight:bold">();</span>
        
<span style="color:#8f5902;font-style:italic">// Création de l&#39;accès internet
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">TD15aRequest</span> <span style="color:#000">aRequest</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TD15aRequest</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">aRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPatient</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">aRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setEmail</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;laurent.foret@dev.coop&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">TD15aResponse</span> <span style="color:#000">response</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">td15aCreerAccesInternetPatient</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">aRequest</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">Files</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">write</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getFormulairePatient</span><span style="color:#ce5c00;font-weight:bold">(),</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">File</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;./target/documentDesSecrets.pdf&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span>

<span style="color:#8f5902;font-style:italic">// Ajout d&#39;un canal OTP
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">TD15bRequest</span> <span style="color:#000">bRequest</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TD15bRequest</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">bRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setIns</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getIns</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">bRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setTelephone</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;0663285980&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">td15bAddCanalOTP</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">bRequest</span><span style="color:#ce5c00;font-weight:bold">);</span>

<span style="color:#8f5902;font-style:italic">// Suppression d&#39;un canal OTP
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">bRequest</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TD15bRequest</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">bRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setIns</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getIns</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">bRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setEmail</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;laurent.foret@dev.coop&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">td15bRemoveCanalOTP</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">bRequest</span><span style="color:#ce5c00;font-weight:bold">);</span>

<span style="color:#8f5902;font-style:italic">// Déblocage accès internet patient
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">TD15cRequest</span> <span style="color:#000">dRequest</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TD15cRequest</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">dRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPatient</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">TD15cResponse</span> <span style="color:#000">response</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">td15dDeblocageAccesInternetPatient</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">dRequest</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">Files</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">write</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getFormulairePatient</span><span style="color:#ce5c00;font-weight:bold">(),</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">File</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;./target/documentDesSecrets15d110.pdf&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span>

</code></pre></div><h2 id="alimentation">Alimentation</h2>
<p>Le profil alimentation du DMP se fait au travers de transaction XDS (<a href="https://wiki.ihe.net/index.php/Cross-Enterprise_Document_Sharing">https://wiki.ihe.net/index.php/Cross-Enterprise_Document_Sharing</a>) supportée par le serveur DMP ainsi que par la DevBox-Santé DMP.</p>
<p>Les transactions XDS permettent de soumettre des documents au format CDA (<a href="https://www.hl7.org/implement/standards/product_brief.cfm?product_id=7">https://www.hl7.org/implement/standards/product_brief.cfm?product_id=7</a>) supporté également par le DMP et la DevBox-Santé DMP.</p>
<p>La DevBox-Santé DMP présente un modèle simplifé des informations demandées et s&rsquo;occupe de la cohérence des métadonnées des transactions XDS d&rsquo;avec les métadonnées <a href="../CDA/structurationMinimale.html">des documents CDA</a> )</p>
<h3 id="td21--alimenter-le-dmp-dun-patient-avec-des-documents-depuis-version-10">TD2.1 : alimenter le DMP d’un patient avec des documents (depuis version 1.0)</h3>
<p>Cette fonctionnalité permet d’alimenter le DMP d’un patient avec un ou plusieurs nouveaux documents :</p>
<ul>
<li>décrits sous la forme de documents CDA et de métadonnées XDS,</li>
<li>et transmis au système DMP sous la forme d’un lot de soumission XDS signé (XAdES).</li>
</ul>
<p>La cinématique générale est la suivante.
Le PS constitue le ou les document(s) dans le LPS . 
Le LPS :</p>
<ul>
<li>construit le ou les document(s)
<ul>
<li>construit le document au format CDA ==&gt; action réalisée par la DevBox-Santé DMP</li>
<li>alimente les métadonnées XDS  ==&gt; action réalisée par la DevBox-Santé DMP</li>
</ul>
</li>
<li>constitue un lot de soumission XDS et signe ce lot (XAdES) ==&gt; action réalisée par la DevBox-Santé DMP</li>
<li>soumet le lot de documents au système DMP  ==&gt; action réalisée par la DevBox-Santé DMP</li>
</ul>
<p>Le LPS intégrateur de la DevBox-Santé DMP doit seulement fournir les valeurs des différentes métadonnées liées aux documents et à la soumission par l&rsquo;intermédiaire d&rsquo;un modèle simplifié :</p>
<p>Exemple :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#8f5902;font-style:italic">//   création du document
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">DMPCDocument</span> <span style="color:#000">document</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCDocument</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addConfidentiality</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;N&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>  <span style="color:#8f5902;font-style:italic">// dans la nomenclature DMPCCode.ASIPJeuxValeurs.CONFIDENTIALITY_CODE
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setComments</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Commentaire du Document&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addEvent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;B18&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;2.16.840.1.113883.6.3&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Hépatite virale chronique&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPracticeSetting</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;AMBULATOIRE&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setServiceStartTime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">maintenant</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">toString</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setServiceStopTime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">maintenant</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">toString</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setTitle</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Titre du Document&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setType</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;11488-4&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic">// dans la nomenclature DMPCCode.ASIPJeuxValeurs.TYPE_CODE
</span><span style="color:#8f5902;font-style:italic">// document.setClassCode(&#34;&#34;); // non nécessaire car déduit du type code pour la liste des valeurs possibles aller dans la nomenclature DMPCCode.ASIPJeuxValeurs.CLASS_CODE
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setCreationTime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">maintenant</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">toString</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setFormat</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;urn:ihe:iti:xds-sd:pdf:2008&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>  <span style="color:#8f5902;font-style:italic">// dans la nomenclature DMPCCode.ASIPJeuxValeurs.FORMAT_CODE
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">InputStream</span> <span style="color:#000">input</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getClass</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">getClassLoader</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">getResourceAsStream</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;1.pdf&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#204a87;font-weight:bold">byte</span><span style="color:#ce5c00;font-weight:bold">[]</span> <span style="color:#000">content</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#204a87;font-weight:bold">byte</span><span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#000">input</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">available</span><span style="color:#ce5c00;font-weight:bold">()];</span>
<span style="color:#000">ByteStreams</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">readFully</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">input</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">content</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setContent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">content</span><span style="color:#ce5c00;font-weight:bold">);</span>

<span style="color:#8f5902;font-style:italic">//    création de la soumission 
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">DMPCSubmission</span> <span style="color:#000">submission</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCSubmission</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">submission</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPatient</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">submission</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setComments</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Commentaire Soumission du document&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">submission</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setContentType</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;04&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">submission</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setTitle</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Soumission du document&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#8f5902;font-style:italic">//   ajout du document dans la soumission
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">submission</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addDocument</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">);</span>

<span style="color:#8f5902;font-style:italic">//   envoi de la soumission
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">TD21Response</span> <span style="color:#000">td21Response</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">td21SubmitDocuments</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TD21Request</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">submission</span><span style="color:#ce5c00;font-weight:bold">));</span>
<span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">out</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">println</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Soumission enregistré avec l&#39;uuid :&#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">td21Response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getSubmission</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">getUuid</span><span style="color:#ce5c00;font-weight:bold">());</span>

<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCDocument</span> <span style="color:#000">submittedDocument</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">td21Response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getSubmission</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">getDocuments</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">out</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">println</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">format</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Contenant le document ayant pour uniqueId : %s et uuid : %s&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span>
            <span style="color:#000">submittedDocument</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getUniqueId</span><span style="color:#ce5c00;font-weight:bold">(),</span> <span style="color:#000">submittedDocument</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getEntryUuid</span><span style="color:#ce5c00;font-weight:bold">()));</span>
    <span style="color:#000">document</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">submittedDocument</span><span style="color:#ce5c00;font-weight:bold">;</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><p>Pour une soumission de plusieurs documents, il suffit d&rsquo;ajouter les documents à la soumission :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000">submission</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addDocument</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">document1</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">submission</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addDocument</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">document2</span><span style="color:#ce5c00;font-weight:bold">);</span>
</code></pre></div><h3 id="td31--depuis-version-32">TD3.1 : (depuis version 3.2)</h3>
<p>Il est possible de faire des recherches de document ainsi que des recherches des documentation</p>
<h3 id="td31b--rechercher-lidentifiant-technique-dun-document-depuis-version-30">TD3.1b : rechercher l’identifiant technique d’un document (depuis version 3.0)</h3>
<p>Cette fonctionnalité permet, aux LPS qui n’implémentent pas DMP_3.1a, de rechercher l’identifiant technique d’un document (dans le système DMP) à partir de l’identifiant local au LPS de ce document.
Le LPS peut ensuite supprimer (DMP_3.3c), archiver (DMP_3.3d) ou remplacer un document dans le DMP du patient (DMP_2.1/2.2b).</p>
<p>Exemple :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000">String</span> <span style="color:#000">previousDocumentUniqueId</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">...;</span> <span style="color:#8f5902;font-style:italic">// uniqueId d&#39;un document envoyé précédemment dans le DMP 
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">TD31bRequest</span> <span style="color:#000">td31bRequest</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TD31bRequest</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">td31bRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setDocumentUniqueId</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">previousDocumentUniqueId</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">td31bRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setIns</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getIns</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">TD31bResponse</span> <span style="color:#000">response</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">td31bGetDocumentEntry</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">td31bRequest</span><span style="color:#ce5c00;font-weight:bold">);</span>

<span style="color:#8f5902;font-style:italic">// uuid du document courant stocké dans le DMP
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">String</span> <span style="color:#000">documentCurrentUuid</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">response</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getDocumentUuid</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#8f5902;font-style:italic">// permet le remplacement de document avec une td21submit document ou encore une td33cUnpublished.
</span></code></pre></div><p>Exemple de remplacement de document après recherche dans le DMP :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#8f5902;font-style:italic">// récupération du uuid du document courant dans le DMP
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">TD31bRequest</span> <span style="color:#000">td31bRequest</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TD31bRequest</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">td31bRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setDocumentUniqueId</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">uniqueIdDuDocumentAremplacer</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">td31bRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setIns</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getIns</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">TD31bResponse</span> <span style="color:#000">td31bresponse</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">td31bGetDocumentEntry</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">td31bRequest</span><span style="color:#ce5c00;font-weight:bold">);</span>

<span style="color:#8f5902;font-style:italic">// création de la soummission pour le remplacement
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">DMPCSubmission</span> <span style="color:#000">submissionRemplace</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">...;</span>
<span style="color:#000">DMPCDocument</span> <span style="color:#000">documentRemplace</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">...;</span>
<span style="color:#8f5902;font-style:italic">// ajout des informations de remplacement dans le document qui remplace
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">documentRemplace</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setReplacementOf</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">td31bresponse</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getDocumentUuid</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">documentRemplace</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setReplacementOfUniqueId</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">documentE</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getUniqueId</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">submissionRemplace</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setTitle</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;remplacement du document E&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#8f5902;font-style:italic">// envoie de la soummission
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">td21SubmitDocuments</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TD21Request</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">submissionRemplaceE</span><span style="color:#ce5c00;font-weight:bold">));</span>
</code></pre></div><h3 id="td33c--supprimer-un-document-depuis-version-10">TD33c : Supprimer un document (depuis version 1.0)</h3>
<p>Cette fonctionnalité permet à l’utilisateur de supprimer un document dans le DMP d’un patient.
La cinématique générale est la suivante :</p>
<ul>
<li>L’utilisateur indique qu’il souhaite supprimer le document sélectionné.</li>
<li>L’utilisateur confirme l’action demandée.</li>
<li>Le LPS envoie une requête de mise à jour des attributs d’un document au système DMP</li>
</ul>
<p>Exemple :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000">TD33CRequest</span> <span style="color:#000">td33cRequest</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TD33CRequest</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">td33cRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setDocumentUuid</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">uniqueIdDuDocumentASupprimer</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">td33cRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setIns</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">patient</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getIns</span><span style="color:#ce5c00;font-weight:bold">());</span> 
<span style="color:#000">td33cRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setContentType</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">contentTypeDuDocumentASupprimer</span><span style="color:#ce5c00;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic">// le contentType est le même que pour une soumission de document.
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">td33cUnpublished</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">td33cRequest</span><span style="color:#ce5c00;font-weight:bold">);</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4423c3215e74e0e25f5fff050e59e190">1.1.2 - Howtos</h1>
    <div class="lead">Contient les tutoriels utiles à la bonne intégration de la DevBox-Santé DMP</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-6ffcffba36ec8ebb25c07b22f823247f">1.1.2.1 - UniqueIdGenerator</h1>
    <div class="lead">[Alimentation] Génération des UniqueId</div>
	<p>Afin d&rsquo;être totalement conforme à l’exigence EX_2.1-1130.</p>
<blockquote>
<p>Chaque document et lot de document(s) produit par un LPS doit être identifié par un identifiant universel (champ XDS uniqueId au format OID) :</p>
<ul>
<li>
<p>soit le uniqueId est généré à partir d’un UUID (sous la branche OID 2.25), dans ce cas cet OID doit être stocké dans le LPS pour les recherches / remplacements futurs via ce même LPS ;</p>
</li>
<li>
<p>soit le uniqueId est généré à partir d’une racine propre à l’installation du LPS et d’un élément « variable » mais unique vis-à-vis de la racine de l’instance du LPS installée (par exemple horodatage, ou identifiant interne du document dans le LPS) ; il incombe au LPS de pouvoir retrouver ce uniqueId pour les recherches / remplacements futurs via ce même LPS (par exemple en stockant le uniqueId ainsi généré, ou la partie variable uniquement à condition de savoir reconstruire le uniqueId complet).</p>
</li>
</ul>
</blockquote>
<p>La DMPC-API fournit les deux implémentations demandées dans cette exigence. C&rsquo;est à l&rsquo;intégrateur de la choisir.</p>
<h2 id="basé-sur-la-source">Basé sur la Source</h2>
<p>L&rsquo;implémentation par défaut est basée sur les paramètres de la source. Elle est conforme au deuxième point de l&rsquo;exigence :</p>
<p>La source est définie par les deux paramètres de l'<code>application.yml</code> :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#204a87;font-weight:bold">dmpc</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">source</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># 1.2.250.1.287 est l&#39;OID de Devcoop</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># 1.2.250.1.287.1 est l&#39;OID correspondant à la DMPC pour Devcoop</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">idRoot</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1.2.250.1.287.1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">idExtension</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1234567</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>L&rsquo;implémentation ressemble à cela :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#8f5902;font-style:italic">/**
</span><span style="color:#8f5902;font-style:italic">* Implémentation par défaut basé sur les informations du logiciel @see fr.devboxsante.dmp.core.Source
</span><span style="color:#8f5902;font-style:italic">*  * un compteur
</span><span style="color:#8f5902;font-style:italic">*  * et le temps en ms
</span><span style="color:#8f5902;font-style:italic">*/</span>
<span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">static</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Default</span> <span style="color:#204a87;font-weight:bold">implements</span> <span style="color:#000">UniqueIdGenerator</span> <span style="color:#ce5c00;font-weight:bold">{</span>

        <span style="color:#ce5c00;font-weight:bold">...</span>
        <span style="color:#5c35cc;font-weight:bold">@Override</span>
        <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">Id</span> <span style="color:#000">generate</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">IdBuilder</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">setRoot</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">source</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ToOID</span><span style="color:#ce5c00;font-weight:bold">()).</span><span style="color:#c4a000">setExtension</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">currentTimeMillis</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34;.&#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">cpt</span><span style="color:#ce5c00;font-weight:bold">++)).</span><span style="color:#c4a000">toId</span><span style="color:#ce5c00;font-weight:bold">();</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><h2 id="basée-sur-luuid">Basée sur l&rsquo;UUID</h2>
<p>Il est possible d’utiliser une autre implémentation proposée par la DMPC-API pour utiliser l’OID UUID : &ldquo;2.25&rdquo; . Cette implémentation est conforme à la première méthode de l&rsquo;exigence.</p>
<p>Il suffit de configurer un bean implémentant <code>UniqueIdGenerator</code>, de la manière suivante:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#5c35cc;font-weight:bold">@Configuration</span>
 <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">MyOwnDmpcApiConfiguration</span> <span style="color:#ce5c00;font-weight:bold">{</span>

    <span style="color:#5c35cc;font-weight:bold">@Bean</span>
    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">UniqueIdGenerator</span> <span style="color:#000">idGenerate</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">UniqueIdGenerator</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">WithUuid</span><span style="color:#ce5c00;font-weight:bold">();</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><h2 id="implémentée-par-lintégrateur">Implémentée par l&rsquo;intégrateur</h2>
<p>Il est néanmoins possible de générer ses UniqueId, l&rsquo;intégrateur devra donc proposer sa propre implémentation du <code>UniqueIdGenerator</code> et de l&rsquo;ajouter à sa configuration spring .</p>
<p>Attention : Elle devra être conforme à l&rsquo;une des deux exigences mentionnées ci-dessus.</p>
<p>Exemple :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#5c35cc;font-weight:bold">@Configuration</span>
 <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">MyOwnDmpcApiConfiguration</span> <span style="color:#ce5c00;font-weight:bold">{</span>

    <span style="color:#5c35cc;font-weight:bold">@Bean</span>
    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">UniqueIdGenerator</span> <span style="color:#000">idGenerate</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">MyOwnImplementationOfUniqueIdGenerator</span><span style="color:#ce5c00;font-weight:bold">();</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><p>‌</p>
<p>‌</p>

</div>



    
	
  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c239923082dc512921f012c4f292b15d">1.2 - REST Proxy</h1>
    <div class="lead">Les transactions du DMP en mode REST</div>
	<p>Le proxy REST embarque l&rsquo;API java dans une application REST spring-boot, elle accepte des requetes simples JSON et les retransmet 
au DMP dans le bon formalisme et dans le respect des différentes transactions,  il interprète les réponses du serveur DMP et les retourne au client initial dans
un formalisme simplifié.</p>
<h3 id="intégration-sur-un-environnement-de-démonstration">Intégration sur un environnement de démonstration</h3>
<p>Vous pouvez commencer à intégrer la DevBox-Santé DMP depuis l&rsquo;environnement de démonstration.</p>
<p>Pour cela vous pouvez :</p>
<ul>
<li>consulter toute la documentation <a href="https://dmpc-demo.devbox-sante.fr/swagger-ui.html">REST de l&rsquo;API</a></li>
<li>utiliser la collection Postman : 
<a target="_blank" href="https://app.getpostman.com/run-collection/a66f5c37dd5f8dd67018"><img alt="Run In postman" src="https://run.pstmn.io/button.svg"></a></li>
</ul>
<blockquote>
<p>Attention : seule l&rsquo;authentification indirecte est supportée dans un environnement cloud.</p>
</blockquote>
<h3 id="déploiement-avec-un-java-runtime-environnement">Déploiement avec un Java Runtime Environnement</h3>
<p>Pour démarrer le serveur, depuis une ligne de commande exécuter :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">java -Dspring.config.location<span style="color:#ce5c00;font-weight:bold">=</span>application.yml -jar dmpc-proxy-rest.jar
</code></pre></div><p>Au lancement du serveur est chargé un fichier de configuration <code>application.yml</code> permettant de 
charger différents KeyStore les informations concernant le LPS et le serveur DMP.
Il est initialisé par défaut sur un environnement de test.</p>
<p>Une fois démarré, le serveur est accessible à l&rsquo;url suivante : <a href="http://127.0.0.1:8080/proxy">http://127.0.0.1:8080/proxy</a></p>
<p>Pour obtenir, le schéma Swagger : <a href="http://127.0.0.1:8080/swagger-ui.html">http://127.0.0.1:8080/swagger-ui.html</a></p>
<p><img src="./dmpcProxyRest-SwaggerUI.png" alt="Exemple schéma Swagger pour la DevBox-Santé DMP en mode REST"></p>
<h3 id="utilisation-de-linstaller-devbox-santé">Utilisation de l&rsquo;installer DevBox-Santé</h3>
<p>La DevBox Santé propose des solutions de &ldquo;packaging&rdquo; des différents modules, pour Windows, MacOS et Linux.</p>
<p>Pour tester ces solutions <a href="mailto:devbox-sante@devcoop.fr">Contactez-nous</a></p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-16f164740bcf3b4b7dd9b403e13c7878">1.3 - SOAP Proxy</h1>
    <div class="lead">Les transactionts du DMP en mode SOAP simplifié</div>
	<p>L&rsquo;architecture du proxy WS peut être représentée par ce schéma :</p>
<pre tabindex="0"><code class="language-plantuml" data-lang="plantuml">!include https://bitbucket.org/devbox-sante/plantuml/raw/3/themes/theme-devbox-sante.puml

node &quot;Systeme Information Hospitalier / Logiciel de Gestion de Cabinet&quot; {
    component &quot;LogicielIntegrateur&quot; as LogicielIntegrateur
    component &quot;JVM SpringBoot&quot; {
        component &quot;DevBox-santé&quot; as DMPC_Proxy DEVBOX_COLOR {
            component &quot;DevBox-Santé DMP&quot; as DMPC_API DMP_COLOR
        }
    }
}
Actor PersonnelSante
Cloud &quot;**DMP**&quot; as DMP
LogicielIntegrateur  -r-&gt; DMPC_Proxy : WS simplifie
PersonnelSante -down-&gt; LogicielIntegrateur
DMPC_API -r-&gt; DMP : WS securise conforme aux transactions du guide d'integration.
</code></pre><h2 id="serveur-proxy">Serveur Proxy</h2>
<p>le proxy WS est un programme java qui reçoit les requetes simples et les retransmet 
au DMP dans le bon formalisme et dans le respect des différentes transactions, 
il interprète les réponses du serveur DMP et les retourne au client initial dans
un formalisme simplifié.</p>
<p>Pour démarrer le serveur, depuis une ligne de commande exécuter :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">java -Dspring.config.location<span style="color:#ce5c00;font-weight:bold">=</span>application.yml -jar dmpc-proxy-ws.jar
</code></pre></div><p>Au lancement du serveur est chargé un fichier de configuration <code>application.yml</code> permettant de 
charger différents KeyStore les informations concernant le LPS et le serveur DMP.
Il est initialisé par défaut sur un environnement de test.</p>
<p>Une fois démarré, le serveur est accessible à l&rsquo;url suivante : <a href="http://127.0.0.1:9999/dmpcProxy">http://127.0.0.1:9999/dmpcProxy</a></p>
<p>Pour obtenir, le schéma wsdl, il suffit de suffixer l&rsquo;url par &ldquo;?wsdl&rdquo; : <a href="http://127.0.0.1:9999/dmpcProxy?wsdl">http://127.0.0.1:9999/dmpcProxy?wsdl</a></p>
<h2 id="le-client">Le Client</h2>
<p>Le code ci dessous est donnée à titre d&rsquo;exemple de client en Java utilisant CXF, 
il montre  l&rsquo;usage possible des différents web services fournis.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#8f5902;font-style:italic">// Création du client WS 
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">JaxWsProxyFactoryBean</span> <span style="color:#000">factory</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">JaxWsProxyFactoryBean</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">factory</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getInInterceptors</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">LoggingInInterceptor</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">factory</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getOutInterceptors</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">LoggingOutInterceptor</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">factory</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setServiceClass</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCProxy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">class</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">factory</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setAddress</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;http://127.0.0.1:9999/dmpcProxy&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">DMPCProxy</span> <span style="color:#000">proxyService</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCProxy</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#000">factory</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">create</span><span style="color:#ce5c00;font-weight:bold">();</span>

<span style="color:#8f5902;font-style:italic">// Création du contexte qui sera utilisé tout le long de la conversation avec le proxy.
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">DMPCContext</span> <span style="color:#000">context</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCContext</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;user&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;password&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>         
<span style="color:#000">DMPCAuthor</span> <span style="color:#000">author</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCAuthor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;internalId&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Durand&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Pierre&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setAuthor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">author</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">author</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setRole</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">proxyService</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCodesFor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ASIPJeuxValeurs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">SUBJECT_ROLE</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">get</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">3</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">getCode</span><span style="color:#ce5c00;font-weight:bold">());</span> <span style="color:#8f5902;font-style:italic">// Médecin       
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">author</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setSpecialite</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">proxyService</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCodesFor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ASIPJeuxValeurs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">AUTHOR_SPECIALITY</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">get</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">33</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">getCode</span><span style="color:#ce5c00;font-weight:bold">());</span> <span style="color:#8f5902;font-style:italic">// G15_10/SM30 Néphrologie 
</span><span style="color:#8f5902;font-style:italic">// secteurActivite est obtenu aupres de l&#39;annuaire gip-cps plus d&#39;infos sur documentation configurationServeurProxy
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">author</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setSecteurActivite</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">proxyService</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCodesFor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ASIPJeuxValeurs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">HEALTH_CARE_FACILITY_TYPE_CODE</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">get</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">40</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">getCode</span><span style="color:#ce5c00;font-weight:bold">());</span>  <span style="color:#8f5902;font-style:italic">// ici c&#39;est SA41                
</span></code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f917524b2d2c07e82c769ba5201dd372">1.4 - Authentifications</h1>
    <div class="lead">Les différentes mécanismes d&rsquo;authentifications et architectures possibles avec le DMP</div>
	<h2 id="introduction">Introduction</h2>
<p>Une des difficultés d&rsquo;intégration avec le DMP consiste à établir une connexion SSL (TLS) en authentification <strong>mutuelle</strong> avec le DMP.
Contrairement aux connexions SSL classiques que nous pouvons avoir avec n&rsquo;importe quel site, non seulement le DMP doit prouver son identité mais aussi le client qui s&rsquo;y connecte.</p>
<p>Cela signifie que l&rsquo;opération Certificate Verify dans le schéma doit être réalisé :</p>
<p><img src="SSL_authentification_mutuelle.png" alt="SSL_authentification_mutuelle"></p>
<p>Cette étape consiste à ce que le client signe un handshake provenant du serveur avec une clé privé provenant d&rsquo;une IGC (Infrastructure de Gestion de Clés) reconnue par le DMP : l&rsquo;IGC Santé.</p>
<p>Celà permet de définir deux modes d&rsquo;authentification dans le DMP :</p>
<ul>
<li>l&rsquo;authentification indirecte par l&rsquo;usage d&rsquo;un fichier p12 certificat serveur provenant de l&rsquo;IGC santé</li>
<li>l&rsquo;authentification directe par l&rsquo;usage d&rsquo;une carte CPS</li>
</ul>
<p><img src="../SEL-MP-037+DMPi_2.04_acteurs_et_objectifs.png" alt="SEL-MP-037+DMPi_2.04_acteurs_et_objectifs"></p>
<p>Ces deux modes d&rsquo;authentification, peuvent se dériver en différentes architectures en fonction du contexte de l&rsquo;intégrateur.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-693787acd093e3d7c4291d13a9317b45">1.4.1 - Authentification Indirecte (via certificat serveur)</h1>
    <div class="lead">Accéder au DMP via un certification d&rsquo;établissement</div>
	<p>Il s&rsquo;agit de l&rsquo;authentification par certificat serveur provenant de l&rsquo;IGC Santé (Infrastructure de gestion de clés) qui est délivré aux différents établissements de santé.</p>
<blockquote>
<p>Une documentation pour obtenir des certificats serveurs se trouve <a href="/docs/dmp/howtos/gestioncertificat/">ici</a>.</p>
</blockquote>
<p>Ce mode d&rsquo;authentification ne permet que l&rsquo;alimentation de documents dans le DMP et pas la consultation.</p>
<p><strong>Description scénario</strong> : L&rsquo;intégrateur héberge le Proxy DevBox-santé dans son environnement, et l&rsquo;intégre comme une passerelle vers le DMP.</p>
<h4 id="version-rest">Version REST</h4>
<h5 id="diagramme-de-composants">Diagramme de composants</h5>
<pre tabindex="0"><code class="language-plantuml" data-lang="plantuml">!include https://bitbucket.org/devbox-sante/plantuml/raw/3/themes/theme-devbox-sante.puml

[FrontEnd intégrateur] as frontend

node &quot;Environnement intégrateur&quot; {
   [BackEnd intégrateur] as backend
    package &quot;DevBox-Santé Proxy REST&quot;  DEVBOX_COLOR {
        package &quot;DevBox-sante DMP&quot; as dmpFacade DMP_COLOR {
            [P12Manager] as P12Manager DMP_COLOR
        }
    }
}
cloud &quot;**DMP**&quot; as DMP

frontend -down-&gt; backend
backend -right-&gt; dmpFacade: REST
dmpFacade -down-&gt; DMP : SOAP

</code></pre><h4 id="version-embedded">Version Embedded</h4>
<h5 id="diagramme-de-composants-1">Diagramme de composants</h5>
<p>L&rsquo;architecture du mode embedded peut être représentée par ce schéma :</p>
<pre tabindex="0"><code class="language-plantuml" data-lang="plantuml">!include https://bitbucket.org/devbox-sante/plantuml/raw/3/themes/theme-devbox-sante.puml

[FrontEnd intégrateur] as frontend

node &quot;Environnement intégrateur&quot; {
   component &quot;BackEnd intégrateur&quot; as backend {
        component &quot;DevBox-Santé DMP&quot; as DMPC_API  DMP_COLOR {
            [P12Manager] as P12Manager DMP_COLOR
        }
    }
}
cloud &quot;**DMP**&quot; as DMP

frontend -down-&gt; backend
DMPC_API -d-&gt; DMP : SOAP XDS / CDA
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d5ff74ac0ae80510ab46a7b0b0e860b0">1.4.2 - Authentification Directe (via carte CPx)</h1>
    <div class="lead">Authentification directe en utilisant les cartes CPx (CPS/CPE&hellip;) et la cryptolib</div>
	<p>Ce mode d&rsquo;authentification nécessite l&rsquo;installation sur le poste client d&rsquo;un lecteur de carte CPS ainsi que le composant DevBox-santé. Le professionnel de santé doit posséder une carte CPS.</p>
<p><strong>Scénario possible</strong> : Le frontend/client lourd s&rsquo;exécutant sur le poste client de l&rsquo;utilisateur accède au DMP grâce à la DevBox-Santé DMP installé sur le poste client.</p>
<h4 id="version-rest">Version REST</h4>
<h5 id="diagramme-de-composants">Diagramme de composants</h5>
<pre tabindex="0"><code class="language-plantuml" data-lang="plantuml">!include https://bitbucket.org/devbox-sante/plantuml/raw/3/themes/theme-devbox-sante.puml

node &quot;Poste Client (Windows/Mac/Linux)&quot; {
    [FrontEnd intégrateur] as frontend

    package &quot;DevBox-Santé Proxy REST&quot;  DEVBOX_COLOR {
        component &quot;DevBox-sante DMP&quot; as dmpFacade #35D9C0 {
            [DevBox-sante CPS] as cps #D34A3C

        }
    }
    [Cryptolib CPS (ANS)] as cryptolibCPS
}
[BackEnd intégrateur] as backend
cloud &quot;**DMP**&quot; as DMP

frontend -right-&gt; dmpFacade : REST
cps &lt;-up-&gt; cryptolibCPS : appel natif
dmpFacade -down-&gt; DMP : SOAP
frontend  -down-&gt; backend
</code></pre><h4 id="version-embedded">Version Embedded</h4>
<h5 id="diagramme-de-composants-1">Diagramme de composants</h5>
<pre tabindex="0"><code class="language-plantuml" data-lang="plantuml">!include https://bitbucket.org/devbox-sante/plantuml/raw/3/themes/theme-devbox-sante.puml

node &quot;Poste Client (Windows/Mac/Linux)&quot; {
    component &quot;Client de l'intégrateur&quot; {
        component &quot;DevBox-Santé Proxy REST&quot;  DEVBOX_COLOR {
            component &quot;DevBox-sante DMP&quot; as dmpFacade #35D9C0 {
                [DevBox-sante CPS] as cps #D34A3C

            }
        }
    }
    [Cryptolib CPS (ANS)] as cryptolibCPS
}
cloud &quot;**DMP**&quot; as DMP

cps &lt;--&gt; cryptolibCPS : appel natif
dmpFacade --&gt; DMP : SOAP
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6e9b5f8c8bc71af95dc394511a02ae68">1.4.3 - Authentification Directe via le CPS Agent</h1>
    <div class="lead">Authentification via le CPS Agent (Démon sur le poste client minimaliste)</div>
	<h2 id="authentification-directe-avec-cpsagent">Authentification Directe avec CPS Agent</h2>
<p><strong>Scenario possible</strong> : Le frontend de l&rsquo;intégrateur, passe le contexte d&rsquo;authentification de la DevBox-Santé CPS agent se trouvant sur le poste client au backend. Le backend initie une session TLS/SSL avec le serveur DMP grâce au CpsAgentClient.</p>
<h4 id="diagramme-de-composants">Diagramme de composants</h4>
<pre tabindex="0"><code class="language-plantuml" data-lang="plantuml">!include https://bitbucket.org/devbox-sante/plantuml/raw/3/themes/theme-devbox-sante.puml

node &quot;Poste Client (Windows/Mac/Linux)&quot; {
    [FrontEnd intégrateur] as frontend

    package &quot;DevBox-Santé Proxy REST&quot; as cpsAgent DEVBOX_COLOR {
            [DevBox-sante CPS] as cps CPS_COLOR

    }
    [Cryptolib CPS (ANS)] as cryptolibCPS
}

node &quot;Environnement intégrateur&quot; {
   [BackEnd intégrateur] as backend
    package &quot;DevBox-Santé Proxy REST&quot; DEVBOX_COLOR {
        component &quot;DevBox-sante DMP&quot; as dmpFacade DMP_COLOR {
            [CpsAgentClient] CPS_COLOR
        }
    }
}
cloud &quot;**DMP**&quot; as DMP

frontend -d-&gt; backend : 1
backend -d-&gt; dmpFacade  : 2
CpsAgentClient -&gt; cpsAgent : 3
cps -down-&gt; cryptolibCPS : 4
dmpFacade -down-&gt; DMP : 5
</code></pre><h4 id="diagramme-de-séquences">Diagramme de séquences</h4>
<pre tabindex="0"><code class="language-plantuml" data-lang="plantuml">!include https://bitbucket.org/devbox-sante/plantuml/raw/3/themes/theme-devbox-sante.puml

box &quot;Poste Client&quot;
participant frontend
participant cpsAgent CPS_COLOR
end box

box &quot;Environnement intégrateur&quot; #white
participant &quot;DevBox-Santé DMP&quot; as dbxdmp DMP_COLOR
participant backend
end box

participant &quot;**DMP**&quot; as dmp

frontend -&gt; backend : storeDocumentPatient
backend -&gt; dbxdmp : /dmp/td21SubmitDocuments
==  initialisation d'une connexion SSL en authentification mutuelle avec le DMP ==
dbxdmp -&gt; &quot;DMP&quot; as dmp : [SSL] 1. Client Hello
dmp -&gt; dbxdmp : [SSL] 2. Server Hello (certificat du DMP server inclus)
dmp -&gt; dbxdmp : [SSL] 3. Client certificate request
dbxdmp -&gt; cpsAgent : HTTP GET /cps/authenticationCertificate
cpsAgent -&gt; dbxdmp : {certificate authentification}
dbxdmp -&gt; dmp : [SSL] 4. Client certificate
dbxdmp -&gt; dmp : [SSL] 5. Client sends key info \n(encrypted with DMP server public's key)
dbxdmp -&gt; cpsAgent : HTTP POST /cps/sign/for/authentication/SHA256WithRSA body : {handshake data}
cpsAgent -&gt; dbxdmp : {signed handshake data}
dbxdmp -&gt; dmp : [SSL] 6. Certificate verify \n (with Digital Signature)
dbxdmp -&gt; dmp : [SSL] 7. Finnished message \n (encrypted with symmetric key)
dmp -&gt; dbxdmp : [SSL] 8. Finnished message \n (encrypted with symmetric key)
== fin de l'initialisation de la connexion ssl avec le DMP ==
dbxdmp -&gt; dmp : POST SOAP message de soumission (XDS/CDA)
dmp -&gt; dbxdmp : SOAP response OK
dbxdmp -&gt; backend : HTTP 200 Ok
backend -&gt; frontend : ok

</code></pre>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3cdfc9b194da698c476bf8ecc81edcb0">1.5 - Structuration des documents</h1>
    <div class="lead">Les différents formats CDA supportés</div>
	<h2 id="glossaire">Glossaire</h2>
<ul>
<li><strong>CDA</strong> : Clinical Document Architecture</li>
</ul>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-d34be09f24f6f3a9f9e24e8f82412d8a">1.5.1 - CDA structuration minimale</h1>
    
	<h2 id="cdade-structuration-minimale">CDA de Structuration minimale</h2>
<p>La DevBox-Santé DMP prend en charge la soumission de document à structuration minimale.
Il s&rsquo;agit du format par défaut exigé par le Guide d&rsquo;intégration , il contient les métadonnées de 
base permettant la création d&rsquo;un DMPCDocument ainsi que son contenu binaire.</p>
<p>La spécification de ce type de document est défini par l&rsquo;ANS. Pour plus de renseignements sur le Volet Structuration minimal de Documents de santé : <a href="https://esante.gouv.fr/volet-structuration-minimale-de-documents-de-sante">https://esante.gouv.fr/volet-structuration-minimale-de-documents-de-sante</a></p>
<p>Un exemple de création de document à structuration minimale est:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">
<span style="color:#000">DMPCDocument</span> <span style="color:#000">document</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCDocument</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#8f5902;font-style:italic">// ajout des métadonnées 
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setClassCode</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCodesFor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ASIPJeuxValeurs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">CLASS_CODE</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">get</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">0</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">getCode</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addConfidentiality</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCodesFor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ASIPJeuxValeurs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">CONFIDENTIALITY_CODE</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">get</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">0</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">getCode</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setComments</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;commentDocument&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addEvent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;B18&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;2.16.840.1.113883.6.3&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Hépatite virale chronique&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPracticeSetting</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCodesFor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ASIPJeuxValeurs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">PRACTICE_SETTING_CODE</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">get</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">0</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">getCode</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setServiceStartTime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;20171020174600&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setServiceStopTime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;20171020194600&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setTitle</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;titleDocument&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setType</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCodesFor</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ASIPJeuxValeurs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">TYPE_CODE</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">get</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">0</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">getCode</span><span style="color:#ce5c00;font-weight:bold">());</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setCreationTime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;20171020194600&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
 
<span style="color:#8f5902;font-style:italic">// association du format et de son contenu. Ici, il s&#39;agit d&#39;un fichier pdf.
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setFormat</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;urn:ihe:iti:xds-sd:pdf:2008&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">InputStream</span> <span style="color:#000">input</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">FileInputStream</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;monDocumentSante.pdf&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#204a87;font-weight:bold">byte</span><span style="color:#ce5c00;font-weight:bold">[]</span> <span style="color:#000">content</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#204a87;font-weight:bold">byte</span><span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#000">input</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">available</span><span style="color:#ce5c00;font-weight:bold">()];</span>
<span style="color:#000">ByteStreams</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">readFully</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">input</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">content</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">document</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setContent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">content</span><span style="color:#ce5c00;font-weight:bold">);</span>

</code></pre></div><p>Listes des formats possibles :</p>
<ul>
<li><code>urn:ihe:iti:xds-sd:pdf:2008</code></li>
<li><code>urn:ihe:iti-fr:xds-sd:rtf:2010</code></li>
<li><code>urn:ihe:iti-fr:xds-sd:jpeg:2010</code></li>
<li><code>urn:ihe:iti-fr:xds-sd:tiff:2010</code></li>
<li>&hellip;</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-57bd2090107e3a53752be3a64f6dbda5">1.5.2 - Compte rendu d&#39;examens de biologie</h1>
    
	<p>La DevBox-Santé DMP prend également en charge la soumission de document structure comme le CR d&rsquo;examens biologie.</p>
<p>Ce format de document est spécifié par l&rsquo;ANS : <a href="https://esante.gouv.fr/volet-cr-bio-compte-rendu-dexamens-de-biologie-medicale">https://esante.gouv.fr/volet-cr-bio-compte-rendu-dexamens-de-biologie-medicale</a></p>
<p>Un exemple de création de document conforme à la spécification est :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#204a87;font-weight:bold">private</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">createCRBiologie</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">DMPCStructureSante</span> <span style="color:#000">structureSante</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">String</span> <span style="color:#000">creationTime</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;20111020194600&#34;</span><span style="color:#ce5c00;font-weight:bold">;</span>
    <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">String</span> <span style="color:#000">startTime</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;20140520174600&#34;</span><span style="color:#ce5c00;font-weight:bold">;</span>
    <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">String</span> <span style="color:#000">stopTime</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;20140520184600&#34;</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#000">DMPCDocumentCRBiologie</span> <span style="color:#000">template</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCDocumentCRBiologie</span><span style="color:#ce5c00;font-weight:bold">();</span>
    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setClassCode</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;10&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addConfidentiality</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;N&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setComments</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Commentaire du document&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setFormat</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;urn:ihe:lab:xd-lab:2008&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>  <span style="color:#8f5902;font-style:italic">// format obligatoire
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPracticeSetting</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;AMBULATOIRE&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setServiceStartTime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">startTime</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setServiceStopTime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">stopTime</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setTitle</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Titre CRBiologie&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setType</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;11502-2&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setCreationTime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">creationTime</span><span style="color:#ce5c00;font-weight:bold">);</span>

    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addEvent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;16915-1&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">OIDs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">LOINC</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getRepresentation</span><span style="color:#ce5c00;font-weight:bold">(),</span> <span style="color:#4e9a06">&#34;Glucose post prandial [Masse/Volume] Sérum/Plasma ; Numérique&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span>

    <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">Participation</span> <span style="color:#000">prescription</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">Participation</span><span style="color:#ce5c00;font-weight:bold">();</span>
    <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">DMPCPersonnelSante</span> <span style="color:#000">prescripteur</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCPersonnelSante</span><span style="color:#ce5c00;font-weight:bold">();</span>
    <span style="color:#000">prescripteur</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setAdeli</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;801234567897&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">prescripteur</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setNom</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Gynecon&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">prescripteur</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPrenom</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Eve&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">prescripteur</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setStructureSante</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">structureSante</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">prescripteur</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setTelephone</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;0147150000&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>

    <span style="color:#000">prescription</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPersonnelSante</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">prescripteur</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">prescription</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setStopTime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">startTime</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPrescription</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">prescription</span><span style="color:#ce5c00;font-weight:bold">);</span>

    <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">Participation</span> <span style="color:#000">prelevement</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">Participation</span><span style="color:#ce5c00;font-weight:bold">();</span>
    <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">DMPCPersonnelSante</span> <span style="color:#000">preleveur</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCPersonnelSante</span><span style="color:#ce5c00;font-weight:bold">();</span>
    <span style="color:#000">preleveur</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setAdeli</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;801234567897&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">preleveur</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setNom</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Bleeder&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">preleveur</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPrenom</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Roberta&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">preleveur</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setStructureSante</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">structureSante</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">prelevement</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPersonnelSante</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">preleveur</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">prelevement</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setStopTime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">stopTime</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPrelevement</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">prelevement</span><span style="color:#ce5c00;font-weight:bold">);</span>

    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setId</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;1234&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setVersionNumber</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">0</span><span style="color:#ce5c00;font-weight:bold">);</span>

    <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">StructuredBody</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ChapterSection</span> <span style="color:#000">chapterSection</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">StructuredBody</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ChapterSection</span><span style="color:#ce5c00;font-weight:bold">();</span>
    <span style="color:#000">chapterSection</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setLoincCode</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ChapterSectionLoincCode</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">BIOLOGIE</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCode</span><span style="color:#ce5c00;font-weight:bold">());</span>
    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getBody</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">getChapterSections</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">chapterSection</span><span style="color:#ce5c00;font-weight:bold">);</span>

    <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">StructuredBody</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">Section</span> <span style="color:#000">section</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">StructuredBody</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">Section</span><span style="color:#ce5c00;font-weight:bold">();</span>
    <span style="color:#000">chapterSection</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getSections</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">section</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">section</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setAuthenticator</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">prescripteur</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">section</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setAuthenticatorInterpretation</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Commentaire habituel&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">StructuredBody</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">Observation</span> <span style="color:#000">observation</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">StructuredBody</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">Observation</span><span style="color:#ce5c00;font-weight:bold">();</span>
    <span style="color:#000">observation</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setCode</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;16915-1&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">OIDs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">LOINC</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getRepresentation</span><span style="color:#ce5c00;font-weight:bold">(),</span> <span style="color:#4e9a06">&#34;Glucose post prandial [Masse/Volume] Sérum/Plasma ; Numérique&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span>
    <span style="color:#000">observation</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setStatus</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;completed&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">observation</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setTime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">stopTime</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">StructuredBody</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">Value</span> <span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">StructuredBody</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">Value</span><span style="color:#ce5c00;font-weight:bold">();</span>
    <span style="color:#000">value</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setValue</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;1.5&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">value</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setUnit</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;g/L&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">observation</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setValue</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">value</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">observation</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setInterpretation</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">DMPCCode</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;H&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Hl7OIDs</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">OBSERVATION_INTERPRETATION</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getRepresentation</span><span style="color:#ce5c00;font-weight:bold">(),</span> <span style="color:#4e9a06">&#34;Anormalement haut&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span>
    <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">StructuredBody</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">RangeValue</span> <span style="color:#000">rangeValue</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">StructuredBody</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">RangeValue</span><span style="color:#ce5c00;font-weight:bold">();</span>
    <span style="color:#000">rangeValue</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setLow</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;0.8&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">rangeValue</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setHigh</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;1.26&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">rangeValue</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setUnit</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;g/L&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">observation</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setReferenceRange</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">rangeValue</span><span style="color:#ce5c00;font-weight:bold">);</span>
    <span style="color:#000">section</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getObservations</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">observation</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><p>La génération un peu longue certe permet de rajouter les sections et observations nécessaires pour générer le document CDA suivant :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#8f5902;font-style:italic">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; standalone=&#34;yes&#34;?&gt;</span>
<span style="color:#204a87;font-weight:bold">&lt;ClinicalDocument</span> <span style="color:#c4a000">xmlns=</span><span style="color:#4e9a06">&#34;urn:hl7-org:v3&#34;</span> <span style="color:#c4a000">xmlns:xsi=</span><span style="color:#4e9a06">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span style="color:#c4a000">xsi:schemaLocation=</span><span style="color:#4e9a06">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span style="color:#204a87;font-weight:bold">&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;realmCode</span> <span style="color:#c4a000">code=</span><span style="color:#4e9a06">&#34;FR&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;typeId</span> <span style="color:#c4a000">root=</span><span style="color:#4e9a06">&#34;2.16.840.1.113883.1.3&#34;</span> <span style="color:#c4a000">extension=</span><span style="color:#4e9a06">&#34;POCD_HD000040&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;templateId</span> <span style="color:#c4a000">root=</span><span style="color:#4e9a06">&#34;2.16.840.1.113883.2.8.2.1&#34;</span> <span style="color:#c4a000">assigningAuthorityName=</span><span style="color:#4e9a06">&#34;HL7 France&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;templateId</span> <span style="color:#c4a000">root=</span><span style="color:#4e9a06">&#34;1.2.250.1.213.1.1.1.1&#34;</span> <span style="color:#c4a000">assigningAuthorityName=</span><span style="color:#4e9a06">&#34;Cadre InteropASIP&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;templateId</span> <span style="color:#c4a000">root=</span><span style="color:#4e9a06">&#34;1.3.6.1.4.1.19376.1.2.20&#34;</span> <span style="color:#c4a000">assigningAuthorityName=</span><span style="color:#4e9a06">&#34;Template identifier for an XDS-SD document&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;templateId</span> <span style="color:#c4a000">root=</span><span style="color:#4e9a06">&#34;1.3.6.1.4.1.19376.1.3.3&#34;</span> <span style="color:#c4a000">assigningAuthorityName=</span><span style="color:#4e9a06">&#34;Laboratory Report Summary Specification&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;id</span> <span style="color:#c4a000">root=</span><span style="color:#4e9a06">&#34;1.2.250.1.287.1.123456.1400919121980.0&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;code</span> <span style="color:#c4a000">code=</span><span style="color:#4e9a06">&#34;11502-2&#34;</span> <span style="color:#c4a000">codeSystem=</span><span style="color:#4e9a06">&#34;2.16.840.1.113883.6.1&#34;</span> <span style="color:#c4a000">displayName=</span><span style="color:#4e9a06">&#34;CR d&#39;examens biologiques&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;title&gt;</span>document titre<span style="color:#204a87;font-weight:bold">&lt;/title&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;effectiveTime</span> <span style="color:#c4a000">value=</span><span style="color:#4e9a06">&#34;20140524101200+0200&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;confidentialityCode</span> <span style="color:#c4a000">code=</span><span style="color:#4e9a06">&#34;N&#34;</span> <span style="color:#c4a000">codeSystem=</span><span style="color:#4e9a06">&#34;2.16.840.1.113883.5.25&#34;</span> <span style="color:#c4a000">displayName=</span><span style="color:#4e9a06">&#34;Normal&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;languageCode</span> <span style="color:#c4a000">code=</span><span style="color:#4e9a06">&#34;fr-FR&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;versionNumber</span> <span style="color:#c4a000">value=</span><span style="color:#4e9a06">&#34;0&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;recordTarget&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;patientRole&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;id</span> <span style="color:#c4a000">root=</span><span style="color:#4e9a06">&#34;1.2.250.1.213.1.4.2&#34;</span> <span style="color:#c4a000">extension=</span><span style="color:#4e9a06">&#34;1164485058822081751070&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;id</span> <span style="color:#c4a000">root=</span><span style="color:#4e9a06">&#34;1.2.250.1.287.1.123456&#34;</span> <span style="color:#c4a000">extension=</span><span style="color:#4e9a06">&#34;1234&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;addr</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;NASK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;telecom</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;NASK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;patient&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;name&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;given&gt;</span>prenom<span style="color:#204a87;font-weight:bold">&lt;/given&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;family</span> <span style="color:#c4a000">qualifier=</span><span style="color:#4e9a06">&#34;BR&#34;</span><span style="color:#204a87;font-weight:bold">&gt;</span>nom<span style="color:#204a87;font-weight:bold">&lt;/family&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;family</span> <span style="color:#c4a000">qualifier=</span><span style="color:#4e9a06">&#34;SP&#34;</span><span style="color:#204a87;font-weight:bold">&gt;</span>nomEpouse<span style="color:#204a87;font-weight:bold">&lt;/family&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;/name&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;administrativeGenderCode</span> <span style="color:#c4a000">code=</span><span style="color:#4e9a06">&#34;M&#34;</span> <span style="color:#c4a000">codeSystem=</span><span style="color:#4e9a06">&#34;2.16.840.1.113883.5.1&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;birthTime</span> <span style="color:#c4a000">value=</span><span style="color:#4e9a06">&#34;19730513&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;/patient&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;/patientRole&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;/recordTarget&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;author&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;functionCode</span> <span style="color:#c4a000">code=</span><span style="color:#4e9a06">&#34;10&#34;</span> <span style="color:#c4a000">codeSystem=</span><span style="color:#4e9a06">&#34;1.2.250.1.71.1.2.7&#34;</span> <span style="color:#c4a000">displayName=</span><span style="color:#4e9a06">&#34;Médecin&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;time</span> <span style="color:#c4a000">value=</span><span style="color:#4e9a06">&#34;20140524101200+0200&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;assignedAuthor&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;id</span> <span style="color:#c4a000">root=</span><span style="color:#4e9a06">&#34;1.2.250.1.71.4.2.1&#34;</span> <span style="color:#c4a000">extension=</span><span style="color:#4e9a06">&#34;500000000015644/123&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;code</span> <span style="color:#c4a000">code=</span><span style="color:#4e9a06">&#34;G15_10/SM30&#34;</span> <span style="color:#c4a000">codeSystem=</span><span style="color:#4e9a06">&#34;1.2.250.1.213.1.1.4.5&#34;</span> <span style="color:#c4a000">displayName=</span><span style="color:#4e9a06">&#34;Médecin - Néphrologie (SM)&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;addr</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;NASK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;assignedPerson&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;name&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;given&gt;</span>auteurPrenom<span style="color:#204a87;font-weight:bold">&lt;/given&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;family</span> <span style="color:#c4a000">qualifier=</span><span style="color:#4e9a06">&#34;BR&#34;</span><span style="color:#204a87;font-weight:bold">&gt;</span>auteurNom<span style="color:#204a87;font-weight:bold">&lt;/family&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;/name&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;/assignedPerson&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;representedOrganization&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;id</span> <span style="color:#c4a000">root=</span><span style="color:#4e9a06">&#34;1.2.250.1.71.4.2.2&#34;</span> <span style="color:#c4a000">extension=</span><span style="color:#4e9a06">&#34;300000000015644&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;name&gt;</span>structureNom<span style="color:#204a87;font-weight:bold">&lt;/name&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;/representedOrganization&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;/assignedAuthor&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;/author&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;custodian&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;assignedCustodian&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;representedCustodianOrganization&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;id</span> <span style="color:#c4a000">root=</span><span style="color:#4e9a06">&#34;1.2.250.1.71.4.2.2&#34;</span> <span style="color:#c4a000">extension=</span><span style="color:#4e9a06">&#34;300000000015644&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;name&gt;</span>structureNom<span style="color:#204a87;font-weight:bold">&lt;/name&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;telecom</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;NASK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;addr</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;NASK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;/representedCustodianOrganization&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;/assignedCustodian&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;/custodian&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;legalAuthenticator&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;time</span> <span style="color:#c4a000">value=</span><span style="color:#4e9a06">&#34;20140524101200+0200&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;signatureCode</span> <span style="color:#c4a000">code=</span><span style="color:#4e9a06">&#34;S&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;assignedEntity&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;id</span> <span style="color:#c4a000">root=</span><span style="color:#4e9a06">&#34;1.2.250.1.71.4.2.1&#34;</span> <span style="color:#c4a000">extension=</span><span style="color:#4e9a06">&#34;500000000015644/123&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;addr</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;NASK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;telecom</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;NASK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;assignedPerson&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;name&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;given&gt;</span>auteurPrenom<span style="color:#204a87;font-weight:bold">&lt;/given&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;family</span> <span style="color:#c4a000">qualifier=</span><span style="color:#4e9a06">&#34;BR&#34;</span><span style="color:#204a87;font-weight:bold">&gt;</span>auteurNom<span style="color:#204a87;font-weight:bold">&lt;/family&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;/name&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;/assignedPerson&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;/assignedEntity&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;/legalAuthenticator&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;participant</span> <span style="color:#c4a000">typeCode=</span><span style="color:#4e9a06">&#34;REF&#34;</span><span style="color:#204a87;font-weight:bold">&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;functionCode</span> <span style="color:#c4a000">code=</span><span style="color:#4e9a06">&#34;TODO&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;time&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;high</span> <span style="color:#c4a000">value=</span><span style="color:#4e9a06">&#34;20091113&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;/time&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;associatedEntity</span> <span style="color:#c4a000">classCode=</span><span style="color:#4e9a06">&#34;PROV&#34;</span><span style="color:#204a87;font-weight:bold">&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;id</span> <span style="color:#c4a000">root=</span><span style="color:#4e9a06">&#34;1.2.250.1.71.4.2.1&#34;</span> <span style="color:#c4a000">extension=</span><span style="color:#4e9a06">&#34;801234567897&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;code</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;NASK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;addr</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;NASK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;telecom</span> <span style="color:#c4a000">use=</span><span style="color:#4e9a06">&#34;EC&#34;</span> <span style="color:#c4a000">value=</span><span style="color:#4e9a06">&#34;tel:0147150000&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;associatedPerson&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;name&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;given&gt;</span>Eve<span style="color:#204a87;font-weight:bold">&lt;/given&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;family</span> <span style="color:#c4a000">qualifier=</span><span style="color:#4e9a06">&#34;BR&#34;</span><span style="color:#204a87;font-weight:bold">&gt;</span>Gynecon<span style="color:#204a87;font-weight:bold">&lt;/family&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;/name&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;/associatedPerson&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;/associatedEntity&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;/participant&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;participant</span> <span style="color:#c4a000">typeCode=</span><span style="color:#4e9a06">&#34;DIST&#34;</span><span style="color:#204a87;font-weight:bold">&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;functionCode</span> <span style="color:#c4a000">code=</span><span style="color:#4e9a06">&#34;PRELV&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;time/&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;associatedEntity</span> <span style="color:#c4a000">classCode=</span><span style="color:#4e9a06">&#34;CAREGIVER&#34;</span><span style="color:#204a87;font-weight:bold">&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;id</span> <span style="color:#c4a000">root=</span><span style="color:#4e9a06">&#34;1.2.250.1.71.4.2.1&#34;</span> <span style="color:#c4a000">extension=</span><span style="color:#4e9a06">&#34;801234567897&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;code</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;NASK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;addr</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;NASK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;telecom</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;NASK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;associatedPerson&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;name&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;given&gt;</span>Roberta<span style="color:#204a87;font-weight:bold">&lt;/given&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;family</span> <span style="color:#c4a000">qualifier=</span><span style="color:#4e9a06">&#34;BR&#34;</span><span style="color:#204a87;font-weight:bold">&gt;</span>Bleeder<span style="color:#204a87;font-weight:bold">&lt;/family&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;/name&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;/associatedPerson&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;/associatedEntity&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;/participant&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;documentationOf&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;serviceEvent&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;code</span> <span style="color:#c4a000">code=</span><span style="color:#4e9a06">&#34;H33&#34;</span> <span style="color:#c4a000">codeSystem=</span><span style="color:#4e9a06">&#34;2.16.840.1.113883.6.3&#34;</span> <span style="color:#c4a000">displayName=</span><span style="color:#4e9a06">&#34;Décollement et déchirement de la rétine&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;effectiveTime&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;low</span> <span style="color:#c4a000">value=</span><span style="color:#4e9a06">&#34;20111025&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;high</span> <span style="color:#c4a000">value=</span><span style="color:#4e9a06">&#34;20111125&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;/effectiveTime&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;performer</span> <span style="color:#c4a000">typeCode=</span><span style="color:#4e9a06">&#34;PRF&#34;</span><span style="color:#204a87;font-weight:bold">&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;functionCode</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;UNK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;assignedEntity&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;id</span> <span style="color:#c4a000">root=</span><span style="color:#4e9a06">&#34;1.2.250.1.71.4.2.1&#34;</span> <span style="color:#c4a000">extension=</span><span style="color:#4e9a06">&#34;500000000015644/123&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;addr</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;NASK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;telecom</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;NASK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;assignedPerson&gt;</span>
                        <span style="color:#204a87;font-weight:bold">&lt;name&gt;</span>
                            <span style="color:#204a87;font-weight:bold">&lt;given&gt;</span>auteurPrenom<span style="color:#204a87;font-weight:bold">&lt;/given&gt;</span>
                            <span style="color:#204a87;font-weight:bold">&lt;family</span> <span style="color:#c4a000">qualifier=</span><span style="color:#4e9a06">&#34;BR&#34;</span><span style="color:#204a87;font-weight:bold">&gt;</span>auteurNom<span style="color:#204a87;font-weight:bold">&lt;/family&gt;</span>
                        <span style="color:#204a87;font-weight:bold">&lt;/name&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;/assignedPerson&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;representedOrganization&gt;</span>
                        <span style="color:#204a87;font-weight:bold">&lt;id</span> <span style="color:#c4a000">root=</span><span style="color:#4e9a06">&#34;1.2.250.1.71.4.2.2&#34;</span> <span style="color:#c4a000">extension=</span><span style="color:#4e9a06">&#34;300000000015644&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                        <span style="color:#204a87;font-weight:bold">&lt;name&gt;</span>structureNom<span style="color:#204a87;font-weight:bold">&lt;/name&gt;</span>
                        <span style="color:#204a87;font-weight:bold">&lt;telecom</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;NASK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                        <span style="color:#204a87;font-weight:bold">&lt;addr</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;NASK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                        <span style="color:#204a87;font-weight:bold">&lt;standardIndustryClassCode</span> <span style="color:#c4a000">code=</span><span style="color:#4e9a06">&#34;AMBULATOIRE&#34;</span> <span style="color:#c4a000">codeSystem=</span><span style="color:#4e9a06">&#34;1.2.250.1.213.1.1.4.9&#34;</span> <span style="color:#c4a000">displayName=</span><span style="color:#4e9a06">&#34;Ambulatoire&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;/representedOrganization&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;/assignedEntity&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;/performer&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;/serviceEvent&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;/documentationOf&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;componentOf&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;encompassingEncounter&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;effectiveTime</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;UNK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;location&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;healthCareFacility&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;code</span> <span style="color:#c4a000">code=</span><span style="color:#4e9a06">&#34;SA41&#34;</span> <span style="color:#c4a000">codeSystem=</span><span style="color:#4e9a06">&#34;1.2.250.1.71.4.2.4&#34;</span> <span style="color:#c4a000">displayName=</span><span style="color:#4e9a06">&#34;Autre établissement du domaine social &#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;/healthCareFacility&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;/location&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;/encompassingEncounter&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;/componentOf&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;component&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;structuredBody&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;component&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;section&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;templateId</span> <span style="color:#c4a000">root=</span><span style="color:#4e9a06">&#34;1.3.6.1.4.1.19376.1.3.3.2.1&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;code</span> <span style="color:#c4a000">code=</span><span style="color:#4e9a06">&#34;18719-5&#34;</span> <span style="color:#c4a000">codeSystem=</span><span style="color:#4e9a06">&#34;2.16.840.1.113883.6.1&#34;</span> <span style="color:#c4a000">displayName=</span><span style="color:#4e9a06">&#34;Biochimie&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;title&gt;</span>Biochimie<span style="color:#204a87;font-weight:bold">&lt;/title&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;component&gt;</span>
                        <span style="color:#204a87;font-weight:bold">&lt;section&gt;</span>
                            <span style="color:#204a87;font-weight:bold">&lt;templateId</span> <span style="color:#c4a000">root=</span><span style="color:#4e9a06">&#34;1.3.6.1.4.1.19376.1.3.3.2.2&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                            <span style="color:#204a87;font-weight:bold">&lt;code</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;NASK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                            <span style="color:#204a87;font-weight:bold">&lt;text&gt;</span>
                                <span style="color:#204a87;font-weight:bold">&lt;table&gt;</span>
                                    <span style="color:#204a87;font-weight:bold">&lt;thead&gt;</span>
                                        <span style="color:#204a87;font-weight:bold">&lt;tr&gt;</span>
                                            <span style="color:#204a87;font-weight:bold">&lt;td&gt;</span>Unité<span style="color:#204a87;font-weight:bold">&lt;/td&gt;</span>
                                            <span style="color:#204a87;font-weight:bold">&lt;td&gt;</span>Date<span style="color:#204a87;font-weight:bold">&lt;/td&gt;</span>
                                            <span style="color:#204a87;font-weight:bold">&lt;td&gt;</span>Valeur<span style="color:#204a87;font-weight:bold">&lt;/td&gt;</span>
                                            <span style="color:#204a87;font-weight:bold">&lt;td&gt;</span>Valeur Référence<span style="color:#204a87;font-weight:bold">&lt;/td&gt;</span>
                                            <span style="color:#204a87;font-weight:bold">&lt;td&gt;</span>Interprétation<span style="color:#204a87;font-weight:bold">&lt;/td&gt;</span>
                                        <span style="color:#204a87;font-weight:bold">&lt;/tr&gt;</span>
                                    <span style="color:#204a87;font-weight:bold">&lt;/thead&gt;</span>
                                    <span style="color:#204a87;font-weight:bold">&lt;tbody&gt;</span>
                                        <span style="color:#204a87;font-weight:bold">&lt;tr&gt;</span>
                                            <span style="color:#204a87;font-weight:bold">&lt;td&gt;</span>g/L<span style="color:#204a87;font-weight:bold">&lt;/td&gt;</span>
                                            <span style="color:#204a87;font-weight:bold">&lt;td&gt;</span>24/05/2014<span style="color:#204a87;font-weight:bold">&lt;/td&gt;</span>
                                            <span style="color:#204a87;font-weight:bold">&lt;td&gt;</span>1.5<span style="color:#204a87;font-weight:bold">&lt;/td&gt;</span>
                                            <span style="color:#204a87;font-weight:bold">&lt;td&gt;</span>0.8 - 1.26<span style="color:#204a87;font-weight:bold">&lt;/td&gt;</span>
                                            <span style="color:#204a87;font-weight:bold">&lt;td&gt;</span><span style="color:#ce5c00">&amp;gt;</span><span style="color:#204a87;font-weight:bold">&lt;/td&gt;</span>
                                        <span style="color:#204a87;font-weight:bold">&lt;/tr&gt;</span>
                                    <span style="color:#204a87;font-weight:bold">&lt;/tbody&gt;</span>
                                <span style="color:#204a87;font-weight:bold">&lt;/table&gt;</span>
                                <span style="color:#204a87;font-weight:bold">&lt;paragraph&gt;</span>Interprétation :  Résultats Validés par : auteurNom auteurPrenom - null<span style="color:#204a87;font-weight:bold">&lt;/paragraph&gt;</span>
                            <span style="color:#204a87;font-weight:bold">&lt;/text&gt;</span>
                            <span style="color:#204a87;font-weight:bold">&lt;entry&gt;</span>
                                <span style="color:#204a87;font-weight:bold">&lt;observation</span> <span style="color:#c4a000">classCode=</span><span style="color:#4e9a06">&#34;OBS&#34;</span> <span style="color:#c4a000">moodCode=</span><span style="color:#4e9a06">&#34;EVN&#34;</span><span style="color:#204a87;font-weight:bold">&gt;</span>
                                    <span style="color:#204a87;font-weight:bold">&lt;code</span> <span style="color:#c4a000">xsi:type=</span><span style="color:#4e9a06">&#34;CE&#34;</span> <span style="color:#c4a000">code=</span><span style="color:#4e9a06">&#34;16915-1&#34;</span> <span style="color:#c4a000">codeSystem=</span><span style="color:#4e9a06">&#34;2.16.840.1.113883.6.1&#34;</span> <span style="color:#c4a000">displayName=</span><span style="color:#4e9a06">&#34;Glucose post prandial [Masse/Volume] Sérum/Plasma ; Numérique&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                                    <span style="color:#204a87;font-weight:bold">&lt;statusCode</span> <span style="color:#c4a000">code=</span><span style="color:#4e9a06">&#34;completed&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                                    <span style="color:#204a87;font-weight:bold">&lt;effectiveTime</span> <span style="color:#c4a000">value=</span><span style="color:#4e9a06">&#34;20140524101202+0200&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                                    <span style="color:#204a87;font-weight:bold">&lt;value</span> <span style="color:#c4a000">xsi:type=</span><span style="color:#4e9a06">&#34;PQ&#34;</span> <span style="color:#c4a000">value=</span><span style="color:#4e9a06">&#34;1.5&#34;</span> <span style="color:#c4a000">unit=</span><span style="color:#4e9a06">&#34;g/L&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                                    <span style="color:#204a87;font-weight:bold">&lt;interpretationCode</span> <span style="color:#c4a000">code=</span><span style="color:#4e9a06">&#34;&amp;gt;&#34;</span> <span style="color:#c4a000">codeSystem=</span><span style="color:#4e9a06">&#34;2.16.840.1.113883.5.83&#34;</span> <span style="color:#c4a000">displayName=</span><span style="color:#4e9a06">&#34;Au dessus, hors échelle de l&#39;instrument de mesure&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                                    <span style="color:#204a87;font-weight:bold">&lt;methodCode</span> <span style="color:#c4a000">nullFlavor=</span><span style="color:#4e9a06">&#34;NASK&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                                    <span style="color:#204a87;font-weight:bold">&lt;referenceRange</span> <span style="color:#c4a000">typeCode=</span><span style="color:#4e9a06">&#34;REFV&#34;</span><span style="color:#204a87;font-weight:bold">&gt;</span>
                                        <span style="color:#204a87;font-weight:bold">&lt;observationRange&gt;</span>
                                            <span style="color:#204a87;font-weight:bold">&lt;value</span> <span style="color:#c4a000">xsi:type=</span><span style="color:#4e9a06">&#34;IVL_PQ&#34;</span><span style="color:#204a87;font-weight:bold">&gt;</span>
                                                <span style="color:#204a87;font-weight:bold">&lt;low</span> <span style="color:#c4a000">value=</span><span style="color:#4e9a06">&#34;0.8&#34;</span> <span style="color:#c4a000">unit=</span><span style="color:#4e9a06">&#34;g/L&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                                                <span style="color:#204a87;font-weight:bold">&lt;high</span> <span style="color:#c4a000">value=</span><span style="color:#4e9a06">&#34;1.26&#34;</span> <span style="color:#c4a000">unit=</span><span style="color:#4e9a06">&#34;g/L&#34;</span><span style="color:#204a87;font-weight:bold">/&gt;</span>
                                            <span style="color:#204a87;font-weight:bold">&lt;/value&gt;</span>
                                        <span style="color:#204a87;font-weight:bold">&lt;/observationRange&gt;</span>
                                    <span style="color:#204a87;font-weight:bold">&lt;/referenceRange&gt;</span>
                                <span style="color:#204a87;font-weight:bold">&lt;/observation&gt;</span>
                            <span style="color:#204a87;font-weight:bold">&lt;/entry&gt;</span>
                        <span style="color:#204a87;font-weight:bold">&lt;/section&gt;</span>
                    <span style="color:#204a87;font-weight:bold">&lt;/component&gt;</span>
                <span style="color:#204a87;font-weight:bold">&lt;/section&gt;</span>
            <span style="color:#204a87;font-weight:bold">&lt;/component&gt;</span>
        <span style="color:#204a87;font-weight:bold">&lt;/structuredBody&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;/component&gt;</span>
<span style="color:#204a87;font-weight:bold">&lt;/ClinicalDocument&gt;</span>
</code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-434a46fcd75cb7f35d890cb3ebdc053a">1.6 - Howtos</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-1a15b213096f096d9defaada77087947">1.6.1 - Gestion des certificats</h1>
    <div class="lead">Gestion des certificats de l&rsquo;IGC santé pour l&rsquo;authentification indirecte</div>
	<p>Une nouvelle IGC Santé a été mise en place courant 2016 : <a href="http://integrateurs-cps.asipsante.fr/IGC-Sante">http://integrateurs-cps.asipsante.fr/IGC-Sante</a></p>
<p>Afin d&rsquo;utiliser le connecteur DevBox-Santé DMP en mode authentification indirecte, il vous faut obtenir des certificats serveurs provenant de cette autorité. 
Pour celà après avoir commandé des cartes CPS vous pouvez faire une demande à partir d&rsquo;un téléservice dont la procédure est décrite ici.</p>
<h2 id="procédure-administrative">Procédure Administrative</h2>
<h3 id="règle-générale">Règle générale</h3>
<p>Pour obtenir, les certificats et clés nécessaires pour la connexion au DMP en authentification indirecte, il faut que votre établissement soit enregistré au FINESS (Fichier National des Établissements Sanitaires es Sociaux) : <a href="http://finess.sante.gouv.fr/fininter/jsp/index.jsp">http://finess.sante.gouv.fr/fininter/jsp/index.jsp</a></p>
<p>Les personnes pouvant remplir les conditions d&rsquo;obtentions des certificats sont décrites dans le document de l&rsquo;ANS : <a href="https://esante.gouv.fr/media/3827">Procédure DMP - Structures salariées</a></p>
<p>Les principes généraux sont les suivants :</p>
<blockquote>
<p>Lors du raccordement au DMP, chaque site géographique d’un établissement de santé s’authentifie et s’identifie via son numéro de FINESS géographique.</p>
<ul>
<li>Ainsi, chaque site doit générer des certificats d’organisation sur son numéro de FINESS géographique.</li>
<li>L’administrateur technique est une personne de confiance à qui le représentant légal de l’établissement délègue le droit de gérer le cycle de vie des certificats logiciels commandés.</li>
</ul>
</blockquote>
<blockquote>
<p>Il est également possible pour le représentant légal d’une structure de désigner un ou plusieurs mandataires pour sa structure.</p>
</blockquote>
<h3 id="quels-certificats-">Quels certificats ?</h3>
<blockquote>
<p>Pour accéder au DMP en authentification indirecte (création/gestion administrative et alimentation), vous avez besoin de déployer les certificats suivants :</p>
<ul>
<li>un certificat client de type ORG AUTH_CLI pour s’authentifier au DMP ;</li>
<li>un certificat client de type ORG SIGN pour signer les lots de documents soumis au DMP</li>
</ul>
</blockquote>
<p>L&rsquo;dministrateur technique doit commander les certificats via le formulaire n°413 et le retourner à <a href="mailto:monserviceclient.certificats@asipsante.fr">monserviceclient.certificats@asipsante.fr</a>
Le formulaire peut être télécharger depuis le site : <a href="https://esante.gouv.fr/securite/cartes-et-certificats/commandes">https://esante.gouv.fr/securite/cartes-et-certificats/commandes</a></p>
<h2 id="procédure-technique">Procédure Technique</h2>
<p>Il est possible de commander ces certificats sur le site web mis à disposition par l&rsquo;ANS. Il s&rsquo;agit d&rsquo;un service permettant la commande de certificats et cartes :</p>
<p><a href="https://pfc.eservices.esante.gouv.fr">https://pfc.eservices.esante.gouv.fr</a></p>
<p>Pour pouvoir y accéder il faut se connecter avec un lecteur de cartes CPS configuré et une carte CPA autorisée au préalable :</p>
<p><img src="pfcngAccueil.png" alt="pfcngAccueil.png"></p>
<h3 id="certificats-et-clés-dauthentification">Certificats et clés d&rsquo;authentification</h3>
<h4 id="demander">Demander</h4>
<h5 id="étape-1">Étape 1:</h5>
<p><img src="pfcngDemandeStep1.png" alt="pfcng"></p>
<h5 id="étape-2">Étape 2:</h5>
<p>RAS, il s&rsquo;agit d&rsquo;un écran de recherche pour les demandes antérieures. Cliquer sur &ldquo;Demander un nouveau produit&rdquo;</p>
<h5 id="étape-3">Étape 3:</h5>
<p>Il faut renseigner :</p>
<ul>
<li>l&rsquo;usage : AUTH_CLI</li>
<li>le nom du service (nom du logiciel) qui va accéder au DMP,</li>
<li>son adresse email (utiliser plus tard pour envoyer une confirmation)</li>
</ul>
<p><img src="pfcngDemandeStep3Auth.png" alt="pfcng"></p>
<h5 id="étape-4-">Étape 4 :</h5>
<p>Pour cette étape le plus simple est de générer la CSR sur le site, mais pas obligatoire.</p>
<ul>
<li>Saisir un mot de passe assez fort pour convenir au service, et sauvegarder le car il sera demandé lors de la récupération du certificats P12, ainsi que pour configurer la DevBox-Santé DMP.</li>
<li>Cliquer sur &ldquo;Générer la CSR&rdquo;, puis &ldquo;Finaliser&rdquo;</li>
</ul>
<p><img src="pfcngDemandeStep4GenerateCSR.png" alt="pfcng"></p>
<h5 id="étape-5-">Étape 5 :</h5>
<p>Vous recevez un email de confirmation de la demande à l&rsquo;email saisie à l&rsquo;étape 3 :</p>
<h4 id="retirer">Retirer</h4>
<p>Depuis l&rsquo;étape 5 de la demande vous pouvez accéder au retrait du certificat commandé. Sinon vous pouvez y accéder par le menu Retirer</p>
<h5 id="étape-1-1">Étape 1:</h5>
<p>Cette étape consiste à choisir le produit à retirer</p>
<p><img src="pfcngRetirerStep1.png" alt="pfcng"></p>
<h5 id="étape-2-1">Étape 2:</h5>
<p>Dans cette étape, il faut saisir un nouveau mot de passe pour les révocations (identique ou pas de celui de la CSR). Il n&rsquo;est pas utilisé dans l&rsquo;API mais peut servir à l&rsquo;administrateur technique.</p>
<p><img src="pfcngRetirerStep2.png" alt="pfcng"></p>
<h4 id="étape-3-finalisation">Étape 3: Finalisation</h4>
<p>Dans cette étape, il faut saisir le mot de passe de réconciliation celui qui a permis de générer la CSR.</p>
<p><img src="pfcngRetirerStep3.png" alt="pfcng"></p>
<p>Le certificat/clé (p12) a un nom qui doit ressembler à asip-p12-EL-TEST-ORG-AUTH_CLI-20170603-173116.p12</p>
<h3 id="certificats-et-clés-de-signature">Certificats et clés de signature</h3>
<p>Pour la signature, il faut faire une autre demande avec le même process, à l&rsquo;exception de l&rsquo;étape 3 ou il faudra demander un certificat de signature : Usage SIGN</p>
<p><img src="pfcngDemandeStep3Sign.png" alt="pfcng"></p>
<h2 id="configuration-de-la-devbox-santé-dmp">Configuration de la DevBox-Santé DMP</h2>
<p>Le paramètrage de ces certificats pour la DevBox-Santé DMP se trouve dans le <code>application.yml</code></p>
<ul>
<li><code>dmpc.url.prefix</code></li>
<li><code>dmpc.smime.p12.path</code></li>
<li><code>dmpc.smime.p12.password</code></li>
<li><code>dmpc.ssl.p12.path</code></li>
<li><code>dmpc.ssl.p12.password</code></li>
<li><code>dmpc.ssl.trust.path</code></li>
</ul>
<p>Exemple de configuration à fournir :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">dmpc</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#8f5902;font-style:italic"># informations relatives au certificat smime</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">smime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">p12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#8f5902;font-style:italic">#./smime.p12</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">A_renseigner </span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">A_renseigner</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># informations relatives au certificat ssl</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">ssl</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">p12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#8f5902;font-style:italic">#ssl.p12</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">A_renseigner</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">A_renseigner</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># Contient les certificats serveurs autorisés pour authentification mutuelle         </span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">trust</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">truststoreIgcSante-EL-ORG.jks</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-53b7f8f0f608f33d1a397afec2bc84bc">1.6.2 - Schematron</h1>
    <div class="lead">Validation manuelle des CDA générés par la DevBox-Santé DMP lors de l&rsquo;homologation</div>
	<h3 id="utilisation-des-outils-disponibles-sur-le-site-esantegouvfr">Utilisation des outils disponibles sur le site esante.gouv.fr</h3>
<p>Afin de valider manuellement les CDA générés par la DevBox-Santé DMP il faut utiliser les outils de vérification fournit sur le site esante.gouv.fr : 
<a href="https://esante.gouv.fr/annexe-outil-de-verification-des-documents-cda">https://esante.gouv.fr/annexe-outil-de-verification-des-documents-cda</a></p>
<p>La version lors de la rédaction : <a href="https://esante.gouv.fr/sites/default/files/media_entity/documents/testContenuCDA_20200609_V2.25.zip">https://esante.gouv.fr/sites/default/files/media_entity/documents/testContenuCDA_20200609_V2.25.zip</a></p>
<p>Une fois téléchargé, il faut sur un poste windows :</p>
<ul>
<li>décompresser l&rsquo;archive.</li>
<li>naviguer jusqu&rsquo;à <code>testContenuCDA_20200609_V2.25\schematrons\moteur\gui</code></li>
<li>lancer l&rsquo;exécution de <code>TCC-GUI.exe</code></li>
<li>copier le fichier cda à valider à la racine du <code>testContenuCDA_20200609_V2.25</code></li>
<li>cliquer sur générer le rapport :</li>
</ul>
<p><img src="schematronRapport.png" alt="Rapport Schematron CDA"></p>
<h3 id="utilisation-de-lespace-de-tests-de-lans">Utilisation de l&rsquo;espace de tests de l&rsquo;ANS</h3>
<p>Sur le site <a href="https://interop.esante.gouv.fr">interop.esante.gouv.fr</a> ou plus exactement <a href="https://interop.esante.gouv.fr/EVSClient/cda/validator.seam?standard=CDA-ASIP&amp;extension=ASIP">https://interop.esante.gouv.fr/EVSClient/cda/validator.seam?standard=CDA-ASIP&amp;extension=ASIP</a></p>
<p>Une fois sur le site :</p>
<ul>
<li>Il vous faut télécharger votre fichier CDA</li>
<li>Choisir le schematron à valider : &ldquo;Structuration minimale des documents de santé&rdquo; par exemple 
<img src="External_Validation_Service_Front-end_1.png" alt="External Validation Service Front-end_1"></li>
<li>Cliquer sur valider
<img src="External_Validation_Service_Front-end_2.png" alt="External Validation Service Front-end_1"></li>
</ul>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-2072c7e8915f01be9a626ddb4b2ec2e5">1.6.3 - Integrateurs checklist</h1>
    <div class="lead">Liste des actions à réaliser pour mener à bien une intégration du composant DevBox-Santé DMP et faciliter son homologation.</div>
	<h2 id="administratif">Administratif</h2>
<ul>
<li>
<p>Obtenir un NIE auprès du CNDA</p>
</li>
<li>
<p>Signer un protocole avec le CNDA : <a href="https://cnda.ameli.fr/editeurs/telecharger-les-protocoles/">https://cnda.ameli.fr/editeurs/telecharger-les-protocoles/</a></p>
<ul>
<li>Obtenir les cartes vitales de test DMP</li>
</ul>
</li>
<li>
<p>Obtenir des cartes CPS de test (médecin, CPE, autre) auprès de l&rsquo;ANS</p>
</li>
</ul>
<h2 id="architecture">Architecture</h2>
<ul>
<li>
<p>Choisir un mode d&rsquo;intégration/ authentification</p>
<ul>
<li>les moyens d&rsquo;authentification de l&rsquo;utilisateur doivent permettre l&rsquo;identification unique de l&rsquo;utilissateur</li>
<li>le PS a-t-il accès à sa carte CPS ?</li>
<li>Se rappeler que l&rsquo;éditeur agit pour le compte d&rsquo;un établissement de santé (RPPS)</li>
<li>Un certificat serveur est lié au FINESS géographique de l&rsquo;établissement de santé.</li>
</ul>
</li>
<li>
<p>Choisir les profils d&rsquo;intégration</p>
<ul>
<li>création / administration de DMP (DEPRECATED)</li>
<li>alimentation</li>
<li>consultation</li>
</ul>
</li>
</ul>
<h2 id="développement--intégration">Développement / Intégration</h2>
<p>Pour cela  :</p>
<ul>
<li><a href="../embedded">mode API java</a></li>
<li><a href="../rest">mode REST</a></li>
</ul>
<h2 id="validation">Validation</h2>
<ul>
<li>
<p>Répondre aux exigences du PDV filtré par DevBox-santé</p>
<p>le dernier pdv disponible : <a href="https://docs.google.com/spreadsheets/d/1cMSql9SCJQP-NAH0ToeSXWNBAXi16Ty_/edit?usp=drive_web&amp;ouid=106855870534714244391&amp;rtpof=true">https://docs.google.com/spreadsheets/d/1cMSql9SCJQP-NAH0ToeSXWNBAXi16Ty_/edit?usp=drive_web&amp;ouid=106855870534714244391&amp;rtpof=true</a></p>
</li>
<li>
<p>Dérouler le plan de test prehomologation filtrés pour validation DEVCOOP
==&gt; Génération rapport du respect des exigences par DEVCOOP</p>
<ul>
<li>s&rsquo;assurer de la génération de PDF/A</li>
</ul>
</li>
</ul>
<h2 id="processus-dhomologation">Processus d&rsquo;homologation</h2>
<p><a href="https://cnda.ameli.fr/editeurs/referencer-un-logiciel/dmp/">https://cnda.ameli.fr/editeurs/referencer-un-logiciel/dmp/</a></p>
<h2 id="déploiement">Déploiement</h2>
<h3 id="gestion-des-certificats">Gestion des certificats</h3>
<ul>
<li><a href="/docs/dmp/howtos/gestioncertificat/">Dans le cas d&rsquo;une authentification indirecte pour les établissements</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f98f9f3ea4cdf6312fc48ed88daeadcf">1.6.4 - Paramètrage de la DevBox-santé DMP</h1>
    <div class="lead">Comment paramètrer le DMP</div>
	<p>Comme toute application spring-boot la DevBox-Santé DMP se configure au travers du fichier <code>application.yml</code></p>
<p>Nous pouvons donc configurer l&rsquo;application spring boot.</p>
<h3 id="logging">Logging</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#204a87;font-weight:bold">logging.level</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">fr.devboxsante</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">info</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">fr.devcoop</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">warn</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">org.springframework</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">error</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="spécifique-au-dmp">Spécifique au DMP</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">dmpc</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">nomenclature</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic">#Url des jeux de valeurs utilisés pour le DMP</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">resourceName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">JDV DMP_API_V2_XML.zip</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic">#Encodage de caractère utilisé dans ces jeux de valeurs.</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">charset</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">UTF-8</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">parameters</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># Url du document xml contenant le paramétrage du DMP [FI-URL]</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">url</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://www.dmp.fr/web/dmp/documents/param-lps</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">delayBetweenSyncInHours</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">24</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">document</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">checkHash</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># path vers les resources de validation CDA. </span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># la resource peut être récupéré directement depuis le site de esante.gouv.fr ou depuis les resources fournies</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">cda.validator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#        resourceName: https://esante.gouv.fr/sites/default/files/media_entity/documents/testContenuCDA_20200609_V2.25.zip</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">resourceName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">testContenuCDA_20190903_V2.14.zip</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">charset</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ISO-8859-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">#serveur de temps</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">time.ntpServer</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fr.pool.ntp.org</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">patient.autorite</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># INS NIR test : 1.2.250.1.213.1.4.10</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># INS NIR démo: 1.2.250.1.213.1.4.11</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># INS NIR réel: 1.2.250.1.213.1.4.8</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">nir</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1.2.250.1.213.1.4.10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>Dont Les urls du DMP </p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">dmpc</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">url.prefix</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># environnement production</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#000">https://lps-igc-sante.dmp.gouv.fr/</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">url.web.prefix</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># environnement production</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#000">https://ledmp.dmp.gouv.fr</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        
</span></code></pre></div><h3 id="les-informations-du-lps-homologuée">Les informations du LPS homologuée</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">lpsInfo</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">homologationId</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">XXX-xxxxxx-xxx</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">x.0</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">nom</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">VOTRE_LOGICIEL</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic">#Numéro de série ou identifiant de l&#39;installation du logiciel </span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1.2.250.1.287.1</span><span style="color:#000">.</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">source</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#8f5902;font-style:italic"># 1.2.250.1.287 est l&#39;OID de Devcoop</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#8f5902;font-style:italic"># 1.2.250.1.287.1 est l&#39;OID correspondant à la DMPC pour Devcoop</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">idRoot</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1.2.250.1.287.1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">idExtension</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1234567</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h2 id="différents-modes-dauthentification">Différents modes d&rsquo;authentification</h2>
<p>Les modes d&rsquo;authentification supportés par la DevBox-Santé DMP sont les deux demandés dans le guide d&rsquo;intégration du DMP.
Il s&rsquo;agit du mode d&rsquo;authentification directe (avec l&rsquo;usage de la carte CPS) et indirecte (avec l&rsquo;usage des certificats serveurs)</p>
<h3 id="authentification-directe">Authentification directe</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">dmpc</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># authentification directe utilisant les certificats de la carte CPS</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">security.mode</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cps</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">ssl</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">trust</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">truststoreIgcSante-EL-ORG.jks</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="authentification-indirecte">Authentification indirecte</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">dmpc: </span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># authentification indirecte utilisant les certificats p12 serveurs</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">security.mode</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">p12</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># informations relatives au certificat smime</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">smime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">p12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">asip-p12-EL-TEST-ORG-SIGN-xxxx.p12</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">password</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># informations relatives au certificat ssl</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">ssl</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">p12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">asip-p12-EL-TEST-ORG-AUTH_CLI-xxxx.p12</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">password</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">trust</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">truststoreIgcSante-EL-ORG.jks</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="authentification-directe--cpsagent">Authentification directe : CPS Agent</h3>
<p>Un mode d&rsquo;authentification intégrant le module CPS agent est possible de la manière suivante :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000">dmpc: </span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># authentification directe depuis le backend par l&#39;intermédiaire d&#39;un agent CPS sur le poste du client</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">security.mode</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">withCpsAgent</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-78fb0c46f2d88b360cb6b80ccd009bce">1.7 - Versions</h1>
    <div class="lead">Note sur les différentes versions de la DevBox-Santé DMP</div>
	<div class="csg-wrapper" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; font-size: 14px; font-weight: 400; line-height: 24px; vertical-align: baseline;"><h1 class="csg-h1" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 23px; line-height: 1.1034; margin-top: 40px; letter-spacing: -0.01em;">DMP - Version 4.5 (07/10/2021)</h1>
<h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Version compatible `SEL-MP-037 DMPi v2.5.0` validé sur `Package GIE SV 02.05.00` </h3>
<h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Story</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-152" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-152</a> [CDA] valider document structuration minimale sur la version 2.34</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-150" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-150</a> Migration DMP LPS Schemas v2.01.02</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-149" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-149</a> [EX-3.2-1030] Manque la récupération du CDAHeader dans le proxy</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-148" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-148</a> [TD11] dépreciée/suppression de la transaction de création DMP (version 2.4 spec)</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-147" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-147</a> [TD00] dépréciée la méthode (spec 2.4)</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-106" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-106</a> [WSDL_SCHEMA] mettre à jour les schémas et WSDL vers la version courant du DMP</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-104" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-104</a> [Validation] prendre en charge la dernière version du contenu CDA</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-100" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-100</a> [DMPCWsClientException] Gestion des logs</p><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Tâche</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-153" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-153</a> Homologation v2.5</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-90" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-90</a> [nomenclature] mise à jour des jeux de valeurs</p></div>
<div class="csg-wrapper" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; font-size: 14px; font-weight: 400; line-height: 24px; vertical-align: baseline;"><h1 class="csg-h1" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 23px; line-height: 1.1034; margin-top: 40px; letter-spacing: -0.01em;">Version 4.0.2  (07/07/2021)</h1><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Bug</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-146" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-146</a> [TD31Find] erreur lors d'un retour vide :  [XDSStoredQueryMissingParam] parameterName=$uuid</p></div>
<div class="csg-wrapper" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; font-size: 14px; font-weight: 400; line-height: 24px; vertical-align: baseline;"><h1 class="csg-h1" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 23px; line-height: 1.1034; margin-top: 40px; letter-spacing: -0.01em;">Version 4.0.1  (21/06/2021)</h1><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Bug</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-141" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-141</a> [Proxy] Probleme conversion de la réponse TD33</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-138" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-138</a> [TD31] DMPCClient find converter ne remonte pas le typeCode</p><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Story</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-140" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-140</a> [TD31] findDocumentsBySubmissionTime</p></div>
<div class="csg-wrapper" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; font-size: 14px; font-weight: 400; line-height: 24px; vertical-align: baseline;"><h1 class="csg-h1" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 23px; line-height: 1.1034; margin-top: 40px; letter-spacing: -0.01em;">Version 4.0  (03/05/2021)</h1>
<h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Version compatible `SEL-MP-037 DMPi v2.3.0` validé sur `PDV_HOM_20210129_v2.3.0` </h3>
<h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Bug</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-135" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-135</a> Problème version bouncycastle</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-132" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-132</a> L'autorite du personneldesante dans le cas CPS est celui de la structure</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-127" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-127</a> [Consultation] permettre la remontée de document avec des entryUuids qui n'en sont pas</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-124" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-124</a> [TLS] session TLS reste ouvert sur carte CPS</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-116" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-116</a> [REST] remonter les exceptions correctement au client</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-108" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-108</a> [REST] td32 retrieveContent</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-105" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-105</a> [CPS] chargement de la carte CPS au démarrage du proxy.</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-102" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-102</a> [HL7V25] typeCode SP inconnu</p><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Story</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-143" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-143</a> [SHA1] deprecated</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-133" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-133</a> [TD32] le find ne renvoit pas d'erreur si non retrouvé</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-131" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-131</a> [Indirect] Le P12AuthenticationContextHandler ne doit s'intéresser à des identifiants internes</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-130" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-130</a> [TD09] prendre en compte l'ex_0.9-1030</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-129" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-129</a> [OpenSaml] migrer vers la version 3.4</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-126" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-126</a> [Nomenclature] mettre à jour jdV</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-125" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-125</a> [UniqueIdGenerator] le num séquence de fin sur un modulo</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-123" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-123</a> [FindDocuments] changer la cardinalité dans les filtres des codes</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-120" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-120</a> TimeManager : policy of retry</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-119" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-119</a> DmpParameterManager : innutile de le charger au démarrage</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-118" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-118</a> [Configuration] dmpc -&gt; devbox-sante.dmp</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-117" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-117</a> [Maven enforcer ] incohérence de certaines dépendances</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-115" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-115</a> [URL web] intégration PDT-INF-547</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-114" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-114</a> VIHF expiré</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-113" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-113</a> TD3.3d : archiver / désarchiver un document</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-112" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-112</a> TD3.3b : rendre un document visible au patient ou à ses representants légaux</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-111" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-111</a> TD3.3a : masquer / démasquer un document aux PS</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-110" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-110</a> [TD0.9] permettre l'obtention des infos de redirect</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-109" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-109</a> [TD31 listener] ajout d'un listener de recherche</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-107" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-107</a> [CXF.version] mise à jour de la version Cxf avec celle du bom</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-103" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-103</a> [Validation] DMPCContexte sans auteur Id en authentification indirecte</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-101" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-101</a> [DMPC-API] ajout des annotations json swagger</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-98" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-98</a> Mise en place de Lombok</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-97" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-97</a> [Consultation] DMP_3.2 : consulter des documents dans le DMP d’un patient (via TD3.2)</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-96" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-96</a> Renomage des modules es packages en fr.devboxsante.dmp</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-91" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-91</a> JDK11 migration</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-79" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-79</a> [Technique] Migration spring boot 2 , utilisation du bom devbox-sante</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-75" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-75</a> [TD31] support de la recherche de documents</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-45" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-45</a> Charger le cda.validator.toolPath depuis le classpath</p><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Tâche</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-122" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-122</a> [Homologation] passage homologation DEVCOOP consultation</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/DMP-80" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">DMP-80</a> [test] migration vers springboot test abandon testng</p></div>

</div>



    
      
  
  
  
  

  
  

  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-de2277b97361850960224a7d2972cc24">2 - INSi</h1>
    <div class="lead">Téléservice Identité National de Santé (INS) intégré aux LPS</div>
	<p>Ce projet contient l&rsquo;API java proposé par la DevBox-santé pour l&rsquo;intégration du téléservice. Pour une description de l&rsquo;INS, consultez la page de l&rsquo;ANS : https://esante.gouv.fr/securite/identite-nationale-de-sante</p>
<p>Elle est basée sur le Guide d&rsquo;intégration du GIE SESAM-Vitale SEL-MP-043 : <a href="https://www.sesam-vitale.fr/documents/20182/75606/SEL-MP-043_01-00_INSi+sans+MR/92d6e408-012d-4dc5-9fd1-d3bdda78735a">https://www.sesam-vitale.fr/documents/20182/75606/SEL-MP-043_01-00_INSi+sans+MR/92d6e408-012d-4dc5-9fd1-d3bdda78735a</a></p>
<p>Cette API respecte quand c&rsquo;est possible le <a href="https://esante.gouv.fr/interoperabilite/mos-nos">Modèle d&rsquo;Objet de Santé proposé par l&rsquo;ANS</a></p>
<h3 id="glossaire">Glossaire</h3>
<ul>
<li><strong>ANS</strong> : Agence du Numérique en Santé</li>
<li><strong>CPS / CPx</strong> : Carte de Professionnel de Santé</li>
<li><strong>INS</strong> : Identité National de Santé</li>
<li><strong>INSi</strong> : Identité National de Santé integré</li>
<li><strong>MOS</strong> : Modèle d&rsquo;Objets de Santé</li>
</ul>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-00b4e8e7e9c9fde6d61dbb9403a604c9">2.1 - Java API</h1>
    <div class="lead">Intégrer directement dans votre application spring-boot</div>
	<h2 id="insi-client">INSi Client</h2>
<p>Le module insi-impl, fournit l&rsquo;implémentation de la facade <code>INSiClient</code> qui intègre les composant devboxsante-cps-api et devboxsante-vitale-api et accède au téléservice INSi géré par SesamVitale.</p>
<p>Exemple de code dans une application Spring Boot :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">MonIntegrationINSi</span> <span style="color:#ce5c00;font-weight:bold">{</span>

    <span style="color:#5c35cc;font-weight:bold">@Autowired</span>
    <span style="color:#000">INSiClient</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">maMethode</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#8f5902;font-style:italic">// ma recherche avec carte vitale
</span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">INSiContext</span> <span style="color:#000">context</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">INSiContext</span><span style="color:#ce5c00;font-weight:bold">();</span>
        <span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setIdentifiantFacturation</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;3333333&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ins1RechercheAvecVitale</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">);</span>

        <span style="color:#8f5902;font-style:italic">// ma recherche sans carte vitale
</span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">INS2Requete</span> <span style="color:#000">requete</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">INS2Requete</span><span style="color:#ce5c00;font-weight:bold">();</span>
        <span style="color:#000">requete</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setDateNaissance</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;01011981&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">requete</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setIdentifiantFacturation</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;3333333&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">requete</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setNomNaissance</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;ADRDEUX&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">requete</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setSexe</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Sexe</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">M</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">requete</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPrenoms</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Collections</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">singletonList</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;LAURENT&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span>
        <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ins2RechercheAvecTraitIdentite</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">requete</span><span style="color:#ce5c00;font-weight:bold">);</span>

        <span style="color:#8f5902;font-style:italic">// ma vérification 
</span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">INS3Requete</span> <span style="color:#000">requete</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">INS3Requete</span><span style="color:#ce5c00;font-weight:bold">();</span>
        <span style="color:#000">requete</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setIns</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">INSWithCle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">newInstance</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;1810163220751&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;40&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">INSAutorite</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">INS_NIR</span><span style="color:#ce5c00;font-weight:bold">));</span>
        <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">TraitsIdentiteINS</span> <span style="color:#000">traits</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TraitsIdentiteINS</span><span style="color:#ce5c00;font-weight:bold">();</span>
        <span style="color:#000">traits</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setNomFamille</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;ADRDEUX&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">traits</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPrenom</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;LAURENT&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">traits</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setListePrenoms</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;LAURENT&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">traits</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setSexeAdministratif</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Sexe</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">M</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">traits</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setDateNaissance</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;1981-01-01&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">requete</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setTraitsIdentite</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">traits</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ins3Verification</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">requete</span><span style="color:#ce5c00;font-weight:bold">);</span>
   <span style="color:#ce5c00;font-weight:bold">}</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4840a95263433cd2eecdfa84790ab794">2.2 - REST Proxy</h1>
    <div class="lead">Une interface REST pour le Téléservice INSi</div>
	<p>Le module insi-proxy, permet de fournit une facade REST à la facade <code>INSiClient</code> java.
Toutes les opérations offertes par la la façade java sont disponibles via des appels http sur le poste local.</p>
<p>L&rsquo;accès a l&rsquo;insi-proxy est donc indépendant de la technologie utilisée par l&rsquo;intégrateur. Exemple d&rsquo;intégration possible :</p>
<pre tabindex="0"><code class="language-plantuml" data-lang="plantuml">!include https://bitbucket.org/devbox-sante/plantuml/raw/3/themes/theme-devbox-sante.puml


node &quot;Poste Client (Windows/Mac/Linux)&quot; {
    [FrontEnd intégrateur] as frontend 

    package &quot;DevBox-Santé&quot; DEVBOX_COLOR  {
        component &quot;DevBoxSanté INSi&quot; as insFacade INS_COLOR {
            [DevBoxSanté CPS] as cps CPS_COLOR
            [DevBoxSanté Vitale] as vitale VITALE_COLOR
        }

    }
    [Cryptolib CPS (ANS / ASIP)] as cryptolibCPS 
    [APILectureVitale (SesamVitale)] as apiLectureVitale 
}

cloud &quot;Téléservice **INSi** (SesamVitale)&quot; as insi

[BackEnd intégrateur] as backend 



frontend -u-&gt; backend : REST
frontend -down-&gt; insFacade : HTTP GET /insi/rechercheAvecVitale
cps &lt;-down-&gt; cryptolibCPS : appel natif
vitale &lt;-down-&gt; apiLectureVitale : appel natif
insFacade &lt;-d-&gt; insi : SOAP


</code></pre><h3 id="installation-du-proxy">Installation du Proxy</h3>
<p>Procédure : </p>
<ul>
<li>Doit être installé environnement Java 11 ou supérieur</li>
<li>Télécharger le proxy-rest mis à disposition</li>
</ul>
<h4 id="lancement">Lancement</h4>
<p>Le livrable s&rsquo;agit d&rsquo;un jar exécutable, qui se lance de la manière suivante</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">java -jar insi-proxy-rest-*.jar
</code></pre></div><p>Le composant est accessible depuis le poste local en HTTP sur l&rsquo;adresse ip 127.0.0.1 avec un numéro de port configurer par défaut :</p>
<ul>
<li>mode de sécurité cps : 8484</li>
<li>mode de sécurité p12 : 8485</li>
<li>mode de sécurité p12s : 8486</li>
</ul>
<p>Afin de valider le fonctionnement, ouvrir un navigateur à l&rsquo;adresse suivante : http://127.0.0.1:PORT</p>
<p><img src="insi-browser.png" alt="insi-proxy browser"></p>
<h3 id="intégration">Intégration</h3>
<p>L&rsquo;ensemble des requêtes sont documentées via l&rsquo;interface swagger et sont accessibles sur l&rsquo;url suivante : http://127.0.0.1:PORT/swagger-ui.png</p>
<p><img src="insi-swagger.png" alt="insi-proxy swagger"></p>
<h3 id="configuration">Configuration</h3>
<p>Les paramètres de configuration du composant DevBox-santé INSi se réalise dans le fichier <code>application.yml</code>.
Outre les configurations liées à la sécurité et le port HTTP utilisé, la configuration est identique à celle du <a href="../configuration">mode embedded</a>.</p>
<h3 id="utilisation-de-linstaller-devbox-santé">Utilisation de l&rsquo;installer DevBox-Santé</h3>
<p>La DevBox Santé propose des solutions de &ldquo;packaging&rdquo; des différents modules, pour Windows, MacOS et Linux.</p>
<p>Pour tester ces solutions <a href="mailto:devbox-sante@devcoop.fr">Contactez-nous</a></p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a254dbdfb22e46087426b0d84581233e">2.2.1 - Conformité CNDA</h1>
    <div class="lead">Quelques exemples de requêtes JSON des tests de conformité du CNDA</div>
	<p>Les tests sont décrits dans le document <code>SEL-GCONFORM_INSi_V01.06.pdf</code>. Voici quelques exemples json repris des tests :</p>
<h2 id="ws_ins1">WS_INS1</h2>
<ul>
<li>Cas du POST par lecture des données vitales en amont :
<ul>
<li>Carte vitale INSi 01 DE VINCI Ruth : <a href="./test1_01.json">test1_01.json</a></li>
</ul>
</li>
</ul>
<h2 id="ws_ins2">WS_INS2</h2>
<ul>
<li><a href="./test2_03_cas1.json">test2_03_cas1.json</a></li>
</ul>
<h2 id="ws_ins3">WS_INS3</h2>
<ul>
<li><a href="./test3_01.json">test3_01.json</a></li>
</ul>
<h2 id="ws_ins4">WS_INS4 </h2>
<ul>
<li><a href="./insi_a_verifier_lot1_1.0.1.json">insi_a_verifier_lot1_1.0.1.json</a></li>
<li><a href="./insi_a_verifier_lot2_1.0.1.json">insi_a_verifier_lot2_1.0.1.json</a></li>
<li><a href="./insi_a_verifier_lot3_1.0.1.json">insi_a_verifier_lot3_1.0.1.json</a></li>
</ul>

</div>



    
      
  
  
  
  

  
  

  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d881fa6114d4529ec23c4e26008a07bf">2.3 - Configuration DevBox-santé INSi</h1>
    <div class="lead">Configuration de la DevBox-santé INSi</div>
	<h2 id="configuration--applicationyml">Configuration  <code>application.yml</code></h2>
<p>Pour configurer la DevBox-Santé INSi, il suffit de modifier les paramètres du fichier <code>application.yml</code> :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#204a87;font-weight:bold">devbox-sante</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">insi</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">url</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://qualiflps.services-ps.ameli.fr/lps</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">lpsInfo</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">nom</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">À_CHANGER</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">numeroAutorisation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">À_CHANGER</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">À_CHANGER</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#8f5902;font-style:italic">#Cet élément XML contient l’identifiant d’installation du logiciel. Cet identifiant est généré lors de l’installation du SI-PS. Cet identifiant prend la forme d’un UUID sous sa forme canonique. Il doit être pérenne pour une installation d’un logiciel. Ce numéro est une aide au support, car il permet de regrouper les requêtes d’un même logiciel. Il permet également de compter le nombre de logiciels distincts accédant au TLSi.</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">instance</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">À_CHANGER (UUID)</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#8f5902;font-style:italic"># Pour les établissements, numéro FINESS géographique. Pour les autres, identifiant AM de facturation. C&#39;est le numéro par défaut qui peut être surchargé dans chaque requête.</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">identifiantFacturation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">À_CHANGER</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">ci-tls-amo</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">ssl</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">truststore.path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">truststoreIgcSante-EL-ORG.jks</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>Pour charger le fichier de configuration :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">java -Dspring.config.location<span style="color:#ce5c00;font-weight:bold">=</span>./application.yml -jar insi-proxy.jar
</code></pre></div><h3 id="mode-de-sécurité">Mode de sécurité</h3>
<p>Il existe trois modes d&rsquo;authentification pour accéder au téléservice INSi dans le composant DevBox-Santé :</p>
<ul>
<li>CPS : génération des signatures des messages SOAP en utilisant la cryptolib CPS au travers du composant DevBox-Santé CPS.</li>
<li>P12 : initialisation des connexion TLS avec le Téléservice INSi avec un certificat d&rsquo;établissement p12</li>
<li>P12Multiple : permet la connexion TLS avec plusieurs certificats d&rsquo;établissements p12</li>
</ul>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Attention</h4>

    les urls des téléservices sont différents en fonction du mode d&rsquo;authentification

</div>

<h4 id="cps">CPS </h4>
<ul>
<li>Mode de sécurité <code>CPS</code>, dans le fichier de configuration <code>application.yml</code> :</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#204a87;font-weight:bold">devbox-sante</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">insi</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">security.mode</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cps</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># url: https://qualiflps.services-ps.ameli.fr/lps</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">url</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://lps.services-ps.ameli.fr/lps</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>Utiliser ce mode de sécurité pour l&rsquo;utilisation du composant avec l&rsquo;authentification par carte CPS.</p>
<h4 id="p12">P12</h4>
<p>Ce mode de sécurité <code>P12</code>, permet le chargement d&rsquo;un fichier p12 défini le fichier de configuration <code>application.yml</code> :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#204a87;font-weight:bold">devbox-sante</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">insi</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">security.mode</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">p12</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># url: https://qualiflps-services-ps-tlsm.ameli.fr/lps</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">url</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://services-ps-tlsm.ameli.fr/lps</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">tls.p12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">À_CHANGER_NOM_FICHIER.p12</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">À_CHANGER_MOT_DE_PASSE_FICHIER.p12</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>Utiliser ce mode de sécurité pour l&rsquo;utilisation du composant avec l&rsquo;authentification par certificat serveur.</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Remarque</h4>

    Il existe deux types de certificat les <code>INSI-AUTO</code> et les <code>INSI-MANU</code>. Il s&rsquo;agit d&rsquo;une règle de nommage défini dans les spécifications. Il est demandé par le CNDA d&rsquo;utiliser des certificats <code>INSI-MANU</code> pour tout accès au téléservice INSi par des acteurs humains, et <code>INSI-AUTO</code> pour des accès par des acteurs de traitements automatiques, types batchs.

</div>

<h4 id="p12multiple">P12 Multiple</h4>
<p>Ce mode de sécurité <code>p12s</code> permet de gérer en une seule installation l&rsquo;ensemble des connexions des différents établissements d&rsquo;un SIH.</p>
<p>Un <code>AmoP12Provider</code> par défaut va charger un ensemble de fichier P12 à partir de la configuration, comme par exemple :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#204a87;font-weight:bold">devbox-sante</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">insi</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">security.mode</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">p12s</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># url: https://qualiflps-services-ps-tlsm.ameli.fr/lpss</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#000">url: https://services-ps-tlsm.ameli.fr/lps</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">tls</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">           </span><span style="color:#204a87;font-weight:bold">p12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">             </span>- <span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">etablissement1-manu</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">PREMIER_CERTIFICAT_MANU.p12</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#204a87;font-weight:bold">password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">À_CHANGER_MOT_DE_PASSE_FICHIER</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">             </span>- <span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">etablissement2-manu</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DEUXIEME_CERTIFICAT_MANU.p12</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#204a87;font-weight:bold">password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">À_CHANGER_MOT_DE_PASSE_FICHIER</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">             </span>- <span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">etablissement1-manu</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">AUTRE_CERTIFICAT_AUTO.p12</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#204a87;font-weight:bold">password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">À_CHANGER_MOT_DE_PASSE_FICHIER</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>Il est toutefois possible de définir un autre <code>AmoP12Provider</code>, il suffit de configurer un nouvau Bean Spring avec une autre implémentation. Comme par exemple, une implémentation qui va charger le certificat en base de données :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#5c35cc;font-weight:bold">@Component</span>
 <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">FromDatabaseP12Provider</span> <span style="color:#204a87;font-weight:bold">implements</span> <span style="color:#000">AmoP12Provider</span> <span style="color:#ce5c00;font-weight:bold">{</span>

    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">AmoP12</span> <span style="color:#000">getP12</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">name</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#8f5902;font-style:italic">// chargement en base de donnée des informations du certificat ayant pour nom name.
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#ce5c00;font-weight:bold">}</span>
 <span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><p>Pour charger dynamiquement un certificat il suffit de rajouter le nom du certificat (<code>amoP12.name</code>) dans le header de la requête HTTP :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X GET <span style="color:#4e9a06">&#34;http://localhost:8584/insi/rechercheSansVitale&#34;</span> -H <span style="color:#4e9a06">&#34;accept: application/json&#34;</span> -H <span style="color:#4e9a06">&#34;amoP12.name: ÀPréciser&#34;</span>
</code></pre></div><h3 id="jeu-de-test-cnda">Jeu de test CNDA</h3>
<p>Afin de pouvoir exécuter les tests d&rsquo;injection demandées par le CNDA, il faut lancer le proxy avec l&rsquo;un des profils spring activés suivant :</p>
<ul>
<li><code>CNDA_WEB</code> : rajoute un nouvel endpoint CNDA permettant l&rsquo;injection des fichiers de test XML du CNDA.</li>
<li><code>CNDA</code> : rajoute un menu dans le <code>TrayIcon</code> du système d&rsquo;exploitation permettant l&rsquo;injection des fichiers de test XML du CNDA.</li>
</ul>
<p>Exemple :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">java -Dspring.profiles.active<span style="color:#ce5c00;font-weight:bold">=</span>CNDA_WEB -jar insi-proxy.jar
</code></pre></div><h3 id="configuration-de-la-sécurité">Configuration de la sécurité</h3>
<p>Le cps-proxy est une application web Spring Boot, toutes les possibilités de spring-security sont donc disponibles.</p>
<p>Exemple de configuration par défaut empêchant toutes les IPs externes :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#204a87;font-weight:bold">devbox-sante</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">cps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">security</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">authorizedIpAddress</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">127.0.0.1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="surcharge-les-lpsinfo-dans-le-proxy">Surcharge les LpsInfo dans le proxy</h3>
<p>La configuration du proxy contient les informations par défaut de configuration du LPS (Logiciel de Professionnel de Santé) cf. paragraphe précédent.
Il est toutefois possible de surcharger ces valeurs (comme le numeroAutorisation qui peut être confidentiel) en les passant dans les header HTTP des requêtes.</p>
<p>Par exemple :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X GET <span style="color:#4e9a06">&#34;http://localhost:8485/insi/rechercheAvecVitale&#34;</span> -H <span style="color:#4e9a06">&#34;accept: application/json&#34;</span> -H <span style="color:#4e9a06">&#34;lpsInfo.numeroAutorisation: ÀPréciser&#34;</span>
</code></pre></div><p>Ainsi le client peut dynamiquement passer les informations du LPS.</p>
<h3 id="packaging-et-déploiement">Packaging et Déploiement</h3>
<p>La DevBox Santé <a href="/docs/installer">propose des solutions de &ldquo;packaging&rdquo;</a> des différents modules, pour Windows, MacOS et Linux.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ed9b21891b159f3aa8acbd113b0478ed">2.4 - Howtos</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-f9f83c8618e0150f763410de137ab463">2.4.1 - Integrateurs checklist</h1>
    <div class="lead">Liste des actions à réaliser pour mener à bien une intégration du composant DevBox-Santé INSi et faciliter son homologation.</div>
	

<div class="pageinfo pageinfo-primary">
<pre><code>Page en cours de construction
</code></pre>

</div>

<h1 id="documentation-à-prendre-en-compte">Documentation à prendre en compte</h1>
<h2 id="insi-version-0400">INSi version 04.00</h2>
<p>Dans le <strong>Package INSi 04.00.00</strong> :</p>
<ul>
<li>Fiche d&rsquo;information du contenu du package : <code>PDT-INF-736_Package INSi 04.00.00.pdf</code></li>
<li><strong>Guide d&rsquo;intégration de SesamVitale <code>SEL-MP-043_04-00-00_INSi sans MR.pdf</code></strong></li>
</ul>
<p>Documentation de l&rsquo;ANS :</p>
<p>L&rsquo;ANS fournit un référentiel à tenir compte également dans vos lectures d&rsquo;intégration car elle définit un certain nombre d&rsquo;exigences à respecter</p>
<ul>
<li>Référentiel INS : <a href="https://esante.gouv.fr/sites/default/files/media_entity/documents/ans_referentiel_identifiant_national_de_sante_v2.0.pdf">https://esante.gouv.fr/sites/default/files/media_entity/documents/ans_referentiel_identifiant_national_de_sante_v2.0.pdf</a></li>
<li>Guide d&rsquo;implémentation : <a href="https://esante.gouv.fr/sites/default/files/media_entity/documents/INS_Guide%20implementation_V2_0.pdf">https://esante.gouv.fr/sites/default/files/media_entity/documents/INS_Guide%20implementation_V2_0.pdf</a></li>
<li>RNIV : <a href="https://esante.gouv.fr/securite/identite-nationale-de-sante">https://esante.gouv.fr/securite/identite-nationale-de-sante</a> (ensemble des liens de la page)</li>
</ul>
<h1 id="commande-des-cartes-et-certificats-de-test">Commande des Cartes et Certificats de Test</h1>
<p>Un document de l&rsquo;ANS donne toutes les indications suffisantes pour commander cartes et certificats nécessaires pour les développements :</p>
<p><a href="https://esante.gouv.fr/sites/default/files/media_entity/documents/ans_fiche_commande_cpx_et_certificats_de_test_vf.pdf">https://esante.gouv.fr/sites/default/files/media_entity/documents/ans_fiche_commande_cpx_et_certificats_de_test_vf.pdf</a></p>
<h1 id="intégration-de-la-devbox-santé-insi">Intégration de la DevBox-Santé INSi</h1>
<p>Lire les autres pages de ce site concernant l&rsquo;intégration INSi</p>
<h1 id="passage-de-lhomologation">Passage de l&rsquo;homologation</h1>
<p>TODO</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-aba06791c0ee9b086082de3b426277b1">2.5 - Versions</h1>
    <div class="lead">Note sur les différentes versions de la DevBox-Santé INSi</div>
	<div class="csg-wrapper" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; font-size: 14px; font-weight: 400; line-height: 24px; vertical-align: baseline;"><h1 class="csg-h1" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 23px; line-height: 1.1034; margin-top: 40px; letter-spacing: -0.01em;">Version 2.1 (07/10/2021)</h1><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Story</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/INSI-27" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">INSI-27</a> Mise à jour du front de Démo avec la nouvelle version du modèle.</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/INSI-22" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">INSI-22</a> [P12 Multiple] gestion de p12 multiple</p></div>
<div class="csg-wrapper" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; font-size: 14px; font-weight: 400; line-height: 24px; vertical-align: baseline;"><h1 class="csg-h1" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 23px; line-height: 1.1034; margin-top: 40px; letter-spacing: -0.01em;">Version 2.0 (24/09/2021)</h1>
<h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Version compatible à `SEL-MP-043_04-00-00_INSi ` validé sur `SEL-GCONFORM_INSi_V01.06`</h3>
<h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Bug</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/INSI-24" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">INSI-24</a> NPE lors d'un contexte non renseigné</p><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Story</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/INSI-26" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">INSI-26</a> intégration DevBox-santé CPS 3.0</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/INSI-19" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">INSI-19</a> [WSDL] mettre à jour CONTRAT_IDIR_EXP_1.0.1</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/INSI-18" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">INSI-18</a> [WSDL] mettre à jour CONTRAT_ICIR_EXP_1.5.0</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/INSI-17" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">INSI-17</a> [SEL-MP-043-4] prise en compte des certificats serveurs</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/INSI-16" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">INSI-16</a> [Proxy] version mocké de l'ensemble des téleservices</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/INSI-10" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">INSI-10</a> [SEL-MP-043_03-00-02] prise en compte Batch (vérification de masse)</p></div>
<div class="csg-wrapper" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; font-size: 14px; font-weight: 400; line-height: 24px; vertical-align: baseline;"><h1 class="csg-h1" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 23px; line-height: 1.1034; margin-top: 40px; letter-spacing: -0.01em;">Version 1.4</h1><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Story</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/INSI-15" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">INSI-15</a> [Activité] en cas d'une multiactivités, pouvoir passer l'activité dans le contexte</p></div>
<div class="csg-wrapper" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; font-size: 14px; font-weight: 400; line-height: 24px; vertical-align: baseline;"><h1 class="csg-h1" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 23px; line-height: 1.1034; margin-top: 40px; letter-spacing: -0.01em;">Version 1.3.1</h1><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Bug</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/INSI-14" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">INSI-14</a> [Validation] code insee corse ne passe pas la validation</p></div>
<div class="csg-wrapper" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; font-size: 14px; font-weight: 400; line-height: 24px; vertical-align: baseline;"><h1 class="csg-h1" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 23px; line-height: 1.1034; margin-top: 40px; letter-spacing: -0.01em;">Version 1.3</h1><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Tâche</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/INSI-12" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">INSI-12</a> Mise à jour des api vitale et cps</p></div>
<div class="csg-wrapper" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; font-size: 14px; font-weight: 400; line-height: 24px; vertical-align: baseline;"><h1 class="csg-h1" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 23px; line-height: 1.1034; margin-top: 40px; letter-spacing: -0.01em;">Version 1.2</h1><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Story</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/INSI-9" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">INSI-9</a> Chargement du contexte LPS depuis le header HTTP.</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/INSI-7" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">INSI-7</a> [application.yml] Générer à la volée le numéro d'instance de l'installation à la volée</p></div>
<div class="csg-wrapper" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; font-size: 14px; font-weight: 400; line-height: 24px; vertical-align: baseline;"><h1 class="csg-h1" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 23px; line-height: 1.1034; margin-top: 40px; letter-spacing: -0.01em;">Version 1.0.1</h1><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Story</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/INSI-3" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">INSI-3</a> Retourner une INSiValidationException =&gt; HTTP BadRequest  pour tous les cas où ça se justifie</p></div>
<div class="csg-wrapper" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; font-size: 14px; font-weight: 400; line-height: 24px; vertical-align: baseline;"><h1 class="csg-h1" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 23px; line-height: 1.1034; margin-top: 40px; letter-spacing: -0.01em;">Version 1.0</h1><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Version initiale compatible à `SEL-MP-043_02-00_INSi` validé sur `SEL-GCONFORM_INSi_V01.04`</h3>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1408a5c30f1567083f189a36a65a8491">2.6 - </h1>
    
	
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7fb26e2fc641344abfb815b92f5afec1">3 - MSS</h1>
    <div class="lead">Intégrer les différentes Messageries Sécurisées de Santé</div>
	<h2 id="ms-sante-api">MS-SANTE-API</h2>
<h3 id="lapi-public">L&rsquo;API public</h3>
<p>l&rsquo;API est hébergée sur bitbucket : <a href="https://bitbucket.com/devbox-sante/ms-sante-api">https://bitbucket.com/devbox-sante/ms-sante-api</a></p>
<p>Cette API définie les services disponibles et le modèle d&rsquo;objet.</p>
<h3 id="utilisation">Utilisation</h3>
<p>Deux modes d&rsquo;intégration sont proposées :</p>
<ul>
<li>Embarqué : Intégration directe de l&rsquo;API avec son implémentation dans un projet java 11 spring-boot.</li>
<li>REST : Déploiement d&rsquo;une application spring-boot (jar exécutable intégrant un serveur Tomcat) offrant ces mêmes services en REST.</li>
</ul>
<h3 id="pré-requis">Pré-requis</h3>
<p>Pour pouvoir utiliser le connecteur MS-Santé, il faut au préalable créer un compte selon l&rsquo;opérateur choisi:</p>
<ul>
<li>mailiz:  <a href="https://mailiz.mssante.fr/">https://mailiz.mssante.fr/</a></li>
<li>Apicrypt (en cours de développement): <a href="https://www.apicrypt.org/inscription">https://www.apicrypt.org/inscription</a></li>
</ul>
<h3 id="authentification">Authentification</h3>
<h4 id="mailiz">Mailiz</h4>
<p>2 modes d&rsquo;authentification sont disponibles:</p>
<ul>
<li>par carte CPS (nécéssite l&rsquo;installation du module cps de DevBox-Santé) :</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#000">authentificationWithCps</span><span style="color:#000;font-weight:bold">()</span> 
</code></pre></div><ul>
<li>par carte OTP, cette othentification s&rsquo;effectue en 2 étapes :</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">
    <span style="color:#000">otpParameters</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000">otpCanalType</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">SMS</span> <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Mail</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#8f5902;font-style:italic">// canal pour recevoir l&#39;otp
</span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#000">otpCanalPwd</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">password</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#000">otpIdNat</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">idNat</span> <span style="color:#8f5902;font-style:italic">//(0+adeli ou 8+rpps)
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#000">AuthorizationContext</span> <span style="color:#000">context</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">authentificationWithOtpStep1</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">otpParameters</span><span style="color:#000;font-weight:bold">);</span> 


    <span style="color:#000">context</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">authentificationWithOtpStep2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">otp</span><span style="color:#000;font-weight:bold">)</span> 
    <span style="color:#8f5902;font-style:italic">// dans le cas de service REST, le context est automatiquement géré dans la session, le service retourne alors la liste des emails de l&#39;utilisateur
</span></code></pre></div><h4 id="apicrypt">Apicrypt</h4>
<p>un mode d&rsquo;authentification avec le compagnon :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#000">authentificationWithApiCrypt</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">username</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">password</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="services">Services</h3>
<p>Les services suivants sont disponibles en mode embarqué,
ils ont tous leur équivalent en REST avec l&rsquo;email passé en paramètre.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl  GET https://mss-demo.devbox-sante.fr/mssante/folders?email<span style="color:#ce5c00;font-weight:bold">=</span>xxxxxx@medecin.formation.mssante.fr
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#8f5902;font-style:italic">// Récupères les adresses mail du PS
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">getEmails</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#8f5902;font-style:italic">// Récupération des dossiers (en cours, brouillon, ...)
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Folder</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">getFolders</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">parentFolderId</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#8f5902;font-style:italic">// Création d&#39;un dossier
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">Folder</span> <span style="color:#000">createFolder</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">folderName</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">parentFolderId</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#8f5902;font-style:italic">// Renommage d&#39;un dossier
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">renameFolder</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">folderId</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">newName</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#8f5902;font-style:italic">// Déplacement d&#39;un dossier
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">moveFolder</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">folderId</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">destinationFolderId</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#8f5902;font-style:italic">// Suppression d&#39;un dossier
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">deleteFolder</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">folderId</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#8f5902;font-style:italic">// Mise en corbeille d&#39;un dossier
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">moveFolderToTrash</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">folderId</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#8f5902;font-style:italic">// Suppression des messages d&#39;un dossier
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">cleanFolder</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">folderId</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#8f5902;font-style:italic">// Récupération des messages
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Message</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">searchMessages</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">MessageSearchCriteria</span> <span style="color:#000">criteria</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#8f5902;font-style:italic">// Récupération des messages
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Message</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">searchFullTextMessages</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">MessageSearchCriteriaFullText</span> <span style="color:#000">criteria</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#8f5902;font-style:italic">// Récupération d&#39;une pièce jointe
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">byte</span><span style="color:#ce5c00;font-weight:bold">[]</span> <span style="color:#000">getAttachment</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">messageId</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">part</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
    
    
    <span style="color:#8f5902;font-style:italic">// Récupération d&#39;une pièce jointe
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">String</span> <span style="color:#000">uploadAttachment</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">mimeType</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">filename</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">byte</span><span style="color:#ce5c00;font-weight:bold">[]</span> <span style="color:#000">file</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#8f5902;font-style:italic">// Récupération d&#39;une pièce jointe
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">MessageInfo</span> <span style="color:#000">saveDraft</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Message</span> <span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#8f5902;font-style:italic">// Suppression d&#39;un message
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">deleteMessage</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">messageId</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#8f5902;font-style:italic">// Envoi d&#39;un message
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">MessageInfo</span> <span style="color:#000">sendMessage</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Message</span> <span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#8f5902;font-style:italic">// Suppression d&#39;une pièce jointe
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">removeAttachment</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">messageId</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">part</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#8f5902;font-style:italic">// Mise à jour du statut de message
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">updateMessagesStatus</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Integer</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">messageIds</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">MessageStatus</span> <span style="color:#000">status</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#8f5902;font-style:italic">// Déplacement de message
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">moveMessages</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Integer</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">messageIds</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">folderId</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#8f5902;font-style:italic">// Recherche d&#39;un professionnel
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">User</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">findUsers</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">UserCriteria</span> <span style="color:#000">criteria</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#8f5902;font-style:italic">// Liste des codes d&#39;une nomenclature
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Code</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">getNomenclature</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Nomenclatures</span> <span style="color:#000">nomenclature</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
 
</code></pre></div><h3 id="documentation">Documentation</h3>
<p>La documentation officielle est disponible sur <a href="https://mailiz.mssante.fr/is/doc-technique">https://mailiz.mssante.fr/is/doc-technique</a></p>
<p>Il est recommandé pour les logiciels souhaitant envoyer des pièces jointes de lire les document suivants:</p>
<ul>
<li>Echange de documents de santé via MSSanté :  guide de normalisation à destination des éditeurs de clients de messagerie MSSanté (V1.2 - 21/12/2018)</li>
<li>Guide éditeur de mise en oeuvre de la MSSanté et de l&rsquo;alimentation du DMP dans un logiciel de professionnel de santé (V1.0.0 - mars 2016)</li>
<li>Echange de compte rendu d&rsquo;examens de biologie via MSSanté : guide de transition vers le format XDM (V1.0.0 - 27 /04/2017)</li>
</ul>
<h3 id="tests">Tests</h3>
<p>une environnement de démo est disponible pour les tests. Sur cet environnement, seul l&rsquo;authentification otp fonctionne.</p>
<p>Au préalable il faut se crééer un compte sur mailiz formation : <a href="https://mailiz.formation.mssante.fr/">https://mailiz.formation.mssante.fr/</a></p>
<p>Puis accéder à l&rsquo;environnement de démonstration :  <a href="https://mss-demo.devbox-sante.fr">https://mss-demo.devbox-sante.fr</a></p>
<p>Dont la documentation est accessible : <a href="https://mss-demo.devbox-sante.fr/swagger-ui.html">https://mss-demo.devbox-sante.fr/swagger-ui.html</a></p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0f8d0ee2d23e0e3022cb56348f82e9dd">4 - CPS</h1>
    <div class="lead">Composant d&rsquo;intégration de la CPS</div>
	<p>L&rsquo;api CPS3  (même une SPI) proposée par DEVCOOP afin de proposer un niveau d&rsquo;abstraction suffisant pour un programme
java d&rsquo;accéder à la carte CPS3.</p>
<p>Le document de référence est <code>ASIP_CPS3_Données-métier_v1.0.2.doc</code></p>
<h2 id="implémentation">Implémentation</h2>
<p>Le module cps-impl, fournit l&rsquo;implémentation de la <code>CPSFacade</code> qui intègre la <a href="https://esante.gouv.fr/services/espace-cps/telechargements-libres/cryptolib-cps-windows">Cryptolib CPS</a>  de l&rsquo;ANS.</p>
<p>Exemple de code dans une application Spring Boot :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">MonComposantCPS</span> <span style="color:#ce5c00;font-weight:bold">{</span>

    <span style="color:#5c35cc;font-weight:bold">@Autowired</span>
    <span style="color:#000">CPSFacade</span> <span style="color:#000">cps</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">maMethode</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">cps</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">isAvailable</span><span style="color:#ce5c00;font-weight:bold">();</span>
        <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">CardReaderInfo</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">availableReaders</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cps</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getAvailableReaders</span><span style="color:#ce5c00;font-weight:bold">();</span>
        <span style="color:#000">cps</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">selectReader</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">0L</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">CpsCardInfo</span> <span style="color:#000">cardInfo</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cps</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">readInfo</span><span style="color:#ce5c00;font-weight:bold">();</span>  <span style="color:#8f5902;font-style:italic">// Une demande d&#39;authentification auprès de l&#39;utilisateur est réalisée sur cet appel
</span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">cps</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">isLogged</span><span style="color:#ce5c00;font-weight:bold">();</span>
        <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">PrivateKey</span> <span style="color:#000">signaturePrivateKey</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cps</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getSignaturePrivateKey</span><span style="color:#ce5c00;font-weight:bold">();</span>
   <span style="color:#ce5c00;font-weight:bold">}</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><h3 id="personnalisation-du-pinprovider">Personnalisation du PinProvider</h3>
<p>La saisie du code Pin est possible à partir du <code>PinProviderFrame</code> développé en Swing.</p>
<p><img src="cps-saisie-code-pin.png" alt="cps-proxy saisie du code pin"></p>
<p>Mais, il est tout à fait possible de fournir son propre provider ou encore utiliser le NoPinProvider, et appelé explicitement la méthode <code>setPin()</code>.</p>
<h2 id="signature-pdf">Signature PDF</h2>
<p>Le module cps-pdf, contient le code permettant de générer des signatures PDF  <a href="https://helpx.adobe.com/fr/acrobat/using/signing-pdfs.html">https://helpx.adobe.com/fr/acrobat/using/signing-pdfs.html</a>.</p>
<p>Il s&rsquo;appuie sur la librairie apache PDF-BOX.</p>
<p>Exemple de code :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">PdfSignatureInfo</span> <span style="color:#000">pdfSignatureInfo</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">PdfSignatureInfo</span><span style="color:#ce5c00;font-weight:bold">();</span>
<span style="color:#000">pdfSignatureInfo</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setLocation</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Léognan, FRANCE&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
<span style="color:#000">pdfSignatureInfo</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setReason</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Parceque&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>

<span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">PdfSigner</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">cps</span><span style="color:#ce5c00;font-weight:bold">).</span><span style="color:#c4a000">sign</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;exemple.pdf&#34;</span><span style="color:#ce5c00;font-weight:bold">),</span> <span style="color:#000">pdfSignatureInfo</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;exemple-signe.pdf&#34;</span><span style="color:#ce5c00;font-weight:bold">)));</span>
</code></pre></div><h2 id="proxy-rest">Proxy REST</h2>
<p>Le module cps-proxy, permet de fournit une facade REST à la <code>CPSFacade</code> java.</p>
<p>L&rsquo;accès au CPS-proxy est indépendant de la technologie utilisée par l&rsquo;intégrateur. Exemple d&rsquo;intégration possible :</p>
<pre tabindex="0"><code class="language-plantuml" data-lang="plantuml">!include https://bitbucket.org/devbox-sante/plantuml/raw/3/themes/theme-devbox-sante.puml

node &quot;Poste Client (Windows/Mac/Linux)&quot; {
    [FrontEnd intégrateur] as frontend 

    package &quot;DevBox-Santé&quot; DEVBOX_COLOR  {
        [interface CPS-API] as cpsFacade CPS_COLOR
    }
    [Cryptolib CPS (ANS / ASIP)] as cryptolibCPS 
}

[BackEnd intégrateur] as backend

frontend -down-&gt; cpsFacade : REST &quot;GET &quot;/cps/cardInfo&quot;&quot;
cpsFacade &lt;-down-&gt; cryptolibCPS : appel natif
frontend -right-&gt; backend : REST
</code></pre><h3 id="exécution">Exécution</h3>
<p>Exemple Swagger :</p>
<p><img src="cps-proxy-swagger-saisie-code-pin.png" alt="cps-proxy swagger"></p>
<p>Exemple CURL :</p>
<ul>
<li>Récupérer l&rsquo;état des différents lecteurs de carte :</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X GET <span style="color:#4e9a06">&#34;http://127.0.0.1:8484/cps/readersInfo&#34;</span> -H <span style="color:#4e9a06">&#34;accept: */*&#34;</span>
</code></pre></div><ul>
<li>Lire les informations de la carte</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X GET <span style="color:#4e9a06">&#34;http://127.0.0.1:8484/cps/cardInfo&#34;</span> -H <span style="color:#4e9a06">&#34;accept: */*&#34;</span>
</code></pre></div><ul>
<li>Signer un fichier PDF :</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X POST <span style="color:#4e9a06">&#34;http://127.0.0.1:8484/cps/signPdf?location=Bordeaux&amp;reason=Parceque&#34;</span> -H <span style="color:#4e9a06">&#34;accept: */*&#34;</span> -H <span style="color:#4e9a06">&#34;Content-Type: multipart/form-data&#34;</span> -F <span style="color:#4e9a06">&#34;multipart=@fichier.pdf;type=application/pdf&#34;</span>
</code></pre></div><h3 id="configuration">Configuration</h3>
<p>Le cps-proxy est une application web Spring Boot, toutes les possibilités de spring-security sont donc disponibles.</p>
<p>Exemple de configuration de base empêchant toutes les IPs externes :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#204a87;font-weight:bold">devbox-sante</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">cps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">security</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">authorizedIpAddress</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">127.0.0.1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div>
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9fc0b6d1368ed39ed9e18b18f224c810">4.1 - Versions</h1>
    <div class="lead">Note sur les différentes versions de la DevBox-Santé CPS</div>
	<div class="csg-wrapper" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; font-size: 14px; font-weight: 400; line-height: 24px; vertical-align: baseline;"><h1 class="csg-h1" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 23px; line-height: 1.1034; margin-top: 40px; letter-spacing: -0.01em;">Version 3.1 (21/10/2021)</h1><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Bug</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/CPS-45" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">CPS-45</a> La lecture de la facturation cause ClasCastException sur CPE</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/CPS-44" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">CPS-44</a> CPS Close() contreproductive</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/CPS-39" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">CPS-39</a> Erreur de signature après un changement de carte.</p><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Story</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/CPS-43" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">CPS-43</a> [Proxy] avoir deux endpoints différents pour le readInfo avec / sans selection bénéficiaire.</p></div>
<div class="csg-wrapper" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; font-size: 14px; font-weight: 400; line-height: 24px; vertical-align: baseline;"><h1 class="csg-h1" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 23px; line-height: 1.1034; margin-top: 40px; letter-spacing: -0.01em;">Version 3.0 (24/09/2021)</h1><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Bug</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/CPS-37" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">CPS-37</a> readInfo avec la selected Info à false ne fonctionne pas.</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/CPS-26" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">CPS-26</a> Problème JDK : déterminer la version java qui cause l'erreur.</p><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Story</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/CPS-41" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">CPS-41</a> Renommage fr.devcoop.cps devient fr.devboxsante.cps</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/CPS-40" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">CPS-40</a> Suppression de la SunCpsFacade</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/CPS-38" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">CPS-38</a> Récupérer les informations de facturation de l'activité PS</p></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-aabe453a813b9f87dd0e8350e70947e4">5 - Vitale</h1>
    <div class="lead">Composant d&rsquo;intégration de la carte vitale</div>
	<p>Ceci est l&rsquo;api carte vitale proposée par DEVCOOP afin de proposer un niveau d&rsquo;abstraction suffisant pour un programme
java d&rsquo;accéder à la carte vitale.</p>
<p>Les documents de référence sont <code>apilec-mp-001_lecv6.3x_V2.1.pdf</code> et <code>apilec-mf-001_lecv6.3x_V1.6.pdf</code></p>
<h2 id="implémentation">Implémentation</h2>
<p>Le module carte-vitale-impl, fournit l&rsquo;implémentation de la <code>VitalFacade</code> qui intègre l&rsquo;API LectureVitale fournit par Sesam Vitale  : <code>PDT-INF-400-API_Lecture_Vitale_6.31.pdf</code></p>
<p>Exemple de code dans une application Spring Boot :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">MonComposantVitale</span> <span style="color:#ce5c00;font-weight:bold">{</span>

    <span style="color:#5c35cc;font-weight:bold">@Autowired</span>
    <span style="color:#000">VitaleFacade</span> <span style="color:#000">vitale</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">maMethode</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">CardReaderInfo</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">availableReaders</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">vitale</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getAvailableReaders</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">getCardReaders</span><span style="color:#ce5c00;font-weight:bold">();</span>
        <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">selecteBeneficiaire</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#ce5c00;font-weight:bold">;</span>
        <span style="color:#000">vitale</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">readVitale</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectBeneficiaire</span><span style="color:#ce5c00;font-weight:bold">);</span>
   <span style="color:#ce5c00;font-weight:bold">}</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><h2 id="proxy-rest">Proxy REST</h2>
<p>Le module carte-vitale-proxy, permet de fournit une facade REST à la <code>VitaleFacade</code> java.</p>
<p>L&rsquo;accès au carte-vitale-proxy est indépendant de la technologie utilisée par l&rsquo;intégrateur.</p>
<pre tabindex="0"><code class="language-plantuml" data-lang="plantuml">!include https://bitbucket.org/devbox-sante/plantuml/raw/3/themes/theme-devbox-sante.puml

node &quot;Poste Client (Windows/Mac/Linux)&quot; {
    [FrontEnd intégrateur] as frontend 

    package &quot;DevBox-Santé&quot; DEVBOX_COLOR  {
        [DevBox-Santé Vitale API] as vitaleFacade VITALE_COLOR
    }
    [ApiVitale (SESAM-vitale)] as apiVitale 
}

[BackEnd intégrateur] as backend

frontend -down-&gt; vitaleFacade : REST &quot;GET &quot;/vitale/readVitale&quot;&quot;
vitaleFacade &lt;-down-&gt; apiVitale : appel natif
frontend -right-&gt; backend : REST
</code></pre><h3 id="exécution">Exécution</h3>
<p>Exemple Swagger :</p>
<p><img src="carte-vitale-proxy-swagger.png" alt="vitale-proxy swagger"></p>
<p>Exemple CURL :</p>
<ul>
<li>Récupérer l&rsquo;état des différents lecteurs de carte :</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X GET <span style="color:#4e9a06">&#34;http://localhost:8585/vitale/availableReaders&#34;</span> -H <span style="color:#4e9a06">&#34;accept: */*&#34;</span>
</code></pre></div><ul>
<li>Lire les données administratives de la carte vitale</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X GET <span style="color:#4e9a06">&#34;http://localhost:8585/vitale/readVitale&#34;</span> -H <span style="color:#4e9a06">&#34;accept: */*&#34;</span>
</code></pre></div><ul>
<li>Signer un fichier PDF :</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X POST <span style="color:#4e9a06">&#34;http://127.0.0.1:8484/cps/signPdf?location=Bordeaux&amp;reason=Parceque&#34;</span> -H <span style="color:#4e9a06">&#34;accept: */*&#34;</span> -H <span style="color:#4e9a06">&#34;Content-Type: multipart/form-data&#34;</span> -F <span style="color:#4e9a06">&#34;multipart=@fichier.pdf;type=application/pdf&#34;</span>
</code></pre></div><h3 id="configuration">Configuration</h3>
<p>La carte-vitale-proxy est une application web Spring Boot, toutes les possibilités de spring-security sont donc disponibles.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8b58a48c9632148cde85981d37d21c3a">5.1 - Problèmes connus</h1>
    
	<h3 id="pcsc-ou-galss-">PC/SC ou galss ?</h3>
<p>Le galss n&rsquo;est officiellement plus supporté au 31 décembre 2021, donc il faut configurer les lecteurs en PC/SC</p>
<h3 id="changement-de-lecteur-pcsc---galss">Changement de lecteur PC/SC -&gt; Galss</h3>
<p>Le lecteur carte vitale, enregistre dans le fchier %Program_FILES%/DevBoxSante-%client%/santesocial/api_lec/api_lec.ini les lecteurs PC/SC utilisés, 
une fois enregistré si l&rsquo;utilisateur change de lecteur pour un lecteur bi-fente utilisant le galss, le lecteur ne sera pas détecté par la DevBoxSanté 
car les api sesam vitale ne recherche les lecteurs galss que si il n&rsquo;y a pas de lecteurs PS/SC d&rsquo;enregistrés.</p>
<p>Solution: supprimer dans le fichier api_lec.ini les lecteurs enregistrés.</p>
<pre tabindex="0"><code>[Lecteur]
Ressource_Vitale=
Ressource_CPS=
</code></pre><blockquote>
<p>PS: Le changement de lecteur PS/SC pour un autre PS/SC ne pose aucun soucis</p>
</blockquote>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-867e73353cc514820775746e03c23a4a">5.2 - Versions</h1>
    <div class="lead">Note sur les différentes versions de la DevBox-Santé Carte Vitale</div>
	<div class="csg-wrapper" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; font-size: 14px; font-weight: 400; line-height: 24px; vertical-align: baseline;"><h1 class="csg-h1" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 23px; line-height: 1.1034; margin-top: 40px; letter-spacing: -0.01em;">Version 1.5</h1><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Bug</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/VITALE-15" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">VITALE-15</a> [MacOS] Proxy problème d'encodage</p></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c3020375c601186cfa8c18b2029bb70a">6 - Annuaire</h1>
    <div class="lead">Intégrer l&rsquo;annuaire des professionnels de santé géolocalisé</div>
	

<div class="pageinfo pageinfo-primary">
<pre><code>Page en cours de construction
</code></pre>

</div>

<h2 id="saas">SAAS</h2>
<p>Accéder à l&rsquo;annuaire en REST depuis nos environnements : <a href="https://annuaire-demo.devbox-sante.fr/swagger-ui.html">https://annuaire-demo.devbox-sante.fr/swagger-ui.html</a></p>
<h3 id="accès-aux-différents-environnements">Accès aux différents environnements</h3>
<ul>
<li>
<p>L&rsquo;accès à la plateforme de démonstration : <a href="https://annuaire-demo.devbox-sante.fr/">https://annuaire-demo.devbox-sante.fr/</a></p>
</li>
<li>
<p>L&rsquo;accès à la plateforme de production : <a href="https://annuaire.devbox-sante.fr/">https://annuaire.devbox-sante.fr/</a></p>
</li>
</ul>
<p><a href="mailto:devbox-sante@devcoop.fr">Contactez-nous</a></p>
<h2 id="on-premise">On premise</h2>
<p>Installation dans votre propre environnement</p>
<h3 id="installation">Installation</h3>
<p>TODO : intégrer <a href="https://docs.google.com/document/d/1Dw6eqxcrayYgUaqCPWzMR4vtuvR4R58vRZZMNMshmxw/edit#heading=h.yxf5u3jrviwd">https://docs.google.com/document/d/1Dw6eqxcrayYgUaqCPWzMR4vtuvR4R58vRZZMNMshmxw/edit#heading=h.yxf5u3jrviwd</a></p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a7bb4ab6af63b66fa3391c108fc44df2">7 - Installer</h1>
    <div class="lead">Un programme d&rsquo;installation multi-OS</div>
	<p>Afin de gérer l&rsquo;installation de nos composants, nous nous appuyons sur un constructeur d'<code>installer</code> : <a href="https://www.ej-technologies.com/products/install4j/overview.html">Install4j</a></p>
<p>Install4j nous permet ainsi de générer et proposer des programmes d&rsquo;installation spécifiques avec les différents modules.</p>
<p>Une page dédiée est accessible sur le serveur de gestion de clients :</p>
<p><img src="installers.png" alt="installers"></p>
<p>Une fois le programme d&rsquo;installation téléchargé, il suffit de suivre le wizard d&rsquo;installation.</p>
<h2 id="mise-à-jour-automatique">Mise à jour automatique</h2>
<p>La DevBox-Santé une fois installé peut proposer automatiquement des mises à jour aux utilisateurs :</p>
<p><img src="update-confirm.png" alt="update-confirme DevBox-santé"></p>
<p>Une fois confirmé le téléchargement et la mise à jour automatique se fait :</p>
<p><img src="upload-update.png" alt="upload-update DevBox-santé"></p>
<h2 id="howtos">Howtos</h2>
<h4 id="surcharge-dune-propriété-lors-du-démarrage-de-lexécutable">Surcharge d&rsquo;une propriété lors du démarrage de l&rsquo;exécutable</h4>
<p>Il est possible de surcharger une propriété de la configuration <code>application.yml</code> lors du démarrage de la DevBox-Santé.
Par exemple, pour démarrer la DevBox-Santé sur le port 10002: </p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#4e9a06">&#34;C:\Program Files\DevBoxSante\DevBoxSante.exe&#34;</span> --server.port<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">10002</span>
</code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="www.devbox-sante.fr" aria-label="www.devbox-sante.fr">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.devbox-sante.fr" aria-label="www.devbox-sante.fr">
      <i class="icon iconFoot icon-devbox"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="BitBucket" aria-label="BitBucket">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/google/docsy" aria-label="BitBucket">
      <i class="fab fa-bitbucket"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Contactez-nous" aria-label="Contactez-nous">
    <a class="text-white" target="_blank" rel="noopener" href="mailto://devbox-sante@devcoop.fr" aria-label="Contactez-nous">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2021 DevBox Santé Tous droits résérvés</small>
        <small class="ml-1"><a href="https://www.devbox-sante.fr/mentions" target="_blank" rel="noopener">Politique de confidentialité</a></small>
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>





<script src='/js/tabpane-persist.js'></script>



<script src='/js/deflate.js'></script>


 












<script src="/js/main.min.220147f1a33d9886614fd69a83d04f03c013b0889ac626cef692eb5b08642468.js" integrity="sha256-IgFH8aM9mIZhT9aag9BPA8ATsIiaxibO9pLrWwhkJGg=" crossorigin="anonymous"></script>




  </body>
</html>
