<!doctype html>
<html lang="fr" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.83.1" /><link rel="canonical" type="text/html" href="/docs/insi/">
<link rel="alternate" type="application/rss&#43;xml" href="/docs/insi/index.xml">
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>INSi | DevBox-Santé</title>
<meta name="description" content="La Documentation"><meta property="og:title" content="INSi" />
<meta property="og:description" content="Téléservice Identifiant National de Santé (INS) intégré aux LPS 
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/docs/insi/" /><meta property="og:site_name" content="DevBox-Santé" />

<meta itemprop="name" content="INSi">
<meta itemprop="description" content="Téléservice Identifiant National de Santé (INS) intégré aux LPS 
"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="INSi"/>
<meta name="twitter:description" content="Téléservice Identifiant National de Santé (INS) intégré aux LPS 
"/>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-39129192-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>






<link rel="preload" href="/scss/main.min.d22051aee96007f67fc0e97cfaaa9aa383ed759b792c1e8ca6d0bcca43fe075d.css" as="style">
<link href="/scss/main.min.d22051aee96007f67fc0e97cfaaa9aa383ed759b792c1e8ca6d0bcca43fe075d.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>


<link rel="stylesheet" href="/css/devbox-sante.css" type="text/css">


  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg id="Composant_16_14" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 132.5 118.9" style="enable-background:new 0 0 132.5 118.9"><style>.st0{fill:url(#SVGID_1_)}.st1{fill:#fff}.st2{fill:url(#SVGID_2_)}.st3{fill:url(#SVGID_3_)}.st4{fill:#d34a3c}.st5{fill:none;stroke:#fff;stroke-width:6}</style><g id="Rectangle_69" transform="translate(65.996 38.892)"><linearGradient id="SVGID_1_" gradientUnits="userSpaceOnUse" x1="-44.4861" y1="64.4079" x2="-45.1313" y2="65.2243" gradientTransform="matrix(66.506 0 0 -66.507 3013.5039 4344.1382)"><stop offset="0" style="stop-color:#7613E0"/><stop offset="1" style="stop-color:#9F57ED"/></linearGradient><path class="st0" d="M23.3 3.8h19.9c10.7.0 19.4 8.7 19.4 19.4v19.9c0 10.7-8.7 19.4-19.4 19.4H23.3c-10.7.0-19.4-8.7-19.4-19.4V23.2C3.9 12.5 12.6 3.8 23.3 3.8z"/><g><path class="st1" d="M44.5 66.5H22c-12.1.0-22-9.9-22-22V22C0 9.9 9.9.0 22 0h22.5c12.1.0 22 9.9 22 22v22.5c0 12.1-9.9 22-22 22zM22 6C13.2 6 6 13.2 6 22v22.5c0 8.8 7.2 16 16 16h22.5c8.8.0 16-7.2 16-16V22c0-8.8-7.2-16-16-16H22z"/></g></g><g id="Rectangle_70" transform="translate(110.109) rotate(90)"><linearGradient id="SVGID_2_" gradientUnits="userSpaceOnUse" x1="103.5653" y1="89.1427" x2="104.2366" y2="89.9162" gradientTransform="matrix(0 -66.506 -66.507 0 5940.3726 6895.6235)"><stop offset="0" style="stop-color:#67ED9A"/><stop offset="1" style="stop-color:#4AC87A"/></linearGradient><path class="st2" d="M23 1.5h21.5c11.6.0 21 9.4 21 21V44c0 11.6-9.4 21-21 21H23C11.4 65 2 55.6 2 44V22.5c0-11.6 9.4-21 21-21z"/><g><path class="st1" d="M66.5 22v22.5c0 12.1-9.9 22-22 22H22c-12.1.0-22-9.9-22-22V22C0 9.9 9.9.0 22 0h22.5c12.1.0 22 9.9 22 22zM6 44.5c0 8.8 7.2 16 16 16h22.5c8.8.0 16-7.2 16-16V22c0-8.8-7.2-16-16-16H22C13.2 6 6 13.2 6 22V44.5z"/></g></g><g id="Rectangle_71" transform="translate(88.714 52.366) rotate(90)"><linearGradient id="SVGID_3_" gradientUnits="userSpaceOnUse" x1="50.3774" y1="67.1362" x2="49.7677" y2="66.2039" gradientTransform="matrix(0 -66.506 -66.507 0 4517.4551 3412.9705)"><stop offset="0" style="stop-color:#FFA800"/><stop offset="1" style="stop-color:#FFC24D"/></linearGradient><path class="st3" d="M22.8 2.3h21c11.3.0 20.5 9.2 20.5 20.5v21c0 11.3-9.2 20.5-20.5 20.5h-21c-11.3.0-20.5-9.2-20.5-20.5v-21C2.3 11.4 11.4 2.3 22.8 2.3z"/><g><path class="st1" d="M66.5 22v22.5c0 12.1-9.9 22-22 22H22c-12.1.0-22-9.9-22-22V22C0 9.9 9.9.0 22 0h22.5c12.1.0 22 9.9 22 22zM6 44.5c0 8.8 7.2 16 16 16h22.5c8.8.0 16-7.2 16-16V22c0-8.8-7.2-16-16-16H22C13.2 6 6 13.2 6 22V44.5z"/></g></g><g id="Rectangle_72" transform="translate(66.506 13.481) rotate(90)"><g><path class="st4" d="M23 1.5h21.5c11.6.0 21 9.4 21 21V44c0 11.6-9.4 21-21 21H23C11.4 65 2 55.6 2 44V22.5c0-11.6 9.4-21 21-21z"/></g><path class="st5" d="M22 3h22.5c10.5.0 19 8.5 19 19v22.5c0 10.5-8.5 19-19 19H22c-10.5.0-19-8.5-19-19V22C3 11.5 11.5 3 22 3z"/></g></svg></span><span class="text-uppercase font-weight-bold">DevBox-Santé</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="/docs/" ><i class='icon icon-devbox'></i><span class="active">Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/dmp/" ><i class='icon iconNav icon-dmp'></i><span>DMP</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="/docs/insi/" ><i class='icon iconNav icon-ins'></i><span class="active">INSi</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/ms-sante/" ><i class='icon iconNav icon-mssante'></i><span>MSS</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/cps/" ><i class='icon iconNav icon-cps-puce'></i><span>CPS</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/carte-vitale/" ><i class='icon iconNav icon-sesam-puce'></i><span>Vitale</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/blog/" ><i class='fa fa-blog'></i><span>Blog</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/docs/insi/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">INSi</h1>
<div class="lead">Téléservice Identifiant National de Santé (INS) intégré aux LPS</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-00b4e8e7e9c9fde6d61dbb9403a604c9">Java API</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-4840a95263433cd2eecdfa84790ab794">REST Proxy</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>


<div class="content">
      <p>Ce projet contient l&rsquo;API java proposé par la DevBox-santé pour l&rsquo;intégration du téléservice.
Elle est basée sur le Guide d&rsquo;intégration du GIE SESAM-Vitale SEL-MP-043 : https://www.sesam-vitale.fr/documents/20182/75606/SEL-MP-043_01-00_INSi+sans+MR/92d6e408-012d-4dc5-9fd1-d3bdda78735a</p>
<p>Cette API respecte quand c&rsquo;est possible le <a href="https://esante.gouv.fr/interoperabilite/mos-nos">Modèle d&rsquo;Objet de Santé proposé par l&rsquo;ANS</a></p>
<h3 id="version-du-guide-dintégration-supportée">Version du guide d&rsquo;intégration supportée</h3>
<p>La version supportée par cette API est la version 02.00 en date du 2 juillet 2020 (SEL-MP-043_02-00_INSi).</p>
<h3 id="glossaire">Glossaire</h3>
<ul>
<li><strong>ANS</strong> : Agence du Numérique en Santé</li>
<li><strong>CPS / CPx</strong> : Carte de Professionnel de Santé</li>
<li><strong>INS</strong> : Identifiant National de Santé</li>
<li><strong>INSi</strong> : Identifiant National de Santé integré</li>
<li><strong>MOS</strong> : Modèle d&rsquo;Objets de Santé</li>
</ul>
<h2 id="insi-proxy">INSi Proxy</h2>
<p>Le module insi-proxy, permet de fournit une facade REST à la facade <code>INSiClient</code> java.
Toutes les opérations offertes par la la façade java sont disponibles via des appels http sur le poste local.</p>
<p>L&rsquo;accès a l&rsquo;insi-proxy est donc indépendant de la technologie utilisée par l&rsquo;intégrateur. Exemple d&rsquo;intégration possible :</p>
<p><img src="REST/insi-rest-architecture.png" alt="insi-proxy architecture rest"></p>
<h3 id="configuration">Configuration</h3>
<h4 id="applicationyml">Application.yml</h4>
<p>Pour configurer le proxy jar, il suffit de modifier les paramètres du fichier <code>application.yml</code> :</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#204a87;font-weight:bold">devbox-sante</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">cps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">module.path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">C:\Windows\System32\cps3_pkcs11_w64.dll</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">insi</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">url</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://qualiflps.services-ps.ameli.fr/lps</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">lpsInfo</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">nom</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">À_CHANGER</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">numeroAutorisation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">À_CHANGER</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">À_CHANGER</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#8f5902;font-style:italic">#Cet élément XML contient l’identifiant d’installation du logiciel. Cet identifiant est généré lors de l’installation du SI-PS. Cet identifiant prend la forme d’un UUID sous sa forme canonique. Il doit être pérenne pour une installation d’un logiciel. Ce numéro est une aide au support, car il permet de regrouper les requêtes d’un même logiciel. Il permet également de compter le nombre de logiciels distincts accédant au TLSi.</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">instance</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">À_CHANGER (UUID)</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#8f5902;font-style:italic"># Pour les établissements, numéro FINESS géographique. Pour les autres, identifiant AM de facturation. C&#39;est le numéro par défaut qui peut être surchargé dans chaque requête.</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">identifiantFacturation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">À_CHANGER</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">ci-tls-amo</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">ssl</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">truststore.path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">truststoreIgcSante-EL-ORG.jks</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">truststore.password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">changeit</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>Pour charger le fichier de configuration :</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">java -Dspring.config.location<span style="color:#ce5c00;font-weight:bold">=</span>./application.yml -jar insi-proxy.jar
</code></pre></div><h4 id="jeu-de-test-cnda">Jeu de test CNDA</h4>
<p>Afin de pouvoir exécuter les tests d&rsquo;injection demandées par le CNDA, il faut lancer le proxy avec le profil CNDA activé.</p>
<p>Exemple :</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">java -Dspring.profiles.active<span style="color:#ce5c00;font-weight:bold">=</span>CNDA -jar insi-proxy.jar
</code></pre></div><h3 id="packaging-et-déploiement">Packaging et Déploiement</h3>
<p>La DevBox Santé propose des solutions de &ldquo;packaging&rdquo; des différents modules, pour Windows, MacOS et Linux.</p>
<p><img src="devbox-sante-installation.png" alt="devbox-sante-installation"></p>
<h4 id="configuration-de-la-sécurité">Configuration de la sécurité</h4>
<p>Le cps-proxy est une application web Spring Boot, toutes les possibilités de spring-security sont donc disponibles.</p>
<p>Exemple de configuration par défaut empêchant toutes les IPs externes :</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#204a87;font-weight:bold">devbox-sante</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">cps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">security</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">authorizedIpAddress</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">127.0.0.1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="surcharge-les-lpsinfo-dans-le-proxy">Surcharge les LpsInfo dans le proxy</h4>
<p>La configuration du proxy contient les informations par défaut de configuration du LPS (Logiciel de Professionnel de Santé) cf. paragraphe précédent.
Il est toutefois possible de surcharger ces valeurs (comme le numeroAutorisation qui peut être confidentiel) en les passant dans les header HTTP des requêtes.</p>
<p>Par exemple :</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X GET <span style="color:#4e9a06">&#34;http://localhost:8484/insi/rechercheAvecVitale?identifiantFacturation=12345&#34;</span> -H <span style="color:#4e9a06">&#34;accept: application/json&#34;</span> -H <span style="color:#4e9a06">&#34;lpsInfo.numeroAutorisation: ÀPréciser&#34;</span>
</code></pre></div><p>Ainsi le client peut dynamiquement passer les informations du LPS.</p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-00b4e8e7e9c9fde6d61dbb9403a604c9">1 - Java API</h1>
    
	<h2 id="insi-client">INSi Client</h2>
<p>Le module insi-impl, fournit l&rsquo;implémentation de la facade <code>INSiClient</code> qui intègre les composant devboxsante-cps-api et devboxsante-vitale-api et accède au téléservice INSi géré par SesamVitale.</p>
<p>Exemple de code dans une application Spring Boot :</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">MonIntegrationINSi</span> <span style="color:#ce5c00;font-weight:bold">{</span>

    <span style="color:#5c35cc;font-weight:bold">@Autowired</span>
    <span style="color:#000">INSiClient</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">;</span>

    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">maMethode</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#8f5902;font-style:italic">// ma recherche avec carte vitale
</span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">INSiContext</span> <span style="color:#000">context</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">INSiContext</span><span style="color:#ce5c00;font-weight:bold">();</span>
        <span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setIdentifiantFacturation</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;3333333&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ins1RechercheAvecVitale</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#ce5c00;font-weight:bold">);</span>

        <span style="color:#8f5902;font-style:italic">// ma recherche sans carte vitale
</span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">INS2Requete</span> <span style="color:#000">requete</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">INS2Requete</span><span style="color:#ce5c00;font-weight:bold">();</span>
        <span style="color:#000">requete</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setDateNaissance</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;01011981&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">requete</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setIdentifiantFacturation</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;3333333&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">requete</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setNomNaissance</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;ADRDEUX&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">requete</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setSexe</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Sexe</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">M</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">requete</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPrenoms</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Collections</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">singletonList</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;LAURENT&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span>
        <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ins2RechercheAvecTraitIdentite</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">requete</span><span style="color:#ce5c00;font-weight:bold">);</span>

        <span style="color:#8f5902;font-style:italic">// ma vérification 
</span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">INS3Requete</span> <span style="color:#000">requete</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">INS3Requete</span><span style="color:#ce5c00;font-weight:bold">();</span>
        <span style="color:#000">requete</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setIns</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">INSWithCle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">newInstance</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;1810163220751&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;40&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">INSAutorite</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">INS_NIR</span><span style="color:#ce5c00;font-weight:bold">));</span>
        <span style="color:#204a87;font-weight:bold">final</span> <span style="color:#000">TraitsIdentiteINS</span> <span style="color:#000">traits</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">TraitsIdentiteINS</span><span style="color:#ce5c00;font-weight:bold">();</span>
        <span style="color:#000">traits</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setNomFamille</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;ADRDEUX&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">traits</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setPrenom</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;LAURENT&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">traits</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setListePrenoms</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;LAURENT&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">traits</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setSexeAdministratif</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Sexe</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">M</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">traits</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setDateNaissance</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;1981-01-01&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">requete</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setTraitsIdentite</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">traits</span><span style="color:#ce5c00;font-weight:bold">);</span>
        <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">ins3Verification</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">requete</span><span style="color:#ce5c00;font-weight:bold">);</span>
   <span style="color:#ce5c00;font-weight:bold">}</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4840a95263433cd2eecdfa84790ab794">2 - REST Proxy</h1>
    <div class="lead">Une interface REST pour le Téléservice INSi</div>
	<p>Le module insi-proxy, permet de fournit une facade REST à la facade <code>INSiClient</code> java.
Toutes les opérations offertes par la la façade java sont disponibles via des appels http sur le poste local.</p>
<p>L&rsquo;accès a l&rsquo;insi-proxy est donc indépendant de la technologie utilisée par l&rsquo;intégrateur. Exemple d&rsquo;intégration possible :</p>
<p><img src="insi-rest-architecture.png" alt="insi-proxy architecture rest"></p>
<h3 id="exécution-du-proxy">Exécution du Proxy</h3>
<h4 id="prérequis">Prérequis</h4>
<p>Doit être installé</p>
<ul>
<li>Environnement java 11 ou supérieur</li>
<li>Cryptolib CPS version 5 ou supérieur</li>
<li>API Lecteur vitale v31 ou supérieur</li>
</ul>
<h4 id="lancement">Lancement</h4>
<p>Le livrable s&rsquo;agit d&rsquo;un jar exécutable, qui se lance de la manière suivante</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">java -jar insi-proxy.jar
</code></pre></div><p>Le composant est accessible depuis le poste local en HTTP sur l&rsquo;adresse ip 127.0.0.1.
Afin de valider le fonctionnement, ouvrir un navigateur à l&rsquo;adresse suivante : http://127.0.0.1:8585</p>
<p><img src="insi-browser.png" alt="insi-proxy browser"></p>
<h3 id="intégration">Intégration</h3>
<p>L&rsquo;ensemble des requêtes sont documentées via l&rsquo;interface swagger et sont accessibles sur l&rsquo;url suivante : http://127.0.0.1:8585/swagger-ui.png</p>
<p><img src="insi-swagger.png" alt="insi-proxy swagger"></p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="www.devbox-sante.fr" aria-label="www.devbox-sante.fr">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.devbox-sante.fr" aria-label="www.devbox-sante.fr">
      <i class="icon iconFoot icon-devbox"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="BitBucket" aria-label="BitBucket">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/google/docsy" aria-label="BitBucket">
      <i class="fab fa-bitbucket"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Contactez-nous" aria-label="Contactez-nous">
    <a class="text-white" target="_blank" rel="noopener" href="mailto://devbox-sante@devcoop.fr" aria-label="Contactez-nous">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2021 DevBox Santé Tous droits résérvés</small>
        <small class="ml-1"><a href="https://www.devbox-sante.fr/mentions" target="_blank" rel="noopener">Politique de confidentialité</a></small>
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>





<script src='/js/deflate.js'></script>


 











<script src="/js/main.min.220147f1a33d9886614fd69a83d04f03c013b0889ac626cef692eb5b08642468.js" integrity="sha256-IgFH8aM9mIZhT9aag9BPA8ATsIiaxibO9pLrWwhkJGg=" crossorigin="anonymous"></script>




  </body>
</html>
