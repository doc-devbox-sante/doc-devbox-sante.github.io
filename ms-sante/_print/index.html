<!doctype html>
<html lang="fr" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.104.2" />
<link rel="canonical" type="text/html" href="/ms-sante/">
<link rel="alternate" type="application/rss&#43;xml" href="/ms-sante/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>MSS | DevBox-Santé</title>
<meta name="description" content="Intégrer les différentes Messageries Sécurisées de Santé
">
<meta property="og:title" content="MSS" />
<meta property="og:description" content="Intégrer les différentes Messageries Sécurisées de Santé
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/ms-sante/" /><meta property="og:site_name" content="DevBox-Santé" />

<meta itemprop="name" content="MSS">
<meta itemprop="description" content="Intégrer les différentes Messageries Sécurisées de Santé
"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MSS"/>
<meta name="twitter:description" content="Intégrer les différentes Messageries Sécurisées de Santé
"/>




<link rel="preload" href="/scss/main.min.633244ef1c2fb3aa12f15e8dfea092f63629f4a4ce9c183b387081511d6d3dd9.css" as="style">
<link href="/scss/main.min.633244ef1c2fb3aa12f15e8dfea092f63629f4a4ce9c183b387081511d6d3dd9.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/devbox-sante.css" type="text/css">

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-39129192-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </head>
  <body class="td-section">
    <header>
      <nav
  class="js-navbar-scroll navbar navbar-expand navbar-dark  flex-column flex-md-row td-navbar">
  <a class="navbar-brand" href="/"><span class="navbar-logo"><svg id="Composant_16_14" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 132.5 118.9" style="enable-background:new 0 0 132.5 118.9"><style>.st0{fill:url(#SVGID_1_)}.st1{fill:#fff}.st2{fill:url(#SVGID_2_)}.st3{fill:url(#SVGID_3_)}.st4{fill:#d34a3c}.st5{fill:none;stroke:#fff;stroke-width:6}</style><g id="Rectangle_69" transform="translate(65.996 38.892)"><linearGradient id="SVGID_1_" gradientUnits="userSpaceOnUse" x1="-44.4861" y1="64.4079" x2="-45.1313" y2="65.2243" gradientTransform="matrix(66.506 0 0 -66.507 3013.5039 4344.1382)"><stop offset="0" style="stop-color:#7613E0"/><stop offset="1" style="stop-color:#9F57ED"/></linearGradient><path class="st0" d="M23.3 3.8h19.9c10.7.0 19.4 8.7 19.4 19.4v19.9c0 10.7-8.7 19.4-19.4 19.4H23.3c-10.7.0-19.4-8.7-19.4-19.4V23.2C3.9 12.5 12.6 3.8 23.3 3.8z"/><g><path class="st1" d="M44.5 66.5H22c-12.1.0-22-9.9-22-22V22C0 9.9 9.9.0 22 0h22.5c12.1.0 22 9.9 22 22v22.5c0 12.1-9.9 22-22 22zM22 6C13.2 6 6 13.2 6 22v22.5c0 8.8 7.2 16 16 16h22.5c8.8.0 16-7.2 16-16V22c0-8.8-7.2-16-16-16H22z"/></g></g><g id="Rectangle_70" transform="translate(110.109) rotate(90)"><linearGradient id="SVGID_2_" gradientUnits="userSpaceOnUse" x1="103.5653" y1="89.1427" x2="104.2366" y2="89.9162" gradientTransform="matrix(0 -66.506 -66.507 0 5940.3726 6895.6235)"><stop offset="0" style="stop-color:#67ED9A"/><stop offset="1" style="stop-color:#4AC87A"/></linearGradient><path class="st2" d="M23 1.5h21.5c11.6.0 21 9.4 21 21V44c0 11.6-9.4 21-21 21H23C11.4 65 2 55.6 2 44V22.5c0-11.6 9.4-21 21-21z"/><g><path class="st1" d="M66.5 22v22.5c0 12.1-9.9 22-22 22H22c-12.1.0-22-9.9-22-22V22C0 9.9 9.9.0 22 0h22.5c12.1.0 22 9.9 22 22zM6 44.5c0 8.8 7.2 16 16 16h22.5c8.8.0 16-7.2 16-16V22c0-8.8-7.2-16-16-16H22C13.2 6 6 13.2 6 22V44.5z"/></g></g><g id="Rectangle_71" transform="translate(88.714 52.366) rotate(90)"><linearGradient id="SVGID_3_" gradientUnits="userSpaceOnUse" x1="50.3774" y1="67.1362" x2="49.7677" y2="66.2039" gradientTransform="matrix(0 -66.506 -66.507 0 4517.4551 3412.9705)"><stop offset="0" style="stop-color:#FFA800"/><stop offset="1" style="stop-color:#FFC24D"/></linearGradient><path class="st3" d="M22.8 2.3h21c11.3.0 20.5 9.2 20.5 20.5v21c0 11.3-9.2 20.5-20.5 20.5h-21c-11.3.0-20.5-9.2-20.5-20.5v-21C2.3 11.4 11.4 2.3 22.8 2.3z"/><g><path class="st1" d="M66.5 22v22.5c0 12.1-9.9 22-22 22H22c-12.1.0-22-9.9-22-22V22C0 9.9 9.9.0 22 0h22.5c12.1.0 22 9.9 22 22zM6 44.5c0 8.8 7.2 16 16 16h22.5c8.8.0 16-7.2 16-16V22c0-8.8-7.2-16-16-16H22C13.2 6 6 13.2 6 22V44.5z"/></g></g><g id="Rectangle_72" transform="translate(66.506 13.481) rotate(90)"><g><path class="st4" d="M23 1.5h21.5c11.6.0 21 9.4 21 21V44c0 11.6-9.4 21-21 21H23C11.4 65 2 55.6 2 44V22.5c0-11.6 9.4-21 21-21z"/></g><path class="st5" d="M22 3h22.5c10.5.0 19 8.5 19 19v22.5c0 10.5-8.5 19-19 19H22c-10.5.0-19-8.5-19-19V22C3 11.5 11.5 3 22 3z"/></g></svg></span><span class="font-weight-bold">DevBox-Santé</span></a>
  <div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
    <ul class="navbar-nav mt-2 mt-lg-0">
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link" href="/dmp/"><i class='icon iconNav icon-dmp'></i><span>DMP</span></a>
      </li>
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link" href="/insi/"><i class='icon iconNav icon-ins'></i><span>INSi</span></a>
      </li>
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link active" href="/ms-sante/"><i class='icon iconNav icon-mssante'></i><span class="active">MSS</span></a>
      </li>
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link" href="/cps/"><i class='icon iconNav icon-cps-puce'></i><span>CPS</span></a>
      </li>
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link" href="/vitale/"><i class='icon iconNav icon-sesam-puce'></i><span>Vitale</span></a>
      </li>
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link" href="/annuaire/"><i class='icon iconNav icon-directory'></i><span>Annuaire</span></a>
      </li>
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link" href="/installer/"><i class='icon icon-devbox'></i><span>Installation</span></a>
      </li>
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link" href="/blog/"><i class='fa fa-blog'></i><span>Blog</span></a>
      </li>
      </ul>
  </div>
  <div class="navbar-nav d-none d-lg-block">
    
  </div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
Version imprimable multipages.
<a href="#" onclick="print();return false;">Cliquer ici pour imprimer</a>.
</p><p>
<a href="/ms-sante/">Retour à la version par défaut</a>.
</p>
</div>



<h1 class="title">MSS</h1>
<div class="lead">Intégrer les différentes Messageries Sécurisées de Santé</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-bc101cabb606e03a532ab98e7c662dd2">Howtos</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.1: <a href="#pg-4d669ea2758d08186a649d09451a5b67">Preuves Segur</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-543a805332bd0423b3101618b1d938a5">Architecture interne des différents composants</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3: <a href="#pg-31a3d0d8a67de401d0d1edbc704a0012">Versions</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>


<div class="content">
      <h2 id="ms-sante-api">MS-SANTE-API</h2>
<h3 id="lapi-public">L&rsquo;API public</h3>
<p>l&rsquo;API est hébergée sur bitbucket : <a href="https://bitbucket.com/devbox-sante/ms-sante-api">https://bitbucket.com/devbox-sante/ms-sante-api</a></p>
<p>Cette API définie les services disponibles et le modèle d&rsquo;objet.</p>
<h3 id="utilisation">Utilisation</h3>
<p>Deux modes d&rsquo;intégration sont proposées :</p>
<ul>
<li>Embarqué : Intégration directe de l&rsquo;API avec son implémentation dans un projet java 11 spring-boot.</li>
<li>REST : Déploiement d&rsquo;une application spring-boot (jar exécutable intégrant un serveur Tomcat) offrant ces mêmes services en REST.</li>
</ul>
<h3 id="pré-requis">Pré-requis</h3>
<p>Pour pouvoir utiliser le connecteur MS-Santé, il faut au préalable créer un compte selon l&rsquo;opérateur choisi:</p>
<ul>
<li>mailiz:  <a href="https://mailiz.mssante.fr/">https://mailiz.mssante.fr/</a></li>
<li>Apicrypt (en cours de développement): <a href="https://www.apicrypt.org/inscription">https://www.apicrypt.org/inscription</a></li>
</ul>
<h3 id="authentification">Authentification</h3>
<h4 id="mailiz">Mailiz</h4>
<p>2 modes d&rsquo;authentification sont disponibles:</p>
<ul>
<li>par carte CPS (nécéssite l&rsquo;installation du module cps de DevBox-Santé) :</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#000">authentificationWithCps</span><span style="color:#000;font-weight:bold">()</span> 
</span></span></code></pre></div><ul>
<li>par carte OTP, cette othentification s&rsquo;effectue en 2 étapes :</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">otpParameters</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">otpCanalType</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">SMS</span> <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Mail</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#8f5902;font-style:italic">// canal pour recevoir l&#39;otp
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#000">otpCanalPwd</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">password</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">otpIdNat</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">idNat</span> <span style="color:#8f5902;font-style:italic">//(0+adeli ou 8+rpps)
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">AuthorizationContext</span> <span style="color:#000">context</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">authentificationWithOtpStep1</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">otpParameters</span><span style="color:#000;font-weight:bold">);</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">context</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">authentificationWithOtpStep2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">otp</span><span style="color:#000;font-weight:bold">)</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// dans le cas de service REST, le context est automatiquement géré dans la session, le service retourne alors la liste des emails de l&#39;utilisateur
</span></span></span></code></pre></div><h4 id="apicrypt">Apicrypt</h4>
<p>un mode d&rsquo;authentification avec le compagnon :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#000">authentificationWithApiCrypt</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">username</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">password</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><h3 id="services">Services</h3>
<p>Les services suivants sont disponibles en mode embarqué, 
ils ont tous leur équivalent en REST avec l&rsquo;email passé en paramètre.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl  GET https://mss-demo.devbox-sante.fr/mssante/folders?email<span style="color:#ce5c00;font-weight:bold">=</span>xxxxxx@medecin.formation.mssante.fr
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Récupères les adresses mail du PS
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">getEmails</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Récupération des dossiers (en cours, brouillon, ...)
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Folder</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">getFolders</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">parentFolderId</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Création d&#39;un dossier
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">Folder</span> <span style="color:#000">createFolder</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">folderName</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">parentFolderId</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Renommage d&#39;un dossier
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">renameFolder</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">folderId</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">newName</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Déplacement d&#39;un dossier
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">moveFolder</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">folderId</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">destinationFolderId</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Suppression d&#39;un dossier
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">deleteFolder</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">folderId</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Mise en corbeille d&#39;un dossier
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">moveFolderToTrash</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">folderId</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Suppression des messages d&#39;un dossier
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">cleanFolder</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">folderId</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Récupération des messages
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Message</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">searchMessages</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">MessageSearchCriteria</span> <span style="color:#000">criteria</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Récupération des messages
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Message</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">searchFullTextMessages</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">MessageSearchCriteriaFullText</span> <span style="color:#000">criteria</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Récupération d&#39;une pièce jointe
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">byte</span><span style="color:#ce5c00;font-weight:bold">[]</span> <span style="color:#000">getAttachment</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">messageId</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">part</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Récupération d&#39;une pièce jointe
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">String</span> <span style="color:#000">uploadAttachment</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">mimeType</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">filename</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">byte</span><span style="color:#ce5c00;font-weight:bold">[]</span> <span style="color:#000">file</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Récupération d&#39;une pièce jointe
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">MessageInfo</span> <span style="color:#000">saveDraft</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Message</span> <span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Suppression d&#39;un message
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">deleteMessage</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">messageId</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Envoi d&#39;un message
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">MessageInfo</span> <span style="color:#000">sendMessage</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Message</span> <span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Suppression d&#39;une pièce jointe
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">removeAttachment</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">messageId</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">part</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Mise à jour du statut de message
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">updateMessagesStatus</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Integer</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">messageIds</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">MessageStatus</span> <span style="color:#000">status</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Déplacement de message
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">moveMessages</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Integer</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">messageIds</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Integer</span> <span style="color:#000">folderId</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Recherche d&#39;un professionnel
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">User</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">findUsers</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">UserCriteria</span> <span style="color:#000">criteria</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Liste des codes d&#39;une nomenclature
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Code</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">getNomenclature</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Nomenclatures</span> <span style="color:#000">nomenclature</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">throws</span> <span style="color:#000">MssException</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span> 
</span></span></code></pre></div><h3 id="documentation">Documentation</h3>
<p>La documentation officielle est disponible sur <a href="https://mailiz.mssante.fr/is/doc-technique">https://mailiz.mssante.fr/is/doc-technique</a></p>
<p>Il est recommandé pour les logiciels souhaitant envoyer des pièces jointes de lire les document suivants:</p>
<ul>
<li>Echange de documents de santé via MSSanté :  guide de normalisation à destination des éditeurs de clients de messagerie MSSanté (V1.2 - 21/12/2018)</li>
<li>Guide éditeur de mise en oeuvre de la MSSanté et de l&rsquo;alimentation du DMP dans un logiciel de professionnel de santé (V1.0.0 - mars 2016)</li>
<li>Echange de compte rendu d&rsquo;examens de biologie via MSSanté : guide de transition vers le format XDM (V1.0.0 - 27 /04/2017)</li>
</ul>
<h3 id="tests">Tests</h3>
<p>une environnement de démo est disponible pour les tests. Sur cet environnement, seul l&rsquo;authentification otp fonctionne.</p>
<p>Au préalable il faut se crééer un compte sur mailiz formation : <a href="https://mailiz.formation.mssante.fr/">https://mailiz.formation.mssante.fr/</a></p>
<p>Puis accéder à l&rsquo;environnement de démonstration :  <a href="https://mss-demo.devbox-sante.fr">https://mss-demo.devbox-sante.fr</a></p>
<p>Dont la documentation est accessible : <a href="https://mss-demo.devbox-sante.fr/swagger-ui.html">https://mss-demo.devbox-sante.fr/swagger-ui.html</a></p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bc101cabb606e03a532ab98e7c662dd2">1 - Howtos</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-4d669ea2758d08186a649d09451a5b67">1.1 - Preuves Segur</h1>
    <div class="lead">Comment configurer la DevBox-sante MSS pour apporter les preuves SEGUR</div>
	<h2 id="génération-de-preuves">Génération de preuves</h2>
<p>Pour générer une preuve, il faut :</p>
<ol start="0">
<li>
<p>configurer la DevBox-Sante MSS sur mailiz de formation via le fichier <code>application.yml</code> :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">devbox-sante</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">ms-sante</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">mailiz</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">servicesUrl</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://mss-msg-igcsante.formation.mssante.fr/mss-msg-services/services</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">authenticationServiceUrl</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://mss-idp-igcsante.formation.mssante.fr/openam/SSOSoap/metaAlias/asip/idp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">igcsante</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">gammes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ELEMENTAIRE_ORGANISATIONS, ELEMENTAIRE_ORGANISATIONS_TEST</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
<li>
<p>configurer les logs de l’<code>IGCSanteTrustoreManager</code> en debug via le fichier <code>application.yml</code></p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">logging</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">level</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">fr.devboxsante.igsante</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DEBUG </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># à minima</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">fr.devboxsante</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DEBUG </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># pour plus de traces</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><ol start="2">
<li>
<p>activer les logs de debug SSL de la JVM : <code>javax.net.debug=ssl:handshake</code></p>
</li>
<li>
<p>lancer la DevBox-Sante MSS avec cette configuration.
Exemple de ligne de commande depuis l’installation de la devbox-sante :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#204a87">cd</span> <span style="color:#4e9a06">&#34;C:\Program Files\DevBoxSante&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#4e9a06">&#34;jre\bin\java.exe&#34;</span> -Djavax.net.debug<span style="color:#ce5c00;font-weight:bold">=</span>ssl:handshake -Dspring.config.location<span style="color:#ce5c00;font-weight:bold">=</span>application.yml -jar <span style="color:#4e9a06">&#34;repository\devboxsante.jar&#34;</span>
</span></span></code></pre></div></li>
<li>
<p>Une fois lancée, accéder à l’authentification CPS pour générer les traces nécessaires comparable à celles-ci : <a href="all.log">all.log</a></p>
<pre tabindex="0"><code class="language-curl" data-lang="curl">curl -X GET &#34;http://localhost:9999/mssante/authentication/cps&#34; -H &#34;accept: */*&#34;
</code></pre></li>
</ol>
<p>Ces traces fournissent les preuves de la prise en compte des exigences [MSS1] (Référentiel socle MSSanté #2 -Clients de Messageries Sécurisées de Santé)</p>
<h2 id="mss-1-trust-igcsante-seulement">MSS 1 : trust IGCSante seulement</h2>
<blockquote>
<p>Un client de messagerie MSSanté doit établir une connexion TLS avec un Opérateur MSSanté, quels que soient les transactions et protocoles utilisés entre les 2 parties.</p>
</blockquote>
<h3 id="mss-11-étapes">MSS 1.1 Étapes</h3>
<ol>
<li>
<p>Vérifier que la configuration TLS du logiciel accepte les certificats serveurs IGC Santé de la branche de TEST</p>
</li>
<li>
<p>Monter une connexion TLS depuis le logiciel via une requete HTTP GET sur l&rsquo;URL <a href="https://mss-msg-igcsante.formation.mssante.fr/mss-msg-services/services/Annuaire/soap/v1/listEmails">https://mss-msg-igcsante.formation.mssante.fr/mss-msg-services/services/Annuaire/soap/v1/listEmails</a>.</p>
</li>
</ol>
<h4 id="111-preuve">1.1.1 Preuve</h4>
<blockquote>
<p>Extrait de configuration TLS du client de messagerie.</p>
</blockquote>
<p>La DevBox-sante a développé un <code>IGCSanteTrustoreManager</code> spécifique afin de prendre en compte les différentes IGC-Santé définies sur <a href="http://igc-sante.esante.gouv.fr/PC/">http://igc-sante.esante.gouv.fr/PC/</a> . Tous les composants DevBox-Sante comme la MSS peuvent être configurés de manière à accepter les certificats d’une ou plusieurs gammes. Comme par exemple, pour l’environnement de formation de Mailiz :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">devbox-sante</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">ms-sante</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">igcsante</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">gammes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ELEMENTAIRE_ORGANISATIONS, ELEMENTAIRE_ORGANISATIONS_TEST</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h4 id="112-preuve">1.1.2 Preuve</h4>
<blockquote>
<p>Logs de la connexion TLS</p>
</blockquote>
<p>Dans les logs (all.log) on peut s’intéresser à l’initialisation de l’<code>IGCSanteTrustStoreManager</code> :</p>
<pre tabindex="0"><code>2022-10-12 12:00:29.519  INFO 7092 --- [           main] f.d.igcsante.IGCSanteTrustoreManager     : Initialisation du truststore
2022-10-12 12:00:29.520  INFO 7092 --- [           main] f.d.igcsante.IGCSanteTrustoreManager     : Ajout du certificat http://igc-sante.esante.gouv.fr/AC/ACI-EL-ORG.cer au trustStore
2022-10-12 12:00:30.357  INFO 7092 --- [           main] f.d.igcsante.IGCSanteTrustoreManager     : Ajout du certificat http://igc-sante.esante.gouv.fr/AC%20TEST/ACI-EL-ORG-TEST.cer au trustStore
</code></pre><h2 id="mss-2-tlsv12-uniquement">MSS 2 : TLSv1.2 uniquement</h2>
<blockquote>
<p>Conformément au référentiel socle MSSanté #2 (Clients de Messageries Sécurisées de Santé):
Le client de messageries MSSanté du système doit supporter uniquement la version TLS 1.2 pour établir la connexion TLS avec l’Opérateur MSSanté, lors de la négociation TLS. (cf. RFC 2246 - <a href="http://tools.ietf.org/html/rfc2246)">http://tools.ietf.org/html/rfc2246)</a>. Dans le cas contraire, la connexion ne doit pas être établie.</p>
</blockquote>
<h4 id="mss-21-scenario">MSS 2.1 Scenario</h4>
<ol>
<li>
<p>Vérifier que la configuration TLS du logiciel accepte les certificats serveurs IGC Santé de la branche de TEST</p>
</li>
<li>
<p>Monter une connexion TLS depuis le logiciel via une requete HTTP GET sur l&rsquo;URL <a href="https://mss-msg-igcsante.formation.mssante.fr/mss-msg-services/services/Annuaire/soap/v1/listEmails">https://mss-msg-igcsante.formation.mssante.fr/mss-msg-services/services/Annuaire/soap/v1/listEmails</a>.</p>
</li>
</ol>
<h4 id="mss-211-preuve">MSS 2.1.1 Preuve</h4>
<blockquote>
<p>Extrait de configuration TLS du client de messagerie.</p>
</blockquote>
<p>Réponse :</p>
<p>Nous utilisons une JVM en version 11 minimale. Lors de l’initialisation d’un contexte SSL via la JVM nous spécifions de manière statique le protocole TLSv1.2.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">SSLContext</span> <span style="color:#000">sslContext</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">SSLContext</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getInstance</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;TLSv1.2&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span></code></pre></div><h4 id="mss-212-preuve">MSS 2.1.2 Preuve</h4>
<blockquote>
<p>Logs de connexion TLS</p>
</blockquote>
<p>Dans les logs (all.log) on peut s’intéresser à juste après l’envoi de la requête :</p>
<pre tabindex="0"><code>2022-10-12 11:43:32.117  INFO 20756 --- [           main] o.a.c.services.AnnuaireService.REQ_OUT   : REQ_OUT
    Address: https://mss-msg-igcsante.formation.mssante.fr/mss-msg-services/services/Annuaire/soap/v1/listEmails
    HttpMethod: POST
   ...
</code></pre><p>le Handshake Message du client demande une TLSv1.2:</p>
<pre tabindex="0"><code>javax.net.ssl|DEBUG|01|main|2022-10-12 11:43:32.279 CEST|ClientHello.java:653|Produced ClientHello handshake message (
&#34;ClientHello&#34;: {
  &#34;client version&#34;      : &#34;TLSv1.2&#34;,
  ...
}
)
</code></pre><p>et la réponse du serveur valide le protocole :</p>
<pre tabindex="0"><code>javax.net.ssl|DEBUG|01|main|2022-10-12 11:43:32.337 CEST|ServerHello.java:872|Consuming ServerHello handshake message (
&#34;ServerHello&#34;: {
  &#34;server version&#34;      : &#34;TLSv1.2&#34;,
  ...
}
)
</code></pre><h2 id="mss-3--choix-des-cyphers">MSS 3 : choix des cyphers</h2>
<blockquote>
<p>Conformément au référentiel socle MSSanté #2 (Clients de Messageries Sécurisées de Santé) [MSS1] :
Le client de messageries MSSanté du système doit nécessairement utiliser l’une des suites de chiffrement suivantes, lors de la négociation TLS :</p>
<ul>
<li>0xC030: TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</li>
<li>0xC02F: TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</li>
<li>0xC028: TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384</li>
<li>0xC027: TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA25</li>
</ul>
<p>Dans le cas contraire, la connexion ne doit pas être établie.</p>
</blockquote>
<h3 id="mss-31-étapes">MSS 3.1 Étapes</h3>
<ol>
<li>
<p>Vérifier que la configuration TLS du logiciel accepte les certificats serveurs IGC Santé de la branche de TEST</p>
</li>
<li>
<p>Monter une connexion TLS depuis le logiciel via une requete HTTP GET sur l&rsquo;URL <a href="https://mss-msg-igcsante.formation.mssante.fr/mss-msg-services/services/Annuaire/soap/v1/listEmails">https://mss-msg-igcsante.formation.mssante.fr/mss-msg-services/services/Annuaire/soap/v1/listEmails</a>.</p>
</li>
</ol>
<h4 id="mss-311">MSS 3.1.1</h4>
<blockquote>
<p>Notre connecteur s’appuie sur la connexion TLS proposé par le serveur Mailiz, le choix du protocole est à l’initiative de l’opérateur.</p>
</blockquote>
<h4 id="mss-312">MSS 3.1.2</h4>
<p>Dans les logs (all.log) on peut s’intéresser à juste après l’envoi de la requête :</p>
<pre tabindex="0"><code>2022-10-12 11:43:32.117  INFO 20756 --- [           main] o.a.c.services.AnnuaireService.REQ_OUT   : REQ_OUT
    Address: https://mss-msg-igcsante.formation.mssante.fr/mss-msg-services/services/Annuaire/soap/v1/listEmails
    HttpMethod: POST
   ...
</code></pre><p>le Handshake Message du client demande les cyphers suivants :</p>
<pre tabindex="0"><code class="language-log" data-lang="log">javax.net.ssl|DEBUG|01|main|2022-10-12 12:00:38.363 CEST|ClientHello.java:653|Produced ClientHello handshake message (
&#34;ClientHello&#34;: {
  &#34;client version&#34;      : &#34;TLSv1.2&#34;,
  ...
  &#34;cipher suites&#34;       : &#34;[TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384(0xC02C), TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256(0xC02B), TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384(0xC030), TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256(0xC02F), TLS_DHE_RSA_WITH_AES_256_GCM_SHA384(0x009F), TLS_DHE_DSS_WITH_AES_256_GCM_SHA384(0x00A3), TLS_DHE_RSA_WITH_AES_128_GCM_SHA256(0x009E), TLS_DHE_DSS_WITH_AES_128_GCM_SHA256(0x00A2), TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384(0xC024), TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384(0xC028), TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256(0xC023), TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256(0xC027), TLS_DHE_RSA_WITH_AES_256_CBC_SHA256(0x006B), TLS_DHE_DSS_WITH_AES_256_CBC_SHA256(0x006A), TLS_DHE_RSA_WITH_AES_128_CBC_SHA256(0x0067), TLS_DHE_DSS_WITH_AES_128_CBC_SHA256(0x0040), TLS_ECDH_ECDSA_WITH_AES_256_GCM_SHA384(0xC02E), TLS_ECDH_RSA_WITH_AES_256_GCM_SHA384(0xC032), TLS_ECDH_ECDSA_WITH_AES_128_GCM_SHA256(0xC02D), TLS_ECDH_RSA_WITH_AES_128_GCM_SHA256(0xC031), TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA384(0xC026), TLS_ECDH_RSA_WITH_AES_256_CBC_SHA384(0xC02A), TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA256(0xC025), TLS_ECDH_RSA_WITH_AES_128_CBC_SHA256(0xC029), TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA(0xC00A), TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA(0xC014), TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA(0xC009), TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA(0xC013), TLS_DHE_RSA_WITH_AES_256_CBC_SHA(0x0039), TLS_DHE_DSS_WITH_AES_256_CBC_SHA(0x0038), TLS_DHE_RSA_WITH_AES_128_CBC_SHA(0x0033), TLS_DHE_DSS_WITH_AES_128_CBC_SHA(0x0032), TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA(0xC005), TLS_ECDH_RSA_WITH_AES_256_CBC_SHA(0xC00F), TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA(0xC004), TLS_ECDH_RSA_WITH_AES_128_CBC_SHA(0xC00E), TLS_RSA_WITH_AES_256_GCM_SHA384(0x009D), TLS_RSA_WITH_AES_128_GCM_SHA256(0x009C), TLS_RSA_WITH_AES_256_CBC_SHA256(0x003D), TLS_RSA_WITH_AES_128_CBC_SHA256(0x003C), TLS_RSA_WITH_AES_256_CBC_SHA(0x0035), TLS_RSA_WITH_AES_128_CBC_SHA(0x002F), TLS_EMPTY_RENEGOTIATION_INFO_SCSV(0x00FF)]&#34;,
  ...
}
)
</code></pre><p>Le serveur choisit :</p>
<pre tabindex="0"><code class="language-log" data-lang="log">javax.net.ssl|DEBUG|01|main|2022-10-12 12:00:38.415 CEST|ServerHello.java:872|Consuming ServerHello handshake message (
&#34;ServerHello&#34;: {
  &#34;server version&#34;      : &#34;TLSv1.2&#34;,
  ...
  &#34;cipher suite&#34;        : &#34;TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384(0xC030)&#34;,
}
)
</code></pre><h2 id="mss-4--certificat-igc-santé">MSS 4 : certificat IGC Santé</h2>
<blockquote>
<p>Les clients de messageries MSSanté du système doivent être en capacité d’établir une connexion TLS avec un Opérateur MSSanté présentant un certificat serveur de l’IGC Santé,conformément au référentiel socle MSSanté #2 (Clients de Messageries Sécurisées de Santé) [MSS1].</p>
</blockquote>
<h3 id="mss-41-étapes">MSS 4.1 Étapes</h3>
<ol>
<li>
<p>Vérifier que la configuration TLS du logiciel accepte les certificats serveurs IGC Santé de la branche de TEST</p>
</li>
<li>
<p>Monter une connexion TLS depuis le logiciel via une requete HTTP GET sur l&rsquo;URL <a href="https://mss-msg-igcsante.formation.mssante.fr/mss-msg-services/services/Annuaire/soap/v1/listEmails">https://mss-msg-igcsante.formation.mssante.fr/mss-msg-services/services/Annuaire/soap/v1/listEmails</a>.</p>
</li>
</ol>
<h4 id="mss-411">MSS 4.1.1</h4>
<blockquote>
<p>Extrait de configuration des AC supportées par le client de messagerie.</p>
</blockquote>
<p>idem 1.1.1</p>
<h2 id="mss-5-certificat-opérateur-non-expiré">MSS 5 : certificat Opérateur non expiré</h2>
<blockquote>
<p>Le client de messageries MSSanté du système DOIT vérifier que le certificat présenté par l’opérateur MSSanté n’est pas expiré, conformément au référentiel socle MSSanté #2 (Clients de Messageries Sécurisées de Santé) [MSS1].</p>
</blockquote>
<h3 id="mss-51-étapes">MSS 5.1 Étapes</h3>
<ol>
<li>
<p>Vérifier que la configuration TLS du logiciel accepte les certificats serveurs IGC Santé de la branche de TEST</p>
</li>
<li>
<p>Monter une connexion TLS depuis le logiciel via une requete HTTP GET sur l&rsquo;URL <a href="https://mss-msg-igcsante.formation.mssante.fr/mss-msg-services/services/Annuaire/soap/v1/listEmails">https://mss-msg-igcsante.formation.mssante.fr/mss-msg-services/services/Annuaire/soap/v1/listEmails</a>.</p>
</li>
</ol>
<h4 id="mss-511">MSS 5.1.1</h4>
<blockquote>
<p>Extrait de configuration qui permet de montrer que le client a bien configuré pour respecter cette exigence.</p>
</blockquote>
<p>Pas de configuration ici, les traces parlent d’elles mêmes.</p>
<p>A l’initialisation, l’<code>IGCSanteTrustoreManager</code> vérifie que les certificats de confiance utilisés ne sont pas expirés.</p>
<pre tabindex="0"><code class="language-log" data-lang="log">2022-10-12 12:00:29.519  INFO 7092 --- [           main] f.d.igcsante.IGCSanteTrustoreManager     : Initialisation du truststore
2022-10-12 12:00:29.520  INFO 7092 --- [           main] f.d.igcsante.IGCSanteTrustoreManager     : Ajout du certificat http://igc-sante.esante.gouv.fr/AC/ACI-EL-ORG.cer au trustStore
2022-10-12 12:00:30.357 DEBUG 7092 --- [           main] f.d.igcsante.IGCSanteTrustoreManager     : Date expiration du certificat (CN=AC IGC-SANTE ELEMENTAIRE ORGANISATIONS, OU=IGC-SANTE, OU=0002 187512751, O=ASIP-SANTE, C=FR) est : Fri Jun 24 02:00:00 CEST 2033
2022-10-12 12:00:30.357  INFO 7092 --- [           main] f.d.igcsante.IGCSanteTrustoreManager     : Ajout du certificat http://igc-sante.esante.gouv.fr/AC%20TEST/ACI-EL-ORG-TEST.cer au trustStore
2022-10-12 12:00:30.756 DEBUG 7092 --- [           main] f.d.igcsante.IGCSanteTrustoreManager     : Date expiration du certificat (CN=TEST AC IGC-SANTE ELEMENTAIRE ORGANISATIONS, OU=IGC-SANTE TEST, OU=0002 187512751, O=ASIP-SANTE, C=FR) est : Fri Jun 24 02:00:00 CEST 2033
</code></pre><p>Puis plus tard lors de la vérification du certificat présenté par le serveur :</p>
<pre tabindex="0"><code class="language-log" data-lang="log">javax.net.ssl|DEBUG|01|main|2022-10-12 12:00:40.074 CEST|CertificateMessage.java:366|Consuming server Certificate handshake message (
&#34;Certificates&#34;: [
  &#34;certificate&#34; : {
    &#34;version&#34;            : &#34;v3&#34;,
    &#34;serial number&#34;      : &#34;1D 5D E2 5E 3D C1 4B DE 21 0F 2C 0F 23 0E 86 52&#34;,
    &#34;signature algorithm&#34;: &#34;SHA256withRSA&#34;,
    &#34;issuer&#34;             : &#34;CN=TEST AC IGC-SANTE ELEMENTAIRE ORGANISATIONS, OU=IGC-SANTE TEST, OU=0002 187512751, O=ASIP-SANTE, C=FR&#34;,
    &#34;not before&#34;         : &#34;2022-06-02 13:49:28.000 CEST&#34;,
    &#34;not  after&#34;         : &#34;2024-06-02 13:49:28.000 CEST&#34;,
    ...
]
)
2022-10-12 12:00:40.075 DEBUG 7092 --- [           main] f.d.igcsante.IGCSanteTrustoreManager     : Date expiration du certificat (CN=mss-msg-igcsante.formation.mssante.fr, OU=300000000099622, O=GIP - TEST9962, ST=Paris (75), C=FR) est : Sun Jun 02 13:49:28 CEST 2024
2022-10-12 12:00:40.075 DEBUG 7092 --- [           main] f.d.igcsante.IGCSanteTrustoreManager     : Date expiration du certificat (CN=TEST AC IGC-SANTE ELEMENTAIRE ORGANISATIONS, OU=IGC-SANTE TEST, OU=0002 187512751, O=ASIP-SANTE, C=FR) est : Fri Jun 24 02:00:00 CEST 2033
</code></pre><p>On voit que l’<code>IGCSanteTrustoreManager</code> vérifie la date d’expiration de la chaîne de certificats utilisée.</p>
<h4 id="mss-512">MSS 5.1.2</h4>
<blockquote>
<p>Si besoin, extrait du code qui vérifie la non expiration du certificat</p>
</blockquote>
<p>Lors de l’initialisation d’une connexion et une fois le certificat validé par le truststore la date d’expiration du certificat présenté par l’opérateur MSS est vérifiée : </p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">log</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">debug</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Date expiration du certificat ({}) est : {}&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">certificat</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getSubjectDN</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">toString</span><span style="color:#ce5c00;font-weight:bold">(),</span> <span style="color:#000">certificat</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getNotAfter</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Instant</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">now</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">isAfter</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">certificat</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getNotAfter</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">toInstant</span><span style="color:#ce5c00;font-weight:bold">()))</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">throw</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">IGCSanteException</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">format</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Le certificat (%s) est expiré. La date d&#39;expiration est : &#34;</span> <span style="color:#ce5c00;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">certificat</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getSubjectDN</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">toString</span><span style="color:#ce5c00;font-weight:bold">(),</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">certificat</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getNotAfter</span><span style="color:#ce5c00;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="mss-6--non-révocation-du-certificat">MSS 6 : non révocation du certificat</h2>
<blockquote>
<p>Le client de messageries MSSanté du système doit vérifier que le certificat présenté par l’Opérateur MSSanté n’est pas révoqué au moyen des CRL ou d’un répondeur OCSP, et ce quelle que soit l’autorité de certification utilisée par un Opérateur MSSanté, conformément au référentiel socle MSSanté #2 (Clients de Messageries Sécurisées de Santé) [MSS1].</p>
</blockquote>
<h3 id="mss-61-étapes">MSS 6.1 : Étapes</h3>
<ol>
<li>
<p>Vérifier que la configuration TLS du logiciel accepte les certificats serveurs IGC Santé de la branche de TEST</p>
</li>
<li>
<p>Monter une connexion TLS depuis le logiciel via une requête HTTP GET sur l&rsquo;URL <a href="https://mss-msg-igcsante.formation.mssante.fr/mss-msg-services/services/Annuaire/soap/v1/listEmails">https://mss-msg-igcsante.formation.mssante.fr/mss-msg-services/services/Annuaire/soap/v1/listEmails</a>.</p>
</li>
</ol>
<h4 id="mss-611">MSS 6.1.1</h4>
<blockquote>
<p>Extrait de configuration qui permet de montrer que le client a bien configuré pour respecter cette exigence.</p>
</blockquote>
<p>Lors du lancement de la JVM (version 11 minimal) du connecteur MSS un truststore est généré avec un sous ensemble de la gamme de certificats de l’AC définit à l’url suivante : <a href="http://igc-sante.esante.gouv.fr/PC/">http://igc-sante.esante.gouv.fr/PC/</a></p>
<p>Nous prenons en compte les CRL disponibles pour chaque certificat donné à cette même URL.</p>
<p>Les logs montrent cette prise en charge :</p>
<pre tabindex="0"><code class="language-log" data-lang="log">2022-10-12 12:00:30.758  INFO 7092 --- [           main] f.d.igcsante.IGCSanteTrustoreManager     : Ajout de la CRL http://igc-sante.esante.gouv.fr/CRL/ACI-EL-ORG.crl au trustStore
2022-10-12 12:00:31.848  INFO 7092 --- [           main] f.d.igcsante.IGCSanteTrustoreManager     : Ajout de la CRL http://igc-sante.esante.gouv.fr/CRL/ACI-EL-ORG-TEST.crl au trustStore
</code></pre><h4 id="msc612">MSC 6.1.2</h4>
<blockquote>
<p>Si besoin, extrait du code qui vérifie la non révocation du certificat</p>
</blockquote>
<p>L’<code>IGCSanteTrustoreManager</code> est codé pour vérifier les CRLs disponibles sur <a href="http://igc-sante.esante.gouv.fr/PC/">http://igc-sante.esante.gouv.fr/PC/</a>, dont voici l’extrait de code :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">PKIXBuilderParameters</span> <span style="color:#000">pkixParams</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">PKIXBuilderParameters</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">trustStore</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">X509CertSelector</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">IGCSanteGammeCertificat</span> <span style="color:#000">gammeCertificat</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">gammeCertificats</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">String</span> <span style="color:#000">crlUrl</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">gammeCertificat</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getCrlUrl</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">log</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">info</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Ajout de la CRL {} au trustStore&#34;</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">crlUrl</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">pkixParams</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addCertStore</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">_loadCRL</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">crlUrl</span><span style="color:#ce5c00;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">pkixParams</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setRevocationEnabled</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">ManagerFactoryParameters</span> <span style="color:#000">trustParams</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">CertPathTrustManagerParameters</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">pkixParams</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span></code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-543a805332bd0423b3101618b1d938a5">2 - Architecture interne des différents composants</h1>
    <div class="lead">Pour les intéressés, l&rsquo;architecture interne des différents composants</div>
	<h2 id="diagramme-de-flux">Diagramme de flux</h2>
<pre tabindex="0"><code class="language-plantuml" data-lang="plantuml">!include https://bitbucket.org/devbox-sante/plantuml/raw/current/themes/theme-devbox-sante.puml
component &#34;DevBox-santé MSs&#34; as DevBoxSanteMSS

cloud &#34;Mailiz&#34; as Mailiz
cloud &#34;partenaires.annuaire.sante.fr&#34; as LDAP

DevBoxSanteMSS --&gt; Mailiz  : https (TLS 1.2 / IGC Santé)
DevBoxSanteMSS --&gt; LDAP  : ldap
</code></pre>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-31a3d0d8a67de401d0d1edbc704a0012">3 - Versions</h1>
    <div class="lead">Les différentes versions de la DevBox-Santé MS-Santé</div>
	<h2 id="notesversion-122-05102022">NotesVersion 1.2.2 (05/10/2022)</h2>
<h3 id="story">Story</h3>
<p><a href="https://devbox-sante.atlassian.net/browse/MSS-21">MSS-21</a> [Repository] reorganisation de repo.dev.coop</p>
<h2 id="version-121-27092022">Version 1.2.1 (27/09/2022)</h2>
<h3 id="bug">Bug</h3>
<p><a href="https://devbox-sante.atlassian.net/browse/MSS-20">MSS-20</a> [Mailiz] problème encodage à réception</p>
<h2 id="version-120-15092022">Version 1.2.0 (15/09/2022)</h2>
<h3 id="bug-1">Bug</h3>
<p><a href="https://devbox-sante.atlassian.net/browse/MSS-12">MSS-12</a> Permettre le switch d&rsquo;une connexion / deconnexion CPS et login_password dans les deux sens</p>
<h3 id="story-1">Story</h3>
<p><a href="https://devbox-sante.atlassian.net/browse/MSS-18">MSS-18</a> [TLS] Reprendre les exigences de vérification CRL</p>
<h3 id="tâche">Tâche</h3>
<p><a href="https://devbox-sante.atlassian.net/browse/MSS-19">MSS-19</a> [Accusé réception] gestion de isAccuse</p>
<h1 id="version-112-07062022">Version 1.1.2 (07/06/2022)</h1>
<h3 id="bug-2">Bug</h3>
<p><a href="https://devbox-sante.atlassian.net/browse/MSS-16">MSS-16</a> [formation.mssante.fr] nouveau certificat</p>
<div class="csg-wrapper" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; font-size: 14px; font-weight: 400; line-height: 24px; vertical-align: baseline;"><h1 class="csg-h1" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 23px; line-height: 1.1034; margin-top: 40px; letter-spacing: -0.01em;">Version 1.1.1 (14/12/2021)</h1><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Tâche</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/MSS-14" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">MSS-14</a> [Security] log4j montée de version BOM</p></div>
<div class="csg-wrapper" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; font-size: 14px; font-weight: 400; line-height: 24px; vertical-align: baseline;"><h1 class="csg-h1" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 23px; line-height: 1.1034; margin-top: 40px; letter-spacing: -0.01em;">Version 1.1 (21/10/2017)</h1><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Bug</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/MSS-12" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">MSS-12</a> Permettre le switch d'une connexion / deconnexion CPS et login_password dans les deux sens</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/MSS-7" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">MSS-7</a> [Proxy] CPS connexion et problème de refresh</p><h3 class="csg-h3" style="font-style: inherit; color: #172B4D; font-weight: 600; margin-bottom: 0; font-size: 16px; line-height: 1.2; margin-top: 32px; font-weight: 500; letter-spacing: -0.008em;">Story</h3><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/MSS-10" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">MSS-10</a> [Mailiz] uploadAttachment non opérationnel</p><p class="csg-p" style="margin: 0; padding: 0px; margin-bottom: 7px; padding-top: 7px; mso-line-height-rule: exactly; line-height: 24px; font-size: 14px;"><a href="https://devbox-sante.atlassian.net/browse/MSS-9" class="csg-mark-link" style="border: none; background: transparent; color: #0052cc; text-decoration: none;">MSS-9</a> Remonter les bons messages d'erreur (SoapFault) depuis le proxy</p></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="www.devbox-sante.fr" aria-label="www.devbox-sante.fr">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.devbox-sante.fr" aria-label="www.devbox-sante.fr">
      <i class="icon iconFoot icon-devbox"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="BitBucket" aria-label="BitBucket">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/google/docsy" aria-label="BitBucket">
      <i class="fab fa-bitbucket"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Contactez-nous" aria-label="Contactez-nous">
    <a class="text-white" target="_blank" rel="noopener" href="mailto://devbox-sante@devcoop.fr" aria-label="Contactez-nous">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 DevBox Santé Tous droits réservés</small>
        <small class="ml-1"><a href="https://www.devbox-sante.fr/mentions" target="_blank" rel="noopener">Politique de confidentialité</a></small>
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src='/js/deflate.js'></script>
<script src="/js/main.min.3a0c127c91c19bb5bc28c5e9f8b735520cf339dd08bc90d296bd27e9cfd53e3d.js" integrity="sha256-OgwSfJHBm7W8KMXp&#43;Lc1UgzzOd0IvJDSlr0n6c/VPj0=" crossorigin="anonymous"></script>
<script src='/js/tabpane-persist.js'></script>


  </body>
</html>
